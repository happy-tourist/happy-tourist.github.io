<template>
<div><div class="standard-markdown grid-cols-1 grid gap-4 [&amp;_&gt;_*]:min-w-0 !gap-3.5"><h1 class="text-text-100 mt-3 -mb-1 text-[1.375rem] font-bold">Лекция по изучению Node.js. Урок 1</h1>
<h2 class="text-text-100 mt-3 -mb-1 text-[1.125rem] font-bold">Отредактированный транскрипт</h2>
<img :src="screenshot_0002" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:00:00 --- Всем привет! Пожалуйста, поставьте в чат плюсики, если меня хорошо видно и слышно, и мы тогда начнём наше первое занятие по <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Node.js</code>. Вижу, что в онлайне вас не так много — на курсе у нас записано человек 15, так что, возможно, кто-то еще подтянется или заблудился.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:00:24 --- Стартовый вопрос ко всем: какие у вас начальные знания в Node.js и JavaScript? Специфика курса такова, и об этом было написано на страничке, что мы изучаем Node.js с нуля, но <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">JavaScript</code> мы не учим. То есть JavaScript надо знать, потому что все стандартные конструкции — <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">промисы</code>, асинхронность, базовый синтаксис, типы данных, умение строить логику программы — всё это должно быть из JavaScript.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:01:01 --- Поэтому надеюсь, что в чате никто не напишет, что JS не знает. По сути, может возникнуть логичный вопрос: а в чём заключается смысл изучения Node.js, если сам язык синтаксически уже надо знать? Дело в том, что в Node.js код пишется на том же языке — мы видим тот же самый JavaScript, но <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">среда выполнения</code> другая.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:01:31 --- У вас нет привычных переменных типа <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Window</code> и <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Document</code>, да и цели с задачами другие. Если в браузере мы в основном манипулируем с объектной моделью документа, либо вручную, либо посредством фреймворков типа Vue или React, то в Node.js мы полностью меняем подход, потому что наша цель — это <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">backend</code>. Это создание веб-сервера для генерации страниц, или создание API, или создание сокет-сервера.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:02:00 --- Да, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">WebSocket</code> имеется в виду — для <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">real-time</code> коммуникаций. Получается, синтаксис языка, на котором мы пишем, остаётся прежним, а всё остальное меняется. То есть меняются все смыслы, цели, подходы и так далее. Вижу, что в чате пишут про JavaScript — пишут, что всё нормально.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:02:23 --- Даже немного Node.js было у некоторых. Но на самом деле Node.js может фронтенд-разработчику пригодиться даже тогда, когда он сам backend-часть не пишет. Например, если ему нужно сделать <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">server-side rendering</code> (SSR) или пререндеринг страниц для SPA — это всё равно Node.js. Или если backend у вас делает PHP-разработчик, который создал API, скажем, на <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Laravel</code>, и вдруг все собрались и решили, что поисковики не дают хороших позиций в выдаче, не индексируют нормально, пока приложение не сделано с server-side rendering.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:02:56 --- Получается, что PHP-разработчик сразу говорит: "Товарищ, я PHP-разработчик, я модуль <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">V8</code> в PHP устанавливать не буду, потому что это новая DLL, там сервер надо конфигурировать, надо смотреть, насколько быстро это будет работать". И получается, что нужно в Node.js среде это делать, видимо, совместными усилиями.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:03:19 --- Будет один человек, который backend понимает, и один человек, который JavaScript знает. Сергей пишет: "Было бы очень интересно затронуть SSR на Node.js". Может получится выделить на эту тему время, но server-side rendering у нас есть в курсах Vue уровень 2 немного, React уровень 2 — там про SSR было вообще очень много в этот раз, он полностью завладел первой половиной курса.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:03:49 --- Проблема в чём? Общие принципы server-side rendering — в плане того, чтобы принять запрос, передать управление какому-то приложению — это всё одинаково. А дальше очень серьёзная специфика для React и для Vue, потому что у них немного разные принципы рендеринга.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:04:10 --- Во Vue, например, прекрасно используется компонент <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Suspense</code> (экспериментальный). В React это так просто не сделать. Мы несколько раз подряд запускали <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">render to string</code> и кэшировали асинхронные операции. В общем, там много разных подходов есть, а в вакууме SSR сложно сделать. Можно, конечно, попробовать, но для этого надо какое-то SPA-приложение сначала создать — на нативном JavaScript SPA редко кто пишет.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:04:39 --- Это скорее получится либо пародия на фреймворк, либо какой-то код без компонентов. Что у нас интересного в чате? Игорь пишет, что в прошлую среду такое было у него. О, нормально. Наверное, имеется в виду ситуация, что PHP-разработчик и JavaScript фронтенд-разработчик вместе писали код на Node.js, чтобы достичь нужного результата.</p>
<img :src="screenshot_0326" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:05:03 --- А Павел пишет: "Друг много на Node.js <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">backend for frontend</code> разрабатывает — прослойку между API для единого endpoint". Да, такое тоже бывает, конечно. Раз уж мы про философские вопросы заговорили, давайте сначала попробуем понять, какие плюсы есть у Node.js и у другого альтернативного backend-решения. То есть, когда мы с чем-то начинаем сравнивать Node.js, то важно понимать, что мы должны сравнивать его с популярными решениями.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:05:37 --- Самое популярное — это, конечно, PHP. Понятно, что есть возможность сделать на C# с ASP.NET сайты. Раньше и на Java делали. Есть Python и его фреймворки для веба. Есть какие-то элитные языки, которые там Google продвигает. Но у них у всех своё назначение.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:05:57 --- Python чаще берут, если сервер должен делать не просто обработку запросов, которые JSON будут перегонять. Взяли данные из базы, в JSON запаковали, отправили клиенту — зачем там Python? Python обычно берут, если нужно сделать какую-то часть backend для запуска нейросети. Потому что на Python это идеально, а на PHP, как нейросеть ни пиши, она будет тормозить, потому что PHP не умеет матрицы за один такт складывать.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:06:30 --- Нет такого типа данных как матрица, и JavaScript тоже не умеет. Поэтому, если мы сравниваем Node.js с другими языками backend, наверное, мы по самому классическому пути пойдём — будем сравнивать его с PHP. Почему Node.js для многих имеет очень большой смысл? PHP чем хорош — он популярен, и у него огромная экосистема.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:06:56 --- Отметим ключевые моменты: <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">популярность</code> влияет на <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">экосистему</code>. То есть для PHP, и в частности для Laravel или Yii, найти кучу готовых решений гораздо проще, чем для Node.js-фреймворков высокого уровня, типа <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">NestJS</code>. Программиста владельцу компании проще найти на PHP, конечно, чем на Node.js-фреймворке.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:07:23 --- Но если мы смотрим с точки зрения именно возможностей языка, то у Node.js открываются явные плюсы. Во-первых, это тот же самый JavaScript, который многие из вас знают — все, кто здесь присутствуют, знают JS. Во-вторых, получается, что если мы делаем для <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">SPA</code> server-side rendering, то без Node.js нам в принципе не обойтись. А чем дальше веб развивается, тем больше становится single-page applications.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:07:53 --- Конечно, Node.js хорош тем, что у него, несмотря на однопоточность, есть полная поддержка асинхронности. <em>[Примечание: произошёл технический сбой с демонстрацией экрана, который был быстро решён]</em></p>
<img :src="screenshot_0521" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:08:21 --- Отлично, что всё работает. Если вылетает белый экран, то просто нажмите F5, и заработает снова. Node.js даёт из коробки возможность очень легко делать всякие вещи, связанные с <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">real-time</code> взаимодействием. На PHP это далеко не так просто. Скоро покажу специфику — почему на PHP это не так просто.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:08:44 --- На Node.js легко, потому что в PHP только совсем недавно появились такие вещи, которые назвали <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">файберами</code> (fibers) — возможность написать участок кода, отправить его в отложенную задачу, и потом, когда этот файбер завершится, обработать его результат. Что-то похожее на промисы в классическом JavaScript — тоже такое обещание выполнить задачу. Раньше в PHP запрос к базе делаешь — код застопорился на этом месте, и другие операции не выполняются, пока база не ответит. Получается, что мы не можем просто так легко взять, принять запрос от клиента и ждать, чтобы ему в режиме реального времени данные пересылать.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:09:24 --- В упрощённом виде мы сейчас, когда будем обсуждать устройство <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">EventLoop</code> в Node.js, поймём, почему Node.js с этими задачами прекрасно справляется. Плюс, конечно, когда ты Node.js всё больше и больше изучаешь, тебе, как ни странно, становится всё легче и легче работать с <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">сборкой проекта</code>.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:09:43 --- Хоть с <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Webpack</code>, хоть с <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Vite</code>. Потому что зачастую в них приходится дорабатывать какие-то свои плагины: которые удалят лишний CSS, перекомпонуют CSS, выделят <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">критический CSS</code>, или ещё какую-то хитрую систему сделают. Чем лучше ты Node.js знаешь, тем проще тебе понять разницу между EventLoop в Node.js и в браузере.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:10:09 --- Но да, сейчас нам сначала надо понять, что за EventLoop, что он из себя представляет. Он, в принципе, имеет много общего для Node.js среды и для браузерной среды. Поэтому мы начнём, конечно, с общих моментов. Если я про этот вопрос про разницу забуду, просьба потом напомнить в чате ещё раз. Но я думаю, что не забуду. Итак, давайте перемещаться уже непосредственно в VS Code.</p>
<img :src="screenshot_0646" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:10:39 --- Будем программировать. Пока просьба плюсами подтвердите, что вводные слова понятны. Я думаю, вы прекрасно понимаете, зачем вам Node.js, если на этот курс пришли. А, ещё забыл один важный момент указать: если мы используем <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">TypeScript</code>, мы можем использовать типы для обоих сред — одинаковые типы для фронтенда и backend.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:11:09 --- То есть прикол в том, что backend делается на Node.js с TypeScript, и backend-разработчик описывает тип сущности в базе. Получается, что фронтенд-разработчик может эти типы использовать, потому что backend-разработчик скажет: "Я отдаю по такому endpoint данные такого типа". Тогда эти типы выносятся в отдельный <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">npm</code>-пакет. Иногда, чтобы на npm это не светилось, поднимают свои системы, похожие на npm, для локальной работы.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:11:40 --- Получается, что просто используют этот пакет как зависимость. Вопрос: курс на TypeScript будет? Нет, курс не будет на TypeScript. В программе этого курса про TypeScript ничего не говорилось, поэтому кто про TypeScript первый раз услышал — вы не переживайте.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:12:00 --- TypeScript придёт во второй ступени Node.js, когда она будет — не знаю, вряд ли в этом году поместится. План на вторую ступень такой, чтобы там сначала с TypeScript разобраться и потом его совместить с фреймворком высокого уровня типа NestJS. Там TypeScript нужен, потому что без TypeScript <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">декораторы</code> смотрятся как минимум странно, да и в принципе порядок в коде с TypeScript значительно выше. Вопрос общего характера: будет ли курс по TypeScript? Вчера он начался.</p>
<img :src="screenshot_0760" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:12:29 --- Да, вчера первый урок прошёл. Если кто не в курсе — вот он. Ну, а нам надо таки начать что-то делать с Node.js. Итак, смотрите. Node.js — какая версия? Неважно. У меня девятнадцатая. Сейчас на сайте stable двадцатая. Это не важно. <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">npm</code>, по сути, от девятки и выше должен быть, скорее всего.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:12:57 --- Почему это не так важно? Потому что ключевые обновления Node.js вышли давным-давно. Под ключевыми обновлениями я подразумеваю нативную поддержку <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">async/await</code> на верхнем уровне. Это было где-то в версии 14-й ветки сделано. И, например, умение работать с нативными <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">ES-модулями</code>. Это было ещё раньше — в ветке 13-й. Поэтому, какая у вас ветка на компьютере — если 18, вы можете до 19-й, до 20-й и не обновляться вовсе.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:13:26 --- Я думаю, что у вас все исходники курса будут прекрасно работать, какую бы версию Node.js вы ни выбрали. Сейчас в ветках Node.js обновления не такие серьёзные происходят. То есть понятно, что у нас могут появляться разные новые операции. Типа в стандарте JavaScript 2023 придумали новую функцию <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Array.with()</code>, например, которая возвращает новую копию массива с изменённым элементом.</p>
<img :src="screenshot_0856" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:13:54 --- Сделали функцию ради разработчиков на React, чтобы им иммутабельность меньше проблем доставляла. Не только для этого, конечно, но прямо в React она идеально заходит. Чтобы в Node.js она у нас появилась, конечно, версию надо обновить, но мы будем писать такой код, чтобы он на максимальном количестве версий работал. Итак, теперь, как с Node.js начать работать и какие есть нюансы. Давайте я какую-нибудь папочку новую возьму.</p>
<img :src="screenshot_0878" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:14:23 --- Например, web1. Создадим папку node1. Сначала по поводу самого <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">package.json</code> и разного типа файлов, которые здесь теоретически могут быть. Вот <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">npm init -y</code>, чтобы package.json стандартный нам сделали. Пока что ничего существенного мы тут не видим.</p>
<hr class="border-border-200 border-t-0.5 my-3 mx-1.5">
<h2 class="text-text-100 mt-3 -mb-1 text-[1.125rem] font-bold">Дополнительные объяснения</h2>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">EventLoop (Цикл событий)</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">EventLoop</code> — это механизм в Node.js, который управляет выполнением асинхронных операций. Благодаря EventLoop программа может продолжать работу во время ожидания результатов внешних операций, таких как запросы к базе данных, чтение файлов или сетевые запросы. Это ключевая особенность Node.js, которая позволяет эффективно обрабатывать множество одновременных операций, несмотря на однопоточность JavaScript.</p>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">Promises (Промисы)</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Промисы</code> — это объекты JavaScript для работы с асинхронным кодом. Они представляют результат операции, который будет доступен в будущем. Промис может находиться в трёх состояниях: ожидание (pending), успешное выполнение (fulfilled) или ошибка (rejected). Это более удобная альтернатива callback-функциям для работы с асинхронностью.</p>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">SSR - Server-Side Rendering (Серверный рендеринг)</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">SSR (Server-Side Rendering)</code> — технология генерации HTML-страниц на сервере вместо клиента. При SSR сервер получает запрос, выполняет все необходимые операции (получение данных, рендеринг компонентов), формирует полноценную HTML-страницу и отправляет её клиенту. Это улучшает SEO и ускоряет первую загрузку страницы.</p>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">SPA - Single Page Application (Одностраничное приложение)</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">SPA (Single Page Application)</code> — веб-приложение, которое работает внутри одной HTML-страницы и динамически обновляет контент без перезагрузки страницы. Вместо загрузки новых страниц с сервера SPA подгружает данные через API и перерисовывает части интерфейса с помощью JavaScript.</p>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">BFF - Backend for Frontend</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">BFF (Backend for Frontend)</code> — архитектурный паттерн, где создаётся отдельный backend-слой специально для нужд конкретного frontend-приложения. BFF часто выступает прослойкой между фронтендом и множественными микросервисами или API, агрегируя данные и предоставляя единый удобный интерфейс для клиента.</p>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">V8 Engine (Движок V8)</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">V8</code> — это движок JavaScript от Google, который компилирует JavaScript-код в машинный код для быстрого выполнения. V8 используется в браузере Google Chrome и в Node.js. Именно благодаря V8 Node.js может выполнять JavaScript-код на сервере с высокой производительностью.</p>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">WebSocket (Веб-сокеты)</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">WebSocket</code> — это протокол для установления двусторонней связи между клиентом и сервером в режиме реального времени. В отличие от обычных HTTP-запросов, WebSocket создаёт постоянное соединение, через которое сервер может отправлять данные клиенту в любой момент без запроса. Идеально подходит для чатов, онлайн-игр, биржевых котировок.</p>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">Real-time Applications (Приложения реального времени)</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Real-time</code> приложения — это приложения, обеспечивающие мгновенную или почти мгновенную передачу данных между сервером и клиентом. Примеры: чаты, совместное редактирование документов, онлайн-игры, уведомления в социальных сетях. Node.js отлично подходит для создания таких приложений благодаря встроенной асинхронности.</p>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">Laravel</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Laravel</code> — один из самых популярных PHP-фреймворков для веб-разработки. Предоставляет элегантный синтаксис, ORM для работы с базами данных (Eloquent), систему маршрутизации, шаблонизатор Blade и множество других инструментов для быстрой разработки веб-приложений.</p>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">TypeScript</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">TypeScript</code> — это надстройка над JavaScript, добавляющая статическую типизацию. TypeScript компилируется в обычный JavaScript, но в процессе разработки позволяет отлавливать ошибки типов, предоставляет автодополнение в IDE и делает код более предсказуемым и документированным. Особенно полезен в больших проектах.</p>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">npm - Node Package Manager</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">npm</code> — менеджер пакетов для JavaScript, используемый для установки и управления зависимостями проекта. С помощью npm можно устанавливать библиотеки из публичного репозитория, публиковать свои пакеты, управлять версиями зависимостей и запускать скрипты сборки.</p>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">Decorators (Декораторы)</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Декораторы</code> — специальная синтаксическая конструкция в TypeScript для модификации классов и их членов. Декораторы позволяют добавлять метаданные, изменять поведение методов, свойств или классов декларативным способом. Активно используются в фреймворках типа NestJS для определения маршрутов, внедрения зависимостей и валидации.</p>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">NestJS</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">NestJS</code> — современный фреймворк для Node.js, построенный с использованием TypeScript и вдохновлённый Angular. NestJS предоставляет структурированную архитектуру, использует декораторы для описания логики, поддерживает внедрение зависимостей и модульную структуру. Идеально подходит для создания масштабируемых серверных приложений.</p>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">Fibers в PHP</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Файберы (Fibers)</code> — относительно новый механизм в PHP (появился в версии 8.1) для создания лёгковесных потоков выполнения. Файберы позволяют приостанавливать и возобновлять выполнение кода, что даёт возможность реализовать асинхронное программирование, похожее на async/await в JavaScript.</p>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">Suspense Component</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Suspense</code> — компонент в React (и экспериментальный в Vue) для управления асинхронной загрузкой данных и компонентов. Suspense позволяет показывать fallback-контент (например, лоадер или скелетон) пока загружаются данные, и автоматически заменяет его на готовый контент после загрузки.</p>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">ES Modules (ES-модули)</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">ES-модули (ECMAScript Modules)</code> — стандартная система модулей JavaScript, использующая синтаксис <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">import</code> и <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">export</code>. ES-модули позволяют разделить код на отдельные файлы и явно указывать зависимости между ними. В Node.js поддержка ES-модулей появилась в версии 13, и теперь можно использовать их наравне с классической системой CommonJS (require/module.exports).</p>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">Top-level async/await</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Top-level async/await</code> — возможность использовать <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">async/await</code> на верхнем уровне модуля без необходимости оборачивать код в асинхронную функцию. До этой возможности (появилась в Node.js v14) приходилось создавать IIFE (immediately invoked function expression) для использования await. Теперь можно писать <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">await</code> прямо в начале файла при использовании ES-модулей.</p>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">Array.with()</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Array.with()</code> — метод JavaScript, добавленный в стандарт ECMAScript 2023. Этот метод создаёт новую копию массива с изменённым элементом по указанному индексу, не мутируя исходный массив. Синтаксис: <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">array.with(index, value)</code>. Особенно полезен в React и других библиотеках, где важна иммутабельность данных.</p>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">package.json</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">package.json</code> — конфигурационный файл Node.js проекта. Содержит метаданные о проекте (название, версия, автор), список зависимостей (<code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">dependencies</code> и <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">devDependencies</code>), скрипты для запуска различных команд (<code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">scripts</code>), настройки для публикации в npm и другую важную информацию. Это основной файл, который определяет структуру Node.js приложения.</p>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">Webpack и Vite</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Webpack</code> — универсальный сборщик модулей для JavaScript-проектов. Webpack анализирует зависимости, объединяет модули в бандлы, применяет трансформации через лоадеры и плагины. Очень мощный, но может быть сложным в настройке.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Vite</code> — современный инструмент сборки с очень быстрой пересборкой в режиме разработки. Использует нативные ES-модули браузера для мгновенного запуска dev-сервера и ESBuild для быстрой сборки. Гораздо быстрее и проще в настройке, чем Webpack, но менее гибкий для сложных кейсов.</p>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">Critical CSS (Критический CSS)</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Критический CSS</code> — минимальный набор стилей, необходимых для отображения видимой части страницы (above-the-fold content), которую видит пользователь без прокрутки. Критический CSS загружается первым и встраивается прямо в HTML, что позволяет браузеру мгновенно отрисовать важный контент, пока остальные стили загружаются асинхронно. Это значительно ускоряет воспринимаемую скорость загрузки сайта.</p></div></div><div><div class="standard-markdown grid-cols-1 grid gap-4 [&amp;_&gt;_*]:min-w-0 !gap-3.5"><h1 class="text-text-100 mt-3 -mb-1 text-[1.375rem] font-bold">Лекция по изучению Node.js. Урок 1. Продолжение.</h1>
<h2 class="text-text-100 mt-3 -mb-1 text-[1.125rem] font-bold">Отредактированный транскрипт</h2>
<img :src="screenshot_0890" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:14:49 --- Создаю новый файл, например, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">index.js</code>. Буду его из консоли запускать командой <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">node index.js</code>. Да, то есть если пишем там любую команду, давайте для порядка — я понимаю, что это слишком просто для вас, для всех, но ради порядка надо сделать hello world. Видим, что программа завершилась. Это очень важно. Запомните этот момент, что программа завершилась сама, без вызова каких-то операций типа <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">process.exit()</code> и других методов.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:15:17 --- И, соответственно, если попробую сейчас делать какой-нибудь файл, который назову, там, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">sample.js</code>, здесь напишу такой радостный <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">export default function</code>, ну, допустим, тоже вот этот самый <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">console.log("hello world")</code>, да.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:15:43 --- Далее в индексе такой радостный напишу <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">import</code> условно <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">high</code> from <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">sample</code> или <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">sample.js</code> и запишу здесь <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">high()</code>, то вот вопрос — что произойдет? Такой непраздный. То есть вроде у нас есть версии ноды, поддержка <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">ES-модулей</code> давным-давно с 13 ветки, но не так просто.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:16:13 --- Модули разрешены либо в тех файлах, которые идут с расширением <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">.mjs</code>. По дефолту Илья правильно пишет, что это действительно модули <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">CommonJS</code> все равно включены. И если хотим, чтобы у нас работали модули ES6, мы должны расширение поменять на <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">.mjs</code>. Вот, например.</p>
<img :src="screenshot_1011" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:16:37 --- Но тут, правда, еще и сами импорты надо прописать правильно, потому что у меня пути оказались неверные, а вот так — видим, заработало как надо, да. Значит, в ноде при импорте модуля можно не указывать расширение. Да, можно не указывать расширение, тогда система сначала ищет папку. Если находит папку, в ней ищет <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">index.js</code>. Если папки нет, то ищет файл и пытается добавить расширение <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">.js</code>. Но, по-моему, в интервью создатель ноды еще несколько лет назад сказал, что один пункт, про который он жалеет — это то, что разрешен импорт неявный.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:17:13 --- Да, что можем написать sample, и это непонятно что. Папка sample, файл sample с каким расширением. И что он типа хочет это все переделать, в идеале бы — он уже другим языком каким-то занимается давно, но если бы делал это заново, то он бы хотел, чтобы только явное указание работало. И в принципе сейчас, когда тот же VS Code делает автоподстановку при импорте каких-то сущностей, всегда указывается все целиком, поэтому я тоже буду указывать путь так, даже несмотря на то, что sample сработал бы.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:17:48 --- Просьба плюсами подтвердить, если понятна эта идея, эта мысль. Да, что он будет работать, но мы не будем так делать. Мы хотим явно указывать. Хотя это и не столь принципиально. Так, да, разница <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Event Loop</code> и Node Express.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:18:07 --- Пользователь ждет ответа. Вот, кстати, такой пример мы сегодня даже планируем рассмотреть, рассуждая про <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Event Loop</code>, так что складки вопросов еще к нам придут. Вот, конечно, все файлы называть <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">.mjs</code> неохота. А если у тебя они <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">.ts</code> называются, их что, называть <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">.mts</code>, что ли? Это как-то странно будет выглядеть. Да и в принципе неохота писать <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">.mjs</code>. И для того, чтобы у нас по дефолту работал новый вид импортов, мы должны в <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">package.json</code> проставить <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">type: "module"</code>.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:18:42 --- И тогда у нас все будет прекрасно. Главное теперь правильно написать пути. Вот запускаю <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">node index.js</code>, видим, что все работает шикарно.</p>
<img :src="screenshot_1171" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:18:54 --- Если нам вдруг, по какой-то причине, надо сделать файл, который будет работать по старинке — хотим оттуда сделать <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">module.exports</code> — то мы не можем его назвать <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">old.js</code>, потому что если в нем напишу <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">module.exports</code>, и оно если и будет работать, то со скрипом, а можно сказать вообще, что переменная <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">module</code> не найдена. То есть, давайте сейчас попробую в индексе импортнуть вот этот самый, давайте <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">* as Nz</code> напишем, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">from "old.js"</code>. Вот, и видите: <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">module is not defined in ES-module scope</code>.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:19:33 --- То есть, система говорит: товарищи, я в ES-модулях работаю, что за слово <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">module</code> вообще, я такого не знаю. Вот, если у нас включена модульная система, то чтобы включить <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">CommonJS</code>, где-то файл называем <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">.cjs</code>. Ну, логично, сокращение от CommonJS идет. Вот, и теперь оно относительно нормально будет работать. Да, когда напишу <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">console.log(Nz)</code>, например, то, видите, он вернул объект какого-то класса <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Module</code> с прототипом.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:20:03 --- И можем у него вручную обратиться к ключику, например, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">default</code>. И по вот этому ключу получить все, что было в <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">module.exports</code> записано. Иногда можно воспользоваться динамической функцией <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">import()</code>, но когда такая необходимость возникает? Она возникает крайне редко, да, делать <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">.cjs</code> файлы. Либо когда бандлер, который используем, требует прописать конфиг именно в старом стиле.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:20:30 --- Вот не знаю как сейчас, в начале года Tailwind, по-моему, еще хотел, чтобы для него настройки в старом стиле, в <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">CommonJS</code> виде прописывали. <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Tailwind.config.cjs</code> файлом делать приходилось, если <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">type: "module"</code> включили. В Vite, например. Еще бывают какие-то старые пакеты. Например, там какой-нибудь условный, не знаю, critical-css, который обновлялся в последний раз непонятно когда.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:20:56 --- И его еще написали в стиле <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">CommonJS</code>, и тебе надо его в новом стиле запустить. То есть бывают такие перекосы, но это больше ради истории и все. То есть не думаю, что вам придется активно как-то <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">CommonJS</code> файлы реализовывать. Поэтому давайте просто назовем эту папку <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">sample0</code>. Папка далеко не самая актуальная.</p>
<img :src="screenshot_1290" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:21:26 --- И туда все вот эти вот вещи уберу. Просьба плюсами подтвердить, если этот момент полностью понятен. То есть стремимся к новым стандартам, мы конечно <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">type: "module"</code> пропишем. Нам гораздо приятнее с ES-модулями работать, чем с <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">CommonJS</code> модулями. ES-модули они просто лучше вроде как, новее.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:21:50 --- Поэтому к ним стремимся. Но не сказать, что это сильно принципиальный вопрос. А значит, теперь давайте разбираться с некой базой. А база заключается в следующем. Показывал, что если напишу <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">console.log("hello world")</code>, то программа начнет работать, и после того, как она выполнит свои задачи, она завершится.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:22:24 --- Но вот возникает вопрос, а как себя программа будет вести, если, допустим, она будет написана вот так. <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Function showHello()</code>, которая, например, запускается сразу, и она, допустим, выводит <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">console.log("hello world")</code>, и она пишет там условно <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">setTimeout(showHello, 3000)</code>.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:22:54 --- Вот, допустим, такой код. Значит, пишу <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">node 1-base.js</code>. И давайте просто смотреть, когда эта программа завершится. Жду ваших предложений. Что можете сказать на этот счет?</p>
<img :src="screenshot_1400" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:23:15 --- Как бы нам дождаться момента завершения программы? Так, никогда. Да. Действительно. Только Ctrl+C, пожалуй, такую программу может завершить. Это верно. То есть суть в том, что в этой программе никогда не остается ноль активных задач.</p>
<img :src="screenshot_1436" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:23:41 --- Всегда ее чем-то дополнительно нагружают. Вот. И увидев этот пример, можем как раз перейти к разговору о том, как в принципе в ноде устроен жизненный цикл программы. И перейти к такому понятию как <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Event Loop</code>. Значит, вот смотрите, нод он однопоточный или многопоточный? Кто что слышал на этот счет?</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:24:09 --- Так, однопоточный. Да, JavaScript у нас тоже однопоточный. Теоретически можно запустить какую-то отдельную задачу в новом потоке за счет веб-воркеров. В JavaScript это класс <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">WebWorker</code>, в Node.js есть такой модуль отдельный, который называется <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">WorkerThreads</code>, поэтому можно какие-то вычисления вынести на отдельное ядро. Но сама программа, которую пишем без хитростей дополнительных, она, конечно, работает в одном потоке.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:24:42 --- И работает она в одном потоке, но есть асинхронные операции. Они есть за счет вот этого так называемого <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Event Loop</code>. И <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Event Loop</code>, если будем описывать, можем представить себе примерно следующую картину. Давайте вот, может его проще будет понять на основе чистого JavaScript. Хотя с нодом тут разница не особо большая.</p>
<img :src="screenshot_1518" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:25:05 --- У нас есть в JavaScript какие-то строчки синхронного кода просто. Это как правило вопросов не вызывает. Вот там синхронный код — функцию объявили, вот синхронный код — функцию вызвали. Это все выполняется абсолютно всегда. Весь <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">call stack</code> функций, которые синхронно были вызваны — это все работает без каких-либо хитростей. А что происходит дальше?</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:25:32 --- Дальше есть такое понятие как <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Event Loop</code>. Давайте даже не будем какое-то определение давать, это просто некоторая сущность, которая... Нарисуем вот такой бесконечный круг выполнения задач. И есть два вида задач, скажем так. Ну, опять же, нас именно чем <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">макротаски</code> от <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">микротасков</code> отличаются сейчас не сильно интересует.</p>
<img :src="screenshot_1582" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:26:00 --- Но условно есть <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">макротаски</code>, есть <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">микротаски</code>. Это то, что не связано напрямую с синхронным кодом. То есть смотрите, вот например, шел-шел-шел синхронный код. Далее где-то увидели <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">setTimeout</code>. Что это означает? Это значит, что был добавлен новый <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">макротаск</code>. И что такое <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Event Loop</code> тогда?</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:26:30 --- <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Event Loop</code> — это принцип выполнения такой программы. То, что сначала выполнится весь синхронный код, если весь синхронный код закончился, про <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">микротаски</code> не думаем, давайте пока вот это временно закрываем мысленно. Вот синхронный код закончил свое выполнение. Если ни <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">макротасков</code>, ни <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">микротасков</code> назначенных нет — программа завершается. И вот, кстати, первое отличие от JavaScript, который живет в браузере.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:26:58 --- В браузере наша программа не завершается. Когда <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Event Loop</code> опустел, он просто остановился и ждет. Ну, пока человек новое действие какое-то совершит. Ничего никуда не удаляется, процесс не свернут. В ноде, если синхронный код выполнился, и система видит, что не осталось активных ни одного ни <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">макротаска</code>, ни <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">микротаска</code> — это означает, что просто программа завершается.</p>
<img :src="screenshot_1645" alt="Image" >
<img :src="screenshot_1659" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:27:22 --- И вот как раз первый вариант, который был написан, да, если вот так вот здесь поставим комментарий, то что тогда будет происходить? У нас функция была вызвана, синхронный код завершился, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">макротасков</code>, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">микротасков</code> в очереди нет. И <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Event Loop</code> когда — ну да, что такое <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Event Loop</code>? Вот он синхронный код выполнил, да, смотрит: так, новый <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">макротаск</code> есть?</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:27:49 --- Ага, нету <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">макротаска</code>, все, я пошел отдыхать. Если <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">макротаск</code> какой-то есть, берет один <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">макротаск</code>, начинает его выполнять. Внутри <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">макротаска</code> могут быть <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">микротаски</code>, о них позже. И получается, что <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Event Loop</code> — это процесс выполнения всего этого добра. То есть взял <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">макротаск</code>, разрешил его. Если <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">макротаск</code> какой-то готов разрешиться, например, таймаут назначен — это <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">макротаск</code>. И вот три секунды прошло, этот <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">макротаск</code> получается готов запустить какой-то пул нового синхронного кода.</p>
<img :src="screenshot_1722" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:28:21 --- И соответственно, значит, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Event Loop</code> берет этот <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">макротаск</code> разрешенный и из него запускает всю синхронщину. И вот это вот повторяется бесконечно, пока у нас не иссякнет пул вот этих самых накопленных <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">макротасков</code>. И, соответственно, наша программа живет вечно. Почему? Потому что сейчас в памяти программы висит то, что есть один <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">макротаск</code>, которого надо подождать.</p>
<img :src="screenshot_1739" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:28:47 --- Спустя 3 секунды он резолвится, этот <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">макротаск</code>, выводится <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">console.log</code> — это синхронный код, затем назначается новый <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">макротаск</code>. И получается программа живет бесконечно, потому что <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">console.log</code> вывелся, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">setTimeout</code> добавил новый <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">макротаск</code>, через 3 секунды <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Event Loop</code> его обрабатывает, и идем по вот этому кругу. Просьба плюсами подтвердить, если понятны первичные термины и понятно, почему наша программа не завершилась. Потому что не даем перечню активных <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">макротасков</code> опустеть.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:29:19 --- Каждый раз, когда <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">макротаск</code> завершается, соответственно новый <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">макротаск</code> приходит на его место. К <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">макротаскам</code> что можно отнести? Вот если говорим про какие-то общие вещи для JavaScript и для ноды, то это безусловно таймауты и интервалы. Вот так вот их обозову: TI — timeout, interval.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:29:45 --- Это, безусловно, операции, связанные с Request/Response. Соответственно, запрос на сервер, получение ответа от сервера. Это то, что приводит к операциям, которых ждем. Операциям, у которых, по сути, есть некие коллбеки по смыслу. Теперь Request/Response — они могут быть и в Node, и в JavaScript обычном, потому что это запросы на уровне клиент-сервер или сервер-сервер, это неважно.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:30:17 --- В JavaScript, по сути, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">макротасками</code> у нас получаются все вещи, связанные с браузерным API. Ведь в самом JavaScript нет никакого отсчета времени, ничего такого. Это все есть в браузерном API. То есть <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">setTimeout</code>, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">setInterval</code> — это функции браузерного API. И чтобы понять, что в чистом JavaScript может к таким <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">макротаскам</code> приводить, мы должны просто нагуглить Browser API, и вот будет полный перечень.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:30:42 --- Из того, что в ноде специфично относительно JavaScript — это, конечно, файловая операция, да, файл с input и output. Когда делаем <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">fs.readFile</code>, например, или <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">fs.writeFile</code> — это так или иначе приводит к созданию нового <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">макротаска</code>.</p>
<hr class="border-border-200 border-t-0.5 my-3 mx-1.5">
<h2 class="text-text-100 mt-3 -mb-1 text-[1.125rem] font-bold">Дополнительные объяснения</h2>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">1. Микротаски и макротаски: в чем разница?</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Макротаски</strong> — это задачи, которые выполняются в основном цикле <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Event Loop</code>. Каждая итерация <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Event Loop</code> обрабатывает только один <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">макротаск</code> из очереди.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">Примеры <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">макротасков</code>:</p>
<ul class="[li_&amp;]:mb-0 [li_&amp;]:mt-1.5 [li_&amp;]:gap-1.5 [&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-disc flex flex-col gap-2 pl-8 mb-3">
<li class="whitespace-normal break-words pl-2"><code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">setTimeout()</code> и <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">setInterval()</code></li>
<li class="whitespace-normal break-words pl-2">Операции ввода-вывода (I/O операции)</li>
<li class="whitespace-normal break-words pl-2"><code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">fs.readFile()</code>, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">fs.writeFile()</code> в Node.js</li>
<li class="whitespace-normal break-words pl-2">Запросы к серверу (Request/Response)</li>
<li class="whitespace-normal break-words pl-2">UI-рендеринг в браузере</li>
</ul>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Микротаски</strong> — это задачи, которые выполняются сразу после завершения текущего <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">макротаска</code>, но <strong>до</strong> перехода к следующему <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">макротаску</code>. Все <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">микротаски</code> из очереди выполняются за один проход.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">Примеры <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">микротасков</code>:</p>
<ul class="[li_&amp;]:mb-0 [li_&amp;]:mt-1.5 [li_&amp;]:gap-1.5 [&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-disc flex flex-col gap-2 pl-8 mb-3">
<li class="whitespace-normal break-words pl-2">Промисы (<code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">.then()</code>, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">.catch()</code>, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">.finally()</code>)</li>
<li class="whitespace-normal break-words pl-2"><code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">queueMicrotask()</code> функция</li>
<li class="whitespace-normal break-words pl-2"><code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">process.nextTick()</code> в Node.js (выполняется даже раньше других микротасков!)</li>
<li class="whitespace-normal break-words pl-2">Mutation Observer в браузере</li>
</ul>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Порядок выполнения:</strong></p>
<ol class="[li_&amp;]:mb-0 [li_&amp;]:mt-1.5 [li_&amp;]:gap-1.5 [&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-decimal flex flex-col gap-2 pl-8 mb-3">
<li class="whitespace-normal break-words pl-2">Выполняется весь синхронный код</li>
<li class="whitespace-normal break-words pl-2">Выполняются все <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">микротаски</code> из очереди</li>
<li class="whitespace-normal break-words pl-2">Берется один <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">макротаск</code> и выполняется</li>
<li class="whitespace-normal break-words pl-2">Снова выполняются все <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">микротаски</code></li>
<li class="whitespace-normal break-words pl-2">Процесс повторяется</li>
</ol>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Пример:</strong></p>
<div class="relative group/copy bg-bg-000/50 border-0.5 border-border-400 rounded-lg"><div class="sticky opacity-0 group-hover/copy:opacity-100 top-2 py-2 h-12 w-0 float-right"><div class="absolute right-0 h-8 px-2 items-center inline-flex z-10"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)] h-8 w-8 rounded-md active:scale-95 backdrop-blur-md Button_ghost__BUAoh" type="button" aria-label="Copy to clipboard" data-state="closed"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 transition-all opacity-100 scale-100" aria-hidden="true"><path d="M12.5 3C13.3284 3 14 3.67157 14 4.5V6H15.5C16.3284 6 17 6.67157 17 7.5V15.5C17 16.3284 16.3284 17 15.5 17H7.5C6.67157 17 6 16.3284 6 15.5V14H4.5C3.67157 14 3 13.3284 3 12.5V4.5C3 3.67157 3.67157 3 4.5 3H12.5ZM14 12.5C14 13.3284 13.3284 14 12.5 14H7V15.5C7 15.7761 7.22386 16 7.5 16H15.5C15.7761 16 16 15.7761 16 15.5V7.5C16 7.22386 15.7761 7 15.5 7H14V12.5ZM4.5 4C4.22386 4 4 4.22386 4 4.5V12.5C4 12.7761 4.22386 13 4.5 13H12.5C12.7761 13 13 12.7761 13 12.5V4.5C13 4.22386 12.7761 4 12.5 4H4.5Z"></path></svg></div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 absolute top-0 left-0 transition-all opacity-0 scale-50" aria-hidden="true"><path d="M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"></path></svg></div></div></button></div></div><div class="text-text-500 font-small p-3.5 pb-0">javascript</div><div><pre class="code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border-radius: 0.3em;"><code class="language-javascript" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none;"><span><span class="token console" style="color: rgb(209, 154, 102);">console</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">log</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(152, 195, 121);">'1 - синхронный код'</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span>
</span><span><span></span><span class="token" style="color: rgb(97, 175, 239);">setTimeout</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token arrow" style="color: rgb(97, 175, 239);">=&gt;</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>
</span></span><span><span>  </span><span class="token console" style="color: rgb(209, 154, 102);">console</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">log</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(152, 195, 121);">'2 - макротаск'</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span>
</span><span><span></span><span class="token known-class-name" style="color: rgb(209, 154, 102);">Promise</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">resolve</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">then</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token arrow" style="color: rgb(97, 175, 239);">=&gt;</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>
</span></span><span><span>  </span><span class="token console" style="color: rgb(209, 154, 102);">console</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">log</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(152, 195, 121);">'3 - микротаск'</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span>
</span><span><span></span><span class="token console" style="color: rgb(209, 154, 102);">console</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">log</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(152, 195, 121);">'4 - синхронный код'</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span>
</span><span><span></span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// Вывод: 1, 4, 3, 2</span></span></code></pre></div></div>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">2. Call Stack (Стек вызовов)</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Call stack</code> — это стек вызовов функций, где хранится информация о текущих выполняющихся функциях в порядке их вызова. Работает по принципу LIFO (Last In, First Out — последним пришел, первым ушел).</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">Когда функция вызывается, она добавляется на вершину стека. Когда функция завершает выполнение, она удаляется из стека. JavaScript является однопоточным языком, поэтому имеет только один <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">call stack</code>.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Пример:</strong></p>
<div class="relative group/copy bg-bg-000/50 border-0.5 border-border-400 rounded-lg"><div class="sticky opacity-0 group-hover/copy:opacity-100 top-2 py-2 h-12 w-0 float-right"><div class="absolute right-0 h-8 px-2 items-center inline-flex z-10"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)] h-8 w-8 rounded-md active:scale-95 backdrop-blur-md Button_ghost__BUAoh" type="button" aria-label="Copy to clipboard" data-state="closed"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 transition-all opacity-100 scale-100" aria-hidden="true"><path d="M12.5 3C13.3284 3 14 3.67157 14 4.5V6H15.5C16.3284 6 17 6.67157 17 7.5V15.5C17 16.3284 16.3284 17 15.5 17H7.5C6.67157 17 6 16.3284 6 15.5V14H4.5C3.67157 14 3 13.3284 3 12.5V4.5C3 3.67157 3.67157 3 4.5 3H12.5ZM14 12.5C14 13.3284 13.3284 14 12.5 14H7V15.5C7 15.7761 7.22386 16 7.5 16H15.5C15.7761 16 16 15.7761 16 15.5V7.5C16 7.22386 15.7761 7 15.5 7H14V12.5ZM4.5 4C4.22386 4 4 4.22386 4 4.5V12.5C4 12.7761 4.22386 13 4.5 13H12.5C12.7761 13 13 12.7761 13 12.5V4.5C13 4.22386 12.7761 4 12.5 4H4.5Z"></path></svg></div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 absolute top-0 left-0 transition-all opacity-0 scale-50" aria-hidden="true"><path d="M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"></path></svg></div></div></button></div></div><div class="text-text-500 font-small p-3.5 pb-0">javascript</div><div><pre class="code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border-radius: 0.3em;"><code class="language-javascript" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none;"><span><span class="token" style="color: rgb(198, 120, 221);">function</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">first</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(97, 175, 239);">second</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span><span>  </span><span class="token console" style="color: rgb(209, 154, 102);">console</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">log</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(152, 195, 121);">'Первая функция'</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(171, 178, 191);">}</span><span>
</span></span><span>
</span><span><span></span><span class="token" style="color: rgb(198, 120, 221);">function</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">second</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(97, 175, 239);">third</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span><span>  </span><span class="token console" style="color: rgb(209, 154, 102);">console</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">log</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(152, 195, 121);">'Вторая функция'</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(171, 178, 191);">}</span><span>
</span></span><span>
</span><span><span></span><span class="token" style="color: rgb(198, 120, 221);">function</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">third</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>
</span></span><span><span>  </span><span class="token console" style="color: rgb(209, 154, 102);">console</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">log</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(152, 195, 121);">'Третья функция'</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(171, 178, 191);">}</span><span>
</span></span><span>
</span><span><span></span><span class="token" style="color: rgb(97, 175, 239);">first</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span>
</span><span><span></span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// Call stack последовательно:</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// [first] → [first, second] → [first, second, third] → </span><span>
</span></span><span><span></span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// [first, second] → [first] → []</span></span></code></pre></div></div>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">3. Browser API (Браузерное API)</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">Browser API — это набор интерфейсов, предоставляемых браузером для взаимодействия с веб-страницей и окружением браузера. Эти функции <strong>не являются частью</strong> чистого JavaScript, а предоставляются браузерным окружением.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Основные категории Browser API:</strong></p>
<ul class="[li_&amp;]:mb-0 [li_&amp;]:mt-1.5 [li_&amp;]:gap-1.5 [&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-disc flex flex-col gap-2 pl-8 mb-3">
<li class="whitespace-normal break-words pl-2"><strong>Таймеры:</strong> <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">setTimeout()</code>, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">setInterval()</code>, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">clearTimeout()</code>, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">clearInterval()</code></li>
<li class="whitespace-normal break-words pl-2"><strong>DOM манипуляция:</strong> <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">document.getElementById()</code>, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">element.addEventListener()</code>, и т.д.</li>
<li class="whitespace-normal break-words pl-2"><strong>Fetch API:</strong> <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">fetch()</code> для HTTP-запросов</li>
<li class="whitespace-normal break-words pl-2"><strong>Console API:</strong> <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">console.log()</code>, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">console.error()</code> и другие</li>
<li class="whitespace-normal break-words pl-2"><strong>Storage API:</strong> <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">localStorage</code>, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">sessionStorage</code></li>
<li class="whitespace-normal break-words pl-2"><strong>Geolocation API:</strong> получение координат пользователя</li>
<li class="whitespace-normal break-words pl-2"><strong>Canvas API:</strong> рисование графики</li>
<li class="whitespace-normal break-words pl-2"><strong>Web Audio API:</strong> работа со звуком</li>
</ul>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">В Node.js вместо Browser API есть свои модули: <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">fs</code> для файлов, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">http</code> для серверов, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">path</code> для путей и т.д.</p>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">4. Конфигурация package.json для ES-модулей</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">Чтобы использовать ES-модули (import/export) по умолчанию во всех <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">.js</code> файлах проекта, нужно добавить в <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">package.json</code>:</p>
<div class="relative group/copy bg-bg-000/50 border-0.5 border-border-400 rounded-lg"><div class="sticky opacity-0 group-hover/copy:opacity-100 top-2 py-2 h-12 w-0 float-right"><div class="absolute right-0 h-8 px-2 items-center inline-flex z-10"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)] h-8 w-8 rounded-md active:scale-95 backdrop-blur-md Button_ghost__BUAoh" type="button" aria-label="Copy to clipboard" data-state="closed"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 transition-all opacity-100 scale-100" aria-hidden="true"><path d="M12.5 3C13.3284 3 14 3.67157 14 4.5V6H15.5C16.3284 6 17 6.67157 17 7.5V15.5C17 16.3284 16.3284 17 15.5 17H7.5C6.67157 17 6 16.3284 6 15.5V14H4.5C3.67157 14 3 13.3284 3 12.5V4.5C3 3.67157 3.67157 3 4.5 3H12.5ZM14 12.5C14 13.3284 13.3284 14 12.5 14H7V15.5C7 15.7761 7.22386 16 7.5 16H15.5C15.7761 16 16 15.7761 16 15.5V7.5C16 7.22386 15.7761 7 15.5 7H14V12.5ZM4.5 4C4.22386 4 4 4.22386 4 4.5V12.5C4 12.7761 4.22386 13 4.5 13H12.5C12.7761 13 13 12.7761 13 12.5V4.5C13 4.22386 12.7761 4 12.5 4H4.5Z"></path></svg></div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 absolute top-0 left-0 transition-all opacity-0 scale-50" aria-hidden="true"><path d="M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"></path></svg></div></div></button></div></div><div class="text-text-500 font-small p-3.5 pb-0">json</div><div><pre class="code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border-radius: 0.3em;"><code class="language-json" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none;"><span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(224, 108, 117);">"name"</span><span class="token" style="color: rgb(97, 175, 239);">:</span><span> </span><span class="token" style="color: rgb(152, 195, 121);">"my-nodejs-project"</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(224, 108, 117);">"version"</span><span class="token" style="color: rgb(97, 175, 239);">:</span><span> </span><span class="token" style="color: rgb(152, 195, 121);">"1.0.0"</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(224, 108, 117);">"type"</span><span class="token" style="color: rgb(97, 175, 239);">:</span><span> </span><span class="token" style="color: rgb(152, 195, 121);">"module"</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(224, 108, 117);">"main"</span><span class="token" style="color: rgb(97, 175, 239);">:</span><span> </span><span class="token" style="color: rgb(152, 195, 121);">"index.js"</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(224, 108, 117);">"scripts"</span><span class="token" style="color: rgb(97, 175, 239);">:</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(224, 108, 117);">"start"</span><span class="token" style="color: rgb(97, 175, 239);">:</span><span> </span><span class="token" style="color: rgb(152, 195, 121);">"node index.js"</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(171, 178, 191);">}</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(171, 178, 191);">}</span></span></code></pre></div></div>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Ключевой параметр:</strong> <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">"type": "module"</code></p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">После добавления этого параметра:</p>
<ul class="[li_&amp;]:mb-0 [li_&amp;]:mt-1.5 [li_&amp;]:gap-1.5 [&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-disc flex flex-col gap-2 pl-8 mb-3">
<li class="whitespace-normal break-words pl-2">Все <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">.js</code> файлы работают как ES-модули</li>
<li class="whitespace-normal break-words pl-2">Для использования CommonJS нужно переименовать файлы в <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">.cjs</code></li>
<li class="whitespace-normal break-words pl-2">В импортах нужно указывать расширения файлов: <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">import func from './module.js'</code></li>
</ul>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">5. WorkerThreads — многопоточность в Node.js</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">WorkerThreads</code> — встроенный модуль Node.js для запуска JavaScript кода в отдельных потоках. Позволяет выполнять CPU-интенсивные операции, не блокируя основной поток.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Когда использовать:</strong></p>
<ul class="[li_&amp;]:mb-0 [li_&amp;]:mt-1.5 [li_&amp;]:gap-1.5 [&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-disc flex flex-col gap-2 pl-8 mb-3">
<li class="whitespace-normal break-words pl-2">Сложные математические вычисления</li>
<li class="whitespace-normal break-words pl-2">Обработка больших объемов данных</li>
<li class="whitespace-normal break-words pl-2">Шифрование/дешифрование</li>
<li class="whitespace-normal break-words pl-2">Обработка изображений</li>
</ul>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Простой пример:</strong></p>
<div class="relative group/copy bg-bg-000/50 border-0.5 border-border-400 rounded-lg"><div class="sticky opacity-0 group-hover/copy:opacity-100 top-2 py-2 h-12 w-0 float-right"><div class="absolute right-0 h-8 px-2 items-center inline-flex z-10"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)] h-8 w-8 rounded-md active:scale-95 backdrop-blur-md Button_ghost__BUAoh" type="button" aria-label="Copy to clipboard" data-state="closed"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 transition-all opacity-100 scale-100" aria-hidden="true"><path d="M12.5 3C13.3284 3 14 3.67157 14 4.5V6H15.5C16.3284 6 17 6.67157 17 7.5V15.5C17 16.3284 16.3284 17 15.5 17H7.5C6.67157 17 6 16.3284 6 15.5V14H4.5C3.67157 14 3 13.3284 3 12.5V4.5C3 3.67157 3.67157 3 4.5 3H12.5ZM14 12.5C14 13.3284 13.3284 14 12.5 14H7V15.5C7 15.7761 7.22386 16 7.5 16H15.5C15.7761 16 16 15.7761 16 15.5V7.5C16 7.22386 15.7761 7 15.5 7H14V12.5ZM4.5 4C4.22386 4 4 4.22386 4 4.5V12.5C4 12.7761 4.22386 13 4.5 13H12.5C12.7761 13 13 12.7761 13 12.5V4.5C13 4.22386 12.7761 4 12.5 4H4.5Z"></path></svg></div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 absolute top-0 left-0 transition-all opacity-0 scale-50" aria-hidden="true"><path d="M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"></path></svg></div></div></button></div></div><div class="text-text-500 font-small p-3.5 pb-0">javascript</div><div><pre class="code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border-radius: 0.3em;"><code class="language-javascript" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none;"><span><span class="token" style="color: rgb(198, 120, 221);">const</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span> </span><span class="token maybe-class-name">Worker</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">}</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">require</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(152, 195, 121);">'worker_threads'</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span>
</span><span><span></span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// Создание воркера</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(198, 120, 221);">const</span><span> worker </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">new</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">Worker</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(152, 195, 121);">'./worker.js'</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span>
</span><span><span></span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// Получение сообщения от воркера</span><span>
</span></span><span><span>worker</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">on</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(152, 195, 121);">'message'</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token parameter">result</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token arrow" style="color: rgb(97, 175, 239);">=&gt;</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>
</span></span><span><span>  </span><span class="token console" style="color: rgb(209, 154, 102);">console</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">log</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(152, 195, 121);">'Результат:'</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> result</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span></span></code></pre></div></div>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">Подробнее в документации: <a class="underline underline underline-offset-2 decoration-1 decoration-current/40 hover:decoration-current focus:decoration-current" href="https://nodejs.org/api/worker_threads.html">https://nodejs.org/api/worker_threads.html</a></p>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">6. Терминология Event Loop</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Резолвиться / Разрешиться</strong> — когда <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">макротаск</code> готов к выполнению. Например, для <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">setTimeout(fn, 3000)</code> макротаск "резолвится" через 3 секунды, когда таймер истекает.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Формальное определение:</strong>
Когда <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">макротаск</code> готов к выполнению (его условия выполнены — например, истекло время таймера, пришел ответ от сервера, файл прочитан), <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Event Loop</code> извлекает его из очереди и выполняет связанный с ним код.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Процесс:</strong></p>
<ol class="[li_&amp;]:mb-0 [li_&amp;]:mt-1.5 [li_&amp;]:gap-1.5 [&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-decimal flex flex-col gap-2 pl-8 mb-3">
<li class="whitespace-normal break-words pl-2">Задача помещается в очередь (например, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">setTimeout</code> создает <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">макротаск</code>)</li>
<li class="whitespace-normal break-words pl-2">Задача ожидает своих условий (таймер отсчитывает время)</li>
<li class="whitespace-normal break-words pl-2">Условия выполнены — задача "резолвится" (готова к выполнению)</li>
<li class="whitespace-normal break-words pl-2"><code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Event Loop</code> извлекает задачу и запускает её коллбек</li>
</ol>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">7. Разница между Node.js и браузером в работе Event Loop</h3>
<div class="overflow-x-auto w-full px-2 mb-6"><table class="min-w-full border-collapse text-sm leading-[1.7] whitespace-normal"><thead class="text-left"><tr><th class="text-text-100 border-b-0.5 border-border-300/60 py-2 pr-4 align-top font-bold">Аспект</th><th class="text-text-100 border-b-0.5 border-border-300/60 py-2 pr-4 align-top font-bold">Node.js</th><th class="text-text-100 border-b-0.5 border-border-300/60 py-2 pr-4 align-top font-bold">Браузер</th></tr></thead><tbody><tr><td class="border-b-0.5 border-border-300/30 py-2 pr-4 align-top"><strong>Завершение программы</strong></td><td class="border-b-0.5 border-border-300/30 py-2 pr-4 align-top">Программа завершается, когда очередь задач пуста</td><td class="border-b-0.5 border-border-300/30 py-2 pr-4 align-top">Программа продолжает работать, ожидая действий пользователя</td></tr><tr><td class="border-b-0.5 border-border-300/30 py-2 pr-4 align-top"><strong>Цель</strong></td><td class="border-b-0.5 border-border-300/30 py-2 pr-4 align-top">Выполнение серверной логики, скриптов</td><td class="border-b-0.5 border-border-300/30 py-2 pr-4 align-top">Поддержание интерактивного интерфейса</td></tr><tr><td class="border-b-0.5 border-border-300/30 py-2 pr-4 align-top"><strong>Источники задач</strong></td><td class="border-b-0.5 border-border-300/30 py-2 pr-4 align-top">Файловые операции, сетевые запросы, таймеры</td><td class="border-b-0.5 border-border-300/30 py-2 pr-4 align-top">События UI, таймеры, сетевые запросы, анимации</td></tr><tr><td class="border-b-0.5 border-border-300/30 py-2 pr-4 align-top"><strong>Рендеринг</strong></td><td class="border-b-0.5 border-border-300/30 py-2 pr-4 align-top">Нет рендеринга</td><td class="border-b-0.5 border-border-300/30 py-2 pr-4 align-top">Рендеринг после <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">макротасков</code></td></tr><tr><td class="border-b-0.5 border-border-300/30 py-2 pr-4 align-top"><strong>Завершение</strong></td><td class="border-b-0.5 border-border-300/30 py-2 pr-4 align-top"><code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">process.exit()</code> или пустая очередь</td><td class="border-b-0.5 border-border-300/30 py-2 pr-4 align-top">Только при закрытии вкладки/браузера</td></tr></tbody></table></div>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Практический пример:</strong></p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">В браузере:</p>
<div class="relative group/copy bg-bg-000/50 border-0.5 border-border-400 rounded-lg"><div class="sticky opacity-0 group-hover/copy:opacity-100 top-2 py-2 h-12 w-0 float-right"><div class="absolute right-0 h-8 px-2 items-center inline-flex z-10"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)] h-8 w-8 rounded-md active:scale-95 backdrop-blur-md Button_ghost__BUAoh" type="button" aria-label="Copy to clipboard" data-state="closed"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 transition-all opacity-100 scale-100" aria-hidden="true"><path d="M12.5 3C13.3284 3 14 3.67157 14 4.5V6H15.5C16.3284 6 17 6.67157 17 7.5V15.5C17 16.3284 16.3284 17 15.5 17H7.5C6.67157 17 6 16.3284 6 15.5V14H4.5C3.67157 14 3 13.3284 3 12.5V4.5C3 3.67157 3.67157 3 4.5 3H12.5ZM14 12.5C14 13.3284 13.3284 14 12.5 14H7V15.5C7 15.7761 7.22386 16 7.5 16H15.5C15.7761 16 16 15.7761 16 15.5V7.5C16 7.22386 15.7761 7 15.5 7H14V12.5ZM4.5 4C4.22386 4 4 4.22386 4 4.5V12.5C4 12.7761 4.22386 13 4.5 13H12.5C12.7761 13 13 12.7761 13 12.5V4.5C13 4.22386 12.7761 4 12.5 4H4.5Z"></path></svg></div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 absolute top-0 left-0 transition-all opacity-0 scale-50" aria-hidden="true"><path d="M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"></path></svg></div></div></button></div></div><div class="text-text-500 font-small p-3.5 pb-0">javascript</div><div><pre class="code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border-radius: 0.3em;"><code class="language-javascript" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none;"><span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// Программа не завершится, будет ждать действий пользователя</span><span>
</span></span><span><span></span><span class="token console" style="color: rgb(209, 154, 102);">console</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">log</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(152, 195, 121);">'Браузер готов к работе'</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span></span></code></pre></div></div>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">В Node.js:</p>
<div class="relative group/copy bg-bg-000/50 border-0.5 border-border-400 rounded-lg"><div class="sticky opacity-0 group-hover/copy:opacity-100 top-2 py-2 h-12 w-0 float-right"><div class="absolute right-0 h-8 px-2 items-center inline-flex z-10"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)] h-8 w-8 rounded-md active:scale-95 backdrop-blur-md Button_ghost__BUAoh" type="button" aria-label="Copy to clipboard" data-state="closed"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 transition-all opacity-100 scale-100" aria-hidden="true"><path d="M12.5 3C13.3284 3 14 3.67157 14 4.5V6H15.5C16.3284 6 17 6.67157 17 7.5V15.5C17 16.3284 16.3284 17 15.5 17H7.5C6.67157 17 6 16.3284 6 15.5V14H4.5C3.67157 14 3 13.3284 3 12.5V4.5C3 3.67157 3.67157 3 4.5 3H12.5ZM14 12.5C14 13.3284 13.3284 14 12.5 14H7V15.5C7 15.7761 7.22386 16 7.5 16H15.5C15.7761 16 16 15.7761 16 15.5V7.5C16 7.22386 15.7761 7 15.5 7H14V12.5ZM4.5 4C4.22386 4 4 4.22386 4 4.5V12.5C4 12.7761 4.22386 13 4.5 13H12.5C12.7761 13 13 12.7761 13 12.5V4.5C13 4.22386 12.7761 4 12.5 4H4.5Z"></path></svg></div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 absolute top-0 left-0 transition-all opacity-0 scale-50" aria-hidden="true"><path d="M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"></path></svg></div></div></button></div></div><div class="text-text-500 font-small p-3.5 pb-0">javascript</div><div><pre class="code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border-radius: 0.3em;"><code class="language-javascript" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none;"><span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// Программа завершится сразу после вывода</span><span>
</span></span><span><span></span><span class="token console" style="color: rgb(209, 154, 102);">console</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">log</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(152, 195, 121);">'Node.js завершает работу'</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// Программа закрывается</span></span></code></pre></div></div>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">8. CommonJS vs ES-modules: сравнительная таблица</h3>
<div class="overflow-x-auto w-full px-2 mb-6"><table class="min-w-full border-collapse text-sm leading-[1.7] whitespace-normal"><thead class="text-left"><tr><th class="text-text-100 border-b-0.5 border-border-300/60 py-2 pr-4 align-top font-bold">Характеристика</th><th class="text-text-100 border-b-0.5 border-border-300/60 py-2 pr-4 align-top font-bold">CommonJS</th><th class="text-text-100 border-b-0.5 border-border-300/60 py-2 pr-4 align-top font-bold">ES-modules</th></tr></thead><tbody><tr><td class="border-b-0.5 border-border-300/30 py-2 pr-4 align-top"><strong>Синтаксис экспорта</strong></td><td class="border-b-0.5 border-border-300/30 py-2 pr-4 align-top"><code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">module.exports = ...</code> <br> <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">exports.func = ...</code></td><td class="border-b-0.5 border-border-300/30 py-2 pr-4 align-top"><code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">export default ...</code> <br> <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">export const func = ...</code></td></tr><tr><td class="border-b-0.5 border-border-300/30 py-2 pr-4 align-top"><strong>Синтаксис импорта</strong></td><td class="border-b-0.5 border-border-300/30 py-2 pr-4 align-top"><code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">const module = require('./module')</code></td><td class="border-b-0.5 border-border-300/30 py-2 pr-4 align-top"><code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">import module from './module.js'</code> <br> <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">import { func } from './module.js'</code></td></tr><tr><td class="border-b-0.5 border-border-300/30 py-2 pr-4 align-top"><strong>Расширение файла</strong></td><td class="border-b-0.5 border-border-300/30 py-2 pr-4 align-top"><code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">.js</code> (по умолчанию) <br> <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">.cjs</code> (в ES-окружении)</td><td class="border-b-0.5 border-border-300/30 py-2 pr-4 align-top"><code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">.mjs</code> <br> <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">.js</code> (с <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">"type": "module"</code>)</td></tr><tr><td class="border-b-0.5 border-border-300/30 py-2 pr-4 align-top"><strong>Загрузка</strong></td><td class="border-b-0.5 border-border-300/30 py-2 pr-4 align-top">Синхронная</td><td class="border-b-0.5 border-border-300/30 py-2 pr-4 align-top">Асинхронная</td></tr><tr><td class="border-b-0.5 border-border-300/30 py-2 pr-4 align-top"><strong>Время разрешения</strong></td><td class="border-b-0.5 border-border-300/30 py-2 pr-4 align-top">Runtime (во время выполнения)</td><td class="border-b-0.5 border-border-300/30 py-2 pr-4 align-top">Parse time (при парсинге)</td></tr><tr><td class="border-b-0.5 border-border-300/30 py-2 pr-4 align-top"><strong>Динамический импорт</strong></td><td class="border-b-0.5 border-border-300/30 py-2 pr-4 align-top">Да (всегда)</td><td class="border-b-0.5 border-border-300/30 py-2 pr-4 align-top">Через <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">import()</code></td></tr><tr><td class="border-b-0.5 border-border-300/30 py-2 pr-4 align-top"><strong>Tree-shaking</strong></td><td class="border-b-0.5 border-border-300/30 py-2 pr-4 align-top">Не поддерживается</td><td class="border-b-0.5 border-border-300/30 py-2 pr-4 align-top">Поддерживается</td></tr><tr><td class="border-b-0.5 border-border-300/30 py-2 pr-4 align-top"><strong>Статический анализ</strong></td><td class="border-b-0.5 border-border-300/30 py-2 pr-4 align-top">Сложный</td><td class="border-b-0.5 border-border-300/30 py-2 pr-4 align-top">Простой</td></tr><tr><td class="border-b-0.5 border-border-300/30 py-2 pr-4 align-top"><strong>Поддержка в Node.js</strong></td><td class="border-b-0.5 border-border-300/30 py-2 pr-4 align-top">С первой версии</td><td class="border-b-0.5 border-border-300/30 py-2 pr-4 align-top">С версии 13+</td></tr><tr><td class="border-b-0.5 border-border-300/30 py-2 pr-4 align-top"><strong>Современность</strong></td><td class="border-b-0.5 border-border-300/30 py-2 pr-4 align-top">Устаревающий стандарт</td><td class="border-b-0.5 border-border-300/30 py-2 pr-4 align-top">Современный стандарт</td></tr><tr><td class="border-b-0.5 border-border-300/30 py-2 pr-4 align-top"><strong>Браузеры</strong></td><td class="border-b-0.5 border-border-300/30 py-2 pr-4 align-top">Требует бандлер</td><td class="border-b-0.5 border-border-300/30 py-2 pr-4 align-top">Нативная поддержка</td></tr></tbody></table></div>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Рекомендация:</strong> Используйте ES-modules для новых проектов. CommonJS нужен только для совместимости со старыми библиотеками или инструментами.</p>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">9. Синхронный vs Асинхронный код</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Синхронный код</strong> — код, который выполняется последовательно, строка за строкой, блокируя выполнение следующей операции до завершения текущей.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Пример синхронного кода:</strong></p>
<div class="relative group/copy bg-bg-000/50 border-0.5 border-border-400 rounded-lg"><div class="sticky opacity-0 group-hover/copy:opacity-100 top-2 py-2 h-12 w-0 float-right"><div class="absolute right-0 h-8 px-2 items-center inline-flex z-10"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)] h-8 w-8 rounded-md active:scale-95 backdrop-blur-md Button_ghost__BUAoh" type="button" aria-label="Copy to clipboard" data-state="closed"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 transition-all opacity-100 scale-100" aria-hidden="true"><path d="M12.5 3C13.3284 3 14 3.67157 14 4.5V6H15.5C16.3284 6 17 6.67157 17 7.5V15.5C17 16.3284 16.3284 17 15.5 17H7.5C6.67157 17 6 16.3284 6 15.5V14H4.5C3.67157 14 3 13.3284 3 12.5V4.5C3 3.67157 3.67157 3 4.5 3H12.5ZM14 12.5C14 13.3284 13.3284 14 12.5 14H7V15.5C7 15.7761 7.22386 16 7.5 16H15.5C15.7761 16 16 15.7761 16 15.5V7.5C16 7.22386 15.7761 7 15.5 7H14V12.5ZM4.5 4C4.22386 4 4 4.22386 4 4.5V12.5C4 12.7761 4.22386 13 4.5 13H12.5C12.7761 13 13 12.7761 13 12.5V4.5C13 4.22386 12.7761 4 12.5 4H4.5Z"></path></svg></div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 absolute top-0 left-0 transition-all opacity-0 scale-50" aria-hidden="true"><path d="M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"></path></svg></div></div></button></div></div><div class="text-text-500 font-small p-3.5 pb-0">javascript</div><div><pre class="code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border-radius: 0.3em;"><code class="language-javascript" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none;"><span><span class="token console" style="color: rgb(209, 154, 102);">console</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">log</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(152, 195, 121);">'Шаг 1'</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(198, 120, 221);">const</span><span> result </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">5</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">+</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">3</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span><span></span><span class="token console" style="color: rgb(209, 154, 102);">console</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">log</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(152, 195, 121);">'Шаг 2:'</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> result</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span><span></span><span class="token console" style="color: rgb(209, 154, 102);">console</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">log</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(152, 195, 121);">'Шаг 3'</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span>
</span><span><span></span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// Вывод строго последовательный:</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// Шаг 1</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// Шаг 2: 8</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// Шаг 3</span></span></code></pre></div></div>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Асинхронный код</strong> — код, который не блокирует выполнение программы. Операция запускается, но результат приходит позже, через коллбек, промис или async/await.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Пример асинхронного кода:</strong></p>
<div class="relative group/copy bg-bg-000/50 border-0.5 border-border-400 rounded-lg"><div class="sticky opacity-0 group-hover/copy:opacity-100 top-2 py-2 h-12 w-0 float-right"><div class="absolute right-0 h-8 px-2 items-center inline-flex z-10"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)] h-8 w-8 rounded-md active:scale-95 backdrop-blur-md Button_ghost__BUAoh" type="button" aria-label="Copy to clipboard" data-state="closed"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 transition-all opacity-100 scale-100" aria-hidden="true"><path d="M12.5 3C13.3284 3 14 3.67157 14 4.5V6H15.5C16.3284 6 17 6.67157 17 7.5V15.5C17 16.3284 16.3284 17 15.5 17H7.5C6.67157 17 6 16.3284 6 15.5V14H4.5C3.67157 14 3 13.3284 3 12.5V4.5C3 3.67157 3.67157 3 4.5 3H12.5ZM14 12.5C14 13.3284 13.3284 14 12.5 14H7V15.5C7 15.7761 7.22386 16 7.5 16H15.5C15.7761 16 16 15.7761 16 15.5V7.5C16 7.22386 15.7761 7 15.5 7H14V12.5ZM4.5 4C4.22386 4 4 4.22386 4 4.5V12.5C4 12.7761 4.22386 13 4.5 13H12.5C12.7761 13 13 12.7761 13 12.5V4.5C13 4.22386 12.7761 4 12.5 4H4.5Z"></path></svg></div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 absolute top-0 left-0 transition-all opacity-0 scale-50" aria-hidden="true"><path d="M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"></path></svg></div></div></button></div></div><div class="text-text-500 font-small p-3.5 pb-0">javascript</div><div><pre class="code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border-radius: 0.3em;"><code class="language-javascript" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none;"><span><span class="token console" style="color: rgb(209, 154, 102);">console</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">log</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(152, 195, 121);">'Шаг 1'</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span>
</span><span><span></span><span class="token" style="color: rgb(97, 175, 239);">setTimeout</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token arrow" style="color: rgb(97, 175, 239);">=&gt;</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>
</span></span><span><span>  </span><span class="token console" style="color: rgb(209, 154, 102);">console</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">log</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(152, 195, 121);">'Шаг 2: асинхронная операция'</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">1000</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span>
</span><span><span></span><span class="token console" style="color: rgb(209, 154, 102);">console</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">log</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(152, 195, 121);">'Шаг 3'</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span>
</span><span><span></span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// Вывод:</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// Шаг 1</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// Шаг 3</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// (через 1 секунду) Шаг 2: асинхронная операция</span></span></code></pre></div></div>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Ключевые различия:</strong></p>
<div class="overflow-x-auto w-full px-2 mb-6"><table class="min-w-full border-collapse text-sm leading-[1.7] whitespace-normal"><thead class="text-left"><tr><th class="text-text-100 border-b-0.5 border-border-300/60 py-2 pr-4 align-top font-bold">Синхронный код</th><th class="text-text-100 border-b-0.5 border-border-300/60 py-2 pr-4 align-top font-bold">Асинхронный код</th></tr></thead><tbody><tr><td class="border-b-0.5 border-border-300/30 py-2 pr-4 align-top">Блокирует выполнение</td><td class="border-b-0.5 border-border-300/30 py-2 pr-4 align-top">Не блокирует выполнение</td></tr><tr><td class="border-b-0.5 border-border-300/30 py-2 pr-4 align-top">Предсказуемый порядок</td><td class="border-b-0.5 border-border-300/30 py-2 pr-4 align-top">Порядок зависит от времени завершения</td></tr><tr><td class="border-b-0.5 border-border-300/30 py-2 pr-4 align-top">Простой для понимания</td><td class="border-b-0.5 border-border-300/30 py-2 pr-4 align-top">Требует понимания коллбеков/промисов</td></tr><tr><td class="border-b-0.5 border-border-300/30 py-2 pr-4 align-top">Может "заморозить" программу</td><td class="border-b-0.5 border-border-300/30 py-2 pr-4 align-top">Позволяет выполнять другие задачи</td></tr></tbody></table></div>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Когда использовать асинхронность:</strong></p>
<ul class="[li_&amp;]:mb-0 [li_&amp;]:mt-1.5 [li_&amp;]:gap-1.5 [&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-disc flex flex-col gap-2 pl-8 mb-3">
<li class="whitespace-normal break-words pl-2">Чтение/запись файлов</li>
<li class="whitespace-normal break-words pl-2">Сетевые запросы</li>
<li class="whitespace-normal break-words pl-2">Работа с базами данных</li>
<li class="whitespace-normal break-words pl-2">Таймеры и задержки</li>
<li class="whitespace-normal break-words pl-2">Любые операции, которые могут занять время</li>
</ul></div></div><div><div class="standard-markdown grid-cols-1 grid gap-4 [&amp;_&gt;_*]:min-w-0 !gap-3.5"><h1 class="text-text-100 mt-3 -mb-1 text-[1.375rem] font-bold">Лекция по изучению Node.js. Урок 1 (продолжение)</h1>
<h2 class="text-text-100 mt-3 -mb-1 text-[1.125rem] font-bold">Отредактированная транскрипция</h2>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:30:59 --- Если речь идет именно об <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">асинхронных операциях</code>, потому что <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">readFileSync</code> или <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">writeFileSync</code> — это, конечно, простейшая асинхронщина, которая к новому макротаску не приведет, она просто затормозит программу. Но если мы используем классические операции файловые, то это специфика только нода. В обычном JavaScript у нас никакой работы с файловой системой нет, конечно. Еще в ноде есть разные специфические коллбэки, например, есть <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">setImmediate</code> так называемый. Мы его постепенно в коде увидим.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:31:32 --- Это как бы возможность перенести выполнение кода в новый <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">MacroTask</code>. Зачем? Ну, может быть вы когда-то в джаваскрипте видели команды в духе <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">setTimeout</code> что-то там, запятая ноль. Или <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">requestIdleCallback</code>, или <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">requestAnimationFrame</code> в джаваскрипте. Но вот <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">setImmediate</code> — это что-то похожее. То есть когда макротаск завершится, и когда система готова к обработке следующего макротаска из перечня, вот мы на то место времени переносим нашу задачу.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:32:05 --- Иногда бывает полезно, чтобы разбить длинные вычисления на части, или чтобы выполнить новый кусок кода только когда все предыдущие макро- и микро-таски будут завершены. Денис пишет, где-то читал, что браузер пытается прогнать этот цикл 60 раз в секунду. Но, может быть, я думаю, это от движка браузера должно зависеть. Эти все нюансы работы, они, получается, находятся на другом уровне абстракции.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:32:30 --- То есть браузер нам дает вот эту среду, вот эти правила того, как устроено выполнение нашего кода, а сколько он там раз будет этот цикл пытаться прогнать, какой он поставит лимит, например, на максимальный <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">стек синхронных вызовов</code>, — это его внутреннее дело. Да, потому что JS работает в браузере, и вы наверное замечали, что в JS бывает рекурсию случайно запустишь неудачно. Ведь именно синхронных вызовов стек накапливается, накапливается, и в какое-то время пишет, типа, товарищ, я стек не могу обработать.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:33:02 --- И вот, по сути, браузер теоретически сам может принять решение о том, какую именно цифру выбрать как ограничитель. Вот, значит, получается, здесь JS и Node.js отличаются как минимум тем, какие причины могут быть для создания нового макротаска. А <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">микротаски</code>, ну это, скажем, как бы гораздо менее важное явление с точки зрения понимания структуры языка, как мне кажется.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:33:32 --- Микротаски — это то, что выполняется между макротасками. И микротаски достаточно тяжело увидеть на каких-то примерах, кроме промисов. То есть, например, вызов всей цепочке промисов, там <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">then</code>, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">then</code>, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">catch</code>, — это микротаски. При этом имеются в виду те промисы, которые уже зарезолвились. Потому что не бывает промиса в вакууме.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:33:59 --- У промиса всегда есть какой-то фундамент, на котором он стоит. Что даже если мы работаем в промисном виде с модулем <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">fs</code>, то промис резолвится за счет того, что где-то из глубины пришла команда, что мы файл прочитали. Если мы работаем с <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">fetch</code>, то <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Promise</code> резолвится по причине реквест-респонса, который написан в этом столбике. Если мы пишем самописную систему какую-то, которую мы промиссифицируем, то там под капотом может и <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">setTimeout</code> есть, и мы <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">setTimeout</code> промиссифицировали.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:34:26 --- То есть, короче говоря, сам процесс жизни <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Promise</code> от момента его создания до момента резолва — это макротаск. Потому что причина резолва промиса скорее всего по макротаску. По какой-то причине происходит, которую мы уже в столбике макротасков описали. А микротаски, да, это вот чаще всего просто процесс хождения результата промиса по его <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">then</code>, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">catch</code> и прочему.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:34:56 --- Как бы микротаски в этом плане очень похожи на <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">синхронный код</code>. И логика здесь такая. Вот у нас есть допустим назначенный пул макротасков. Первый макротаск, второй, третий. Система в <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">event loop</code> захватила один макротаск, его выполняет. Да, берет, выполняет, выполняет, выполняет. И как она его выполняет? Она его разбивает. Вот синхронный код какой-то был. Вот пошли микротаски, резолвы промиссов внутри этого кода.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:35:21 --- Да, там еще какой-то синхронный код, еще какие-то резолвы промиссов и так далее. И к следующему макротаску система не перейдет, пока вот все микротаски из текущего она не выполнит. То есть весь синхронный код и все <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">then</code>, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">then</code> и <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">catch</code> промиссов. Почему? Потому что система считает, что эти вещи нельзя распараллеливать ни в коем случае, потому что надо, чтобы переменные как бы не могли измениться.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:35:52 --- То есть, например, вы написали там какой-нибудь <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">response.json()</code>, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">then</code>, дальше еще один <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">then</code>, дальше <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">catch</code>. И вот если бы начал выполняться новый <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">MacroTask</code>, пока мы по всем этим <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">then</code> и <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">catch</code> не пройдем, то мало ли изменилась бы какая-то переменная, которая выше в коде, на которую вы ссылаетесь. И поэтому все вот эти <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">then</code> и <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">catch</code> Promise фактически обрабатываются по смыслу как синхронный код.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:36:18 --- То есть пока это дело не выполнится, новый макротаск не возьмем. Что приоритетнее, макротаск или микротаск, что раньше выполнится? Здесь так получается, что макротаски состоят из микротасков. То есть, когда у нас <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">EventLoop</code> был ничем не занят, то причина запуска новых действий программы — это, конечно, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">MacroTask</code>. То есть, его первого берут, да, вот MacroTask зарезолвался какой-то, и как бы вот его взяли и начали выполнять из него куски кода.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:36:50 --- Синхронный код, да, какой-то выполняется, это, считайте, похоже на один большой такой <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">MicroTask</code>. Дальше какой-то промисс, который зарезолвился, уже в нем написано <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">then</code>, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">then</code>, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">catch</code>, еще какой-нибудь <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">then</code>. Это вот все микротаски, первый, второй, третий, четвертый. Вот он все это будет выполнять, как бы до тех пор, пока не выполнит, к следующему макротаску не перейдет. Да, микротаска без макротаска не будет, потому что, чтобы <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">EventLoop</code> проснулся от спячки, нужно, чтобы какая-то операция, которая висела в списке незаконченных и неактивных, чтобы она закончилась.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:37:25 --- Например, вернулся ответ от сервера или мы бы получили данные от файловой системы из файла, который пытались прочитать или <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">setTimeout</code>. Посчитал свое время и решил, что он как бы стал активным, готовым к работе. И EventLoop берет одну макротаску, из нее какие-то микротаски могут родиться, но по сути для понимания работы программы микротаски они не так и важны, ну как мне кажется.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:37:53 --- Да, потому что микротаски, они внутри макротасков происходят, и мы из них какую-то особую выгоду выжить не можем. Нет, у нас есть, конечно, специальный коллбэк в ноде, который называется как-то вроде <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">queueMicrotask</code>. Я, наверное, сейчас соврал, название у него немножко другое, но смысл названия именно такой.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:38:14 --- То есть, как бы поставить задачу после выполнения всех микротасков. То есть, условно, у нас вот есть какой-то код, первая строка, вторая, синхронная, третья, дальше какой-то promise, у него <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">then</code>, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">then</code>, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">then</code>, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">catch</code>. И мы можем отсюда написать <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">setImmediate</code>, это поставит его после всех макротасков. А <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">queueMicrotask</code> он перенесет, это короче вот сюда, то есть как будто бы отсюда сюда мы передвинули. Вот такой прикол у нас, мы хотим какой-то кусок кода выполнить не сейчас, а тогда, когда все промиссы зарезолвятся.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:38:45 --- Ну то есть если промисс один, можно просто <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">finally</code> написать и не выпендриваться. А если промиссов несколько, ну может быть вот мы хотим сюда передвинуть. Но используется далеко не так часто. Поэтому с точки зрения понимания нам главное понять вот эту часть системы на данном этапе. То, что макротаски по какой-то причине запускаются и так далее.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:39:09 --- Какой-то пример, когда это может быть необходимо, нет. Такого примера сейчас нет, потому что эту задачу можно решить и другими способами. То есть мы можем, например, все промиссы, которые с энными <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">catch</code> будут там фигачить, собрать в один массив, написать <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Promise.all</code>, и когда они все зарезолвятся, что-то сделать. Или написать у всех этих промиссов <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">finally</code>, например, и что-то сделать.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:39:35 --- Вот, то есть, по сути, вот этот вот коллбэк на перенос задач после всех микротасков, он крайне-крайне редко используется. Я, например, его не использовал ни разу. Вот, а <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">setImmediate</code>, в сравнении с ним, который переносит задачу после, да, всего вот, после обработки конкретного макротаска, вот он очень актуальный и мы его скоро увидим.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:40:02 --- Так, значит, вижу вопрос. То есть если пользователь зашел на наш сайт на ноде, для него инициализировались новые классы, для других зашедших 100 пользователей все происходит на одном ядре и все в одном event loop. Есть маленький нюанс. Для него не могут инициализироваться 100 новых классов. Создаться 100 новых объектов могут, а создаться 100 новых классов нет. Почему? Потому что вот специфика, скажем, по сравнению с другими серверными языками, в PHP есть файлик <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">index.php</code>.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:40:34 --- И когда человек заходит на адрес там <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">site.ru/index.php</code>, то для каждого человека сайт <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">index.php</code> отрабатывает с нуля. Apache, подключенный PHP, как модуль Apache, запускается, и для каждого человека <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">index.php</code> стартует с чистого листа, без переменных, без всего остального. Нодовский файл, мы его на сервере командой <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">node index.js</code> запустили.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:41:01 --- Например, он нас на каком-то порту поднял веб-сервер, мы сейчас это сделаем в коде. И этот файлик единый для всех. И у него просто есть коллбэк, который на заход каждого человека начинает делать какие-то операции. И да, это все происходит в рамках одного <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">event loop</code>. И поэтому, да, Тарас пишет, что имел в виду не 100 классов, а 100 объектов.</p>
<img :src="screenshot_2502" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:41:28 --- Да, это все происходит в одном event loop. И единственное, что как бы порой делают, ну я думаю Тарас просто опасается, что как так, придет на сайт тысяча человек и все в рамках одного Event Loop будут жить. Но тысяча человек — это фигня и десять тысяч человек — это фигня, они все в рамках одного Event Loop проживут прекрасно. Потому что, ну просто код получается параллелится за счет макротасков.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:41:55 --- Люди сюда приходят, новые макротаски добавляются, добавляются, там запросы к базе, запросы еще к чему-то, ну тайм-аутов вроде как быть не должно, может быть чтение файловой системы, это все в макротаски становится, но сервак очень быстро эти макротаски поглощает. И единственное, что порой делают, если чувствуют, что сервер не вывозит, это ставят <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">кластер</code>. Даже простые модули типа <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">PM2</code>, Project Manager, он что позволяет сделать? Он позволяет поднять ноду в несколько потоков.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:42:38 --- То есть сделать некую центральную точку, которая принимает все запросы и в фоне подняты допустим 4 ноды, или 8 нод, или 6 нод, какой-то такой паук у нас получается. И она просто рандомно на одну из поднятых нод на конкретное ядро отсылает.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:42:58 --- У этих товарищей не будет общей памяти. Вот это вот небольшая проблема. Вот у этих кружков, которые я нарисовал. Но получается есть, скажем, файлик <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">index.js</code>, который просто рандомно человека отсылает на поднятую ноду, на каком-то другом порту она работает. Ну или даже не на порту, фиг с ней, она просто в памяти висит и работает. Новый экземпляр ноды. Вот эта штука работает как <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">балансер</code>, так да. И единственная сложность создания такого кластера заключается в том, что пока у нас файл один, для всех клиентов у нас все переменные общие.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:43:31 --- А если мы такой балансер сделали, такой кластер собрали, то у каждой ноды своя оперативка. И чтобы у них сделать какие-то общие данные, нужно, например, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Redis</code> использовать или <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Memcached</code>. Ну, Redis посерьезнее сейчас считается. И как бы все это можно масштабировать хоть до бесконечности. Так, тема <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Shared Array Buffer</code> не для подобных ли ситуаций?</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:43:55 --- Не думаю. Если для создания какого-то общего модуля памяти, то можно попробовать, наверное, но придумывать что-то дополнительное не имеет смысла, как правило, потому что Redis, он же очень хорошее хранилище предоставляет по простому принципу key-value. И Redis в любом случае будет полезен, независимо от того, делаем мы какие-то общие переменные для всех этих узлов или мы храним <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">кэш</code>, скажем, запросов к базе в Redis.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:44:29 --- Поэтому Redis естественным образом возникает сначала вот здесь, когда мы кэшируем запросы, например, к базе или кэшируем страницы. И потом просто если кластер появляется, то нет никакой причины от Redis отказываться, просто он еще берет на себя и, скажем, такую задачу, как хранение каких-то общих переменных, если они нам нужны.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:44:50 --- Вот. Но это мы с вами вперед, конечно, забежали, то есть такой монстр нам не шибко здесь нужен. Вот. Пока, значит, просьба плюсами подтвердить, если понятны идеи event loop и макротасков. Как бы микротаски фиг с ними, мы еще про это поговорим, я думаю, на курсе. Балансировать он это сам будет. Зависит от того, как развернули. То есть если мы берем модуль типа PM2, устанавливаем его на серваке, балансировать он это будет сам.</p>
<hr class="border-border-200 border-t-0.5 my-3 mx-1.5">
<h2 class="text-text-100 mt-3 -mb-1 text-[1.125rem] font-bold">Дополнительные объяснения</h2>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">1. Что такое setImmediate и зачем он нужен?</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">setImmediate</code> — это специальная функция в Node.js, которая позволяет отложить выполнение кода до следующего макротаска. Представьте, что у вас есть очередь задач, и вы хотите, чтобы ваша задача выполнилась не прямо сейчас, а после того, как все текущие дела будут закончены.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Чем отличается от setTimeout?</strong>
Хотя <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">setTimeout(fn, 0)</code> выглядит похоже, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">setImmediate</code> специально создан для Node.js и работает немного иначе. Он говорит: "Выполни меня, как только текущий макротаск закончится и система будет готова к следующему".</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Когда это полезно?</strong></p>
<ul class="[li_&amp;]:mb-0 [li_&amp;]:mt-1.5 [li_&amp;]:gap-1.5 [&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-disc flex flex-col gap-2 pl-8 mb-3">
<li class="whitespace-normal break-words pl-2"><strong>Разбиение длинных вычислений</strong>: Если у вас есть сложный расчет, который может подвисить программу, вы можете разбить его на части через <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">setImmediate</code></li>
<li class="whitespace-normal break-words pl-2"><strong>Ожидание завершения других операций</strong>: Иногда нужно убедиться, что все предыдущие задачи точно выполнились, прежде чем делать что-то новое</li>
<li class="whitespace-normal break-words pl-2"><strong>Предотвращение блокировки</strong>: Это позволяет другим запросам обрабатываться, даже если у вас идут тяжелые вычисления</li>
</ul>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">2. Почему браузер пытается запускать event loop 60 раз в секунду?</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">Это связано с тем, как работает отображение на экране! Большинство мониторов обновляются 60 раз в секунду (60 кадров в секунду, или 60 FPS). Браузер старается синхронизировать свою работу с этой частотой, чтобы анимации и интерфейс были плавными.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Что это означает практически?</strong>
Каждые ~16 миллисекунд (1000мс / 60 = 16.67мс) браузер хочет проверить event loop и обновить экран. Если ваш код выполняется дольше 16 миллисекунд, анимации начинают "тормозить" — вы это видели на медленных сайтах.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Почему это зависит от браузера?</strong>
Разные браузеры (Chrome, Firefox, Safari) могут устанавливать разные ограничения на то, сколько времени можно тратить на синхронный код, сколько вложенных функций можно вызвать и так далее. Это их "внутренние правила игры".</p>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">3. Что такое стек вызовов и почему браузер его ограничивает?</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Стек вызовов</strong> — это как стопка тарелок, где каждая тарелка — это функция, которую нужно выполнить. Когда вы вызываете функцию А, она кладется на стек. Если функция А вызывает функцию Б, Б кладется сверху. Когда Б заканчивается, она снимается со стека, потом снимается А.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Что происходит при рекурсии?</strong>
Если у вас есть функция, которая вызывает сама себя (рекурсия), тарелок становится все больше и больше. В какой-то момент стопка становится такой высокой, что браузер говорит: "Стоп! Я не могу обработать столько вызовов!" Это называется переполнением стека (stack overflow).</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Типичные лимиты:</strong>
В Chrome это примерно 10,000-15,000 вызовов, в Firefox может быть больше. Это защищает браузер от зависания и крашей.</p>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">4. Жизненный цикл Promise: от создания до выполнения</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">Давайте разберем, что происходит с промисом от начала до конца:</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Шаг 1: Создание (Pending)</strong>
Когда вы создаете промис, например <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">fetch('https://api.com/data')</code>, он находится в состоянии ожидания. Внутри начинается какая-то операция (запрос к серверу, чтение файла).</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Шаг 2: Ожидание (Macrotask)</strong>
Пока промис ждет — это макротаск. Операционная система делает HTTP-запрос, файловая система читает файл, или таймер считает время. Программа при этом не стоит на месте — она может делать другие дела!</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Шаг 3: Резолв (Разрешение)</strong>
Когда операция завершается (пришел ответ от сервера, файл прочитан, время вышло), промис "резолвится" — получает результат. Это тоже макротаск — event loop получает сигнал "задача выполнена!"</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Шаг 4: Обработка результата (Microtasks)</strong>
А вот теперь начинается магия микротасков! Все ваши <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">.then()</code>, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">.catch()</code>, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">.finally()</code> выполняются один за другим как микротаски. Они идут цепочкой, и система не перейдет к следующему макротаску, пока не пройдет по всей этой цепочке.</p>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">5. Почему микротаски нельзя выполнять параллельно?</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">Представьте такую ситуацию: вы пишете код</p>
<div class="relative group/copy bg-bg-000/50 border-0.5 border-border-400 rounded-lg"><div class="sticky opacity-0 group-hover/copy:opacity-100 top-2 py-2 h-12 w-0 float-right"><div class="absolute right-0 h-8 px-2 items-center inline-flex z-10"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)] h-8 w-8 rounded-md active:scale-95 backdrop-blur-md Button_ghost__BUAoh" type="button" aria-label="Copy to clipboard" data-state="closed"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 transition-all opacity-100 scale-100" aria-hidden="true"><path d="M12.5 3C13.3284 3 14 3.67157 14 4.5V6H15.5C16.3284 6 17 6.67157 17 7.5V15.5C17 16.3284 16.3284 17 15.5 17H7.5C6.67157 17 6 16.3284 6 15.5V14H4.5C3.67157 14 3 13.3284 3 12.5V4.5C3 3.67157 3.67157 3 4.5 3H12.5ZM14 12.5C14 13.3284 13.3284 14 12.5 14H7V15.5C7 15.7761 7.22386 16 7.5 16H15.5C15.7761 16 16 15.7761 16 15.5V7.5C16 7.22386 15.7761 7 15.5 7H14V12.5ZM4.5 4C4.22386 4 4 4.22386 4 4.5V12.5C4 12.7761 4.22386 13 4.5 13H12.5C12.7761 13 13 12.7761 13 12.5V4.5C13 4.22386 12.7761 4 12.5 4H4.5Z"></path></svg></div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 absolute top-0 left-0 transition-all opacity-0 scale-50" aria-hidden="true"><path d="M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"></path></svg></div></div></button></div></div><div class="text-text-500 font-small p-3.5 pb-0">javascript</div><div><pre class="code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border-radius: 0.3em;"><code class="language-javascript" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none;"><span><span class="token" style="color: rgb(198, 120, 221);">let</span><span> count </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(97, 175, 239);">fetch</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(152, 195, 121);">'/api/data'</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">then</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token parameter">data</span><span> </span><span class="token arrow" style="color: rgb(97, 175, 239);">=&gt;</span><span> count </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> data</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token property-access">length</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">then</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token arrow" style="color: rgb(97, 175, 239);">=&gt;</span><span> </span><span class="token console" style="color: rgb(209, 154, 102);">console</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">log</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>count</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token control-flow" style="color: rgb(198, 120, 221);">catch</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token parameter">err</span><span> </span><span class="token arrow" style="color: rgb(97, 175, 239);">=&gt;</span><span> </span><span class="token console" style="color: rgb(209, 154, 102);">console</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">log</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(152, 195, 121);">'Ошибка при count ='</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> count</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span></span></code></pre></div></div>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Что пойдет не так при параллельном выполнении?</strong>
Если бы между первым <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">.then()</code> и вторым <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">.then()</code> запустился другой макротаск, который тоже меняет переменную <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">count</code>, вы получили бы неожиданный результат! Второй <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">.then()</code> увидел бы не то значение, которое установил первый.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Решение JavaScript:</strong>
Все <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">.then()</code> и <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">.catch()</code> в цепочке выполняются как один "пакет" микротасков — непрерывно, друг за другом, без перерывов. Это гарантирует, что ваши переменные не изменятся неожиданно посередине цепочки.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Однопоточность в действии:</strong>
JavaScript работает в одном потоке, и это его сила! Вам не нужно беспокоиться о том, что две части кода одновременно меняют одну переменную. Микротаски — это способ сохранить эту безопасность даже при асинхронных операциях.</p>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">6. PHP против Node.js: разные подходы к обработке запросов</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>PHP — чистый лист для каждого:</strong>
Когда пользователь заходит на сайт <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">site.ru/index.php</code>, сервер Apache запускает PHP-интерпретатор заново. Это как будто каждый раз открывается новая книга — чистые страницы, никаких старых записей. Все переменные создаются с нуля, выполняется код, отдается ответ, и все удаляется.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Node.js — одна долгоживущая программа:</strong>
Вы запускаете <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">node index.js</code> один раз, и программа продолжает работать. Когда приходит пользователь, не создается новая программа — просто вызывается функция-обработчик внутри уже работающей программы. Это как один большой офис, где работают все сотрудники, и каждый новый клиент получает своего менеджера.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Последствия:</strong></p>
<ul class="[li_&amp;]:mb-0 [li_&amp;]:mt-1.5 [li_&amp;]:gap-1.5 [&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-disc flex flex-col gap-2 pl-8 mb-3">
<li class="whitespace-normal break-words pl-2">В PHP переменные автоматически очищаются после каждого запроса</li>
<li class="whitespace-normal break-words pl-2">В Node.js переменные живут между запросами — это можно использовать для кеша, но нужно быть осторожным с утечками памяти</li>
<li class="whitespace-normal break-words pl-2">Node.js может обслуживать тысячи пользователей одновременно в одном процессе благодаря event loop</li>
<li class="whitespace-normal break-words pl-2">PHP обычно создает отдельный процесс для каждого (или использует пул процессов)</li>
</ul>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">7. Кластеризация Node.js: как масштабировать на много ядер</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Проблема:</strong> Node.js работает в одном потоке. Если у вас сервер с 8 ядрами процессора, по умолчанию используется только одно!</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Решение: кластеризация</strong>
Инструменты вроде <strong>PM2</strong> (Process Manager 2) позволяют создать "паука" из нескольких процессов Node.js:</p>
<ul class="[li_&amp;]:mb-0 [li_&amp;]:mt-1.5 [li_&amp;]:gap-1.5 [&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-disc flex flex-col gap-2 pl-8 mb-3">
<li class="whitespace-normal break-words pl-2">Главный процесс (master) принимает все входящие запросы</li>
<li class="whitespace-normal break-words pl-2">Несколько рабочих процессов (workers) — например, 4, 6 или 8 копий вашего приложения</li>
<li class="whitespace-normal break-words pl-2">Master распределяет запросы между workers случайным образом или по алгоритму</li>
</ul>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Архитектура выглядит так:</strong></p>
<div class="relative group/copy bg-bg-000/50 border-0.5 border-border-400 rounded-lg"><div class="sticky opacity-0 group-hover/copy:opacity-100 top-2 py-2 h-12 w-0 float-right"><div class="absolute right-0 h-8 px-2 items-center inline-flex z-10"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)] h-8 w-8 rounded-md active:scale-95 backdrop-blur-md Button_ghost__BUAoh" type="button" aria-label="Copy to clipboard" data-state="closed"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 transition-all opacity-100 scale-100" aria-hidden="true"><path d="M12.5 3C13.3284 3 14 3.67157 14 4.5V6H15.5C16.3284 6 17 6.67157 17 7.5V15.5C17 16.3284 16.3284 17 15.5 17H7.5C6.67157 17 6 16.3284 6 15.5V14H4.5C3.67157 14 3 13.3284 3 12.5V4.5C3 3.67157 3.67157 3 4.5 3H12.5ZM14 12.5C14 13.3284 13.3284 14 12.5 14H7V15.5C7 15.7761 7.22386 16 7.5 16H15.5C15.7761 16 16 15.7761 16 15.5V7.5C16 7.22386 15.7761 7 15.5 7H14V12.5ZM4.5 4C4.22386 4 4 4.22386 4 4.5V12.5C4 12.7761 4.22386 13 4.5 13H12.5C12.7761 13 13 12.7761 13 12.5V4.5C13 4.22386 12.7761 4 12.5 4H4.5Z"></path></svg></div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 absolute top-0 left-0 transition-all opacity-0 scale-50" aria-hidden="true"><path d="M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"></path></svg></div></div></button></div></div><div><pre class="code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border-radius: 0.3em;"><code style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre-wrap; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none;"><span><span>Запросы → [Master Process] → Worker 1 (порт 3001)
</span></span><span>                           → Worker 2 (порт 3002)
</span><span>                           → Worker 3 (порт 3003)
</span><span>                           → Worker 4 (порт 3004)</span></code></pre></div></div>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Проблема памяти:</strong>
У каждого worker'а своя изолированная память. Если Worker 1 сохранил данные в переменную, Worker 2 их не увидит!</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Решение: Redis</strong>
<strong>Redis</strong> — это быстрая база данных в памяти (key-value хранилище), которая становится "общим блокнотом" для всех worker'ов. Нужно сохранить данные сессии пользователя? Положите в Redis, и любой worker сможет их прочитать.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Дополнительные плюсы Redis:</strong></p>
<ul class="[li_&amp;]:mb-0 [li_&amp;]:mt-1.5 [li_&amp;]:gap-1.5 [&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-disc flex flex-col gap-2 pl-8 mb-3">
<li class="whitespace-normal break-words pl-2">Кеширование запросов к основной базе данных</li>
<li class="whitespace-normal break-words pl-2">Хранение временных данных</li>
<li class="whitespace-normal break-words pl-2">Организация очередей задач</li>
<li class="whitespace-normal break-words pl-2">Pub/Sub для обмена сообщениями между процессами</li>
</ul>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Когда нужна кластеризация?</strong>
Для большинства проектов одного процесса Node.js достаточно для тысяч одновременных пользователей! Кластеризация нужна, когда:</p>
<ul class="[li_&amp;]:mb-0 [li_&amp;]:mt-1.5 [li_&amp;]:gap-1.5 [&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-disc flex flex-col gap-2 pl-8 mb-3">
<li class="whitespace-normal break-words pl-2">Высокая нагрузка (десятки тысяч запросов в секунду)</li>
<li class="whitespace-normal break-words pl-2">Много CPU-интенсивных операций</li>
<li class="whitespace-normal break-words pl-2">Нужна высокая доступность (если один worker упал, другие продолжают работать)</li>
</ul></div></div><div><div class="standard-markdown grid-cols-1 grid gap-4 [&amp;_&gt;_*]:min-w-0 !gap-3.5"><h1 class="text-text-100 mt-3 -mb-1 text-[1.375rem] font-bold">Лекция по изучению Node.js. Урок 1 (продолжение)</h1>
<h2 class="text-text-100 mt-3 -mb-1 text-[1.125rem] font-bold">Отредактированный транскрипт</h2>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:45:18 --- Чем больше ядер у сервера, тем, конечно, лучше — но только при определённом подходе к коду. Давайте посмотрим на схему. Слева показываю вариант, когда мы запускаем один экземпляр Node.js на одном ядре — это обычный однопоточный подход. А справа — когда мы поднимаем несколько отдельных процессов Node.js, по одному на каждое ядро. В этом случае каждое ядро будет активно работать со своим собственным экземпляром ноды, и вся система <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">параллелится</code> весьма неплохо. Если же мы пишем код в однопоточном стиле, как на левой части схемы, то нам лучше иметь меньше ядер, но чтобы каждое ядро было мощным — с большой тактовой частотой и хорошими характеристиками. Поэтому если пишете код в однопоточном стиле, вам не обязательно покупать многоядерный сервер.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:45:57 --- В этом особого смысла не будет, потому что сам язык <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">однопоточный</code>. Вся эта асинхронность по сути не масштабируется пропорционально количеству ядер — будь у вас одно ядро или 128. Конечно, система с большим количеством ядер всё равно будет работать быстрее, но не в 128 раз, и даже не в 100, и даже не в 50 раз.</p>
<img :src="screenshot_2793" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:46:14 --- А вот если построить архитектуру с несколькими процессами, то да — там будут определённые узкие места, например, параллельное обращение к <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Redis</code>, но это вполне терпимо. Давайте теперь посмотрим, как клиенты могут подключаться к нашему серверу, как у них может быть общая оперативная память, и создадим простейший сервер на Node.js.</p>
<img :src="screenshot_2808" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:46:43 --- Итак, импортируем <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">createServer</code> из модуля <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">http</code> с фигурными скобками:</p>
<div class="relative group/copy bg-bg-000/50 border-0.5 border-border-400 rounded-lg"><div class="sticky opacity-0 group-hover/copy:opacity-100 top-2 py-2 h-12 w-0 float-right"><div class="absolute right-0 h-8 px-2 items-center inline-flex z-10"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)] h-8 w-8 rounded-md active:scale-95 backdrop-blur-md Button_ghost__BUAoh" type="button" aria-label="Copy to clipboard" data-state="closed"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 transition-all opacity-100 scale-100" aria-hidden="true"><path d="M12.5 3C13.3284 3 14 3.67157 14 4.5V6H15.5C16.3284 6 17 6.67157 17 7.5V15.5C17 16.3284 16.3284 17 15.5 17H7.5C6.67157 17 6 16.3284 6 15.5V14H4.5C3.67157 14 3 13.3284 3 12.5V4.5C3 3.67157 3.67157 3 4.5 3H12.5ZM14 12.5C14 13.3284 13.3284 14 12.5 14H7V15.5C7 15.7761 7.22386 16 7.5 16H15.5C15.7761 16 16 15.7761 16 15.5V7.5C16 7.22386 15.7761 7 15.5 7H14V12.5ZM4.5 4C4.22386 4 4 4.22386 4 4.5V12.5C4 12.7761 4.22386 13 4.5 13H12.5C12.7761 13 13 12.7761 13 12.5V4.5C13 4.22386 12.7761 4 12.5 4H4.5Z"></path></svg></div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 absolute top-0 left-0 transition-all opacity-0 scale-50" aria-hidden="true"><path d="M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"></path></svg></div></div></button></div></div><div class="text-text-500 font-small p-3.5 pb-0">javascript</div><div><pre class="code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border-radius: 0.3em;"><code class="language-javascript" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none;"><span><span class="token module" style="color: rgb(198, 120, 221);">import</span><span> </span><span class="token imports" style="color: rgb(171, 178, 191);">{</span><span class="token imports"> createServer </span><span class="token imports" style="color: rgb(171, 178, 191);">}</span><span> </span><span class="token module" style="color: rgb(198, 120, 221);">from</span><span> </span><span class="token" style="color: rgb(152, 195, 121);">'http'</span><span class="token" style="color: rgb(171, 178, 191);">;</span></span></code></pre></div></div>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">Теперь создаём сервер:</p>
<div class="relative group/copy bg-bg-000/50 border-0.5 border-border-400 rounded-lg"><div class="sticky opacity-0 group-hover/copy:opacity-100 top-2 py-2 h-12 w-0 float-right"><div class="absolute right-0 h-8 px-2 items-center inline-flex z-10"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)] h-8 w-8 rounded-md active:scale-95 backdrop-blur-md Button_ghost__BUAoh" type="button" aria-label="Copy to clipboard" data-state="closed"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 transition-all opacity-100 scale-100" aria-hidden="true"><path d="M12.5 3C13.3284 3 14 3.67157 14 4.5V6H15.5C16.3284 6 17 6.67157 17 7.5V15.5C17 16.3284 16.3284 17 15.5 17H7.5C6.67157 17 6 16.3284 6 15.5V14H4.5C3.67157 14 3 13.3284 3 12.5V4.5C3 3.67157 3.67157 3 4.5 3H12.5ZM14 12.5C14 13.3284 13.3284 14 12.5 14H7V15.5C7 15.7761 7.22386 16 7.5 16H15.5C15.7761 16 16 15.7761 16 15.5V7.5C16 7.22386 15.7761 7 15.5 7H14V12.5ZM4.5 4C4.22386 4 4 4.22386 4 4.5V12.5C4 12.7761 4.22386 13 4.5 13H12.5C12.7761 13 13 12.7761 13 12.5V4.5C13 4.22386 12.7761 4 12.5 4H4.5Z"></path></svg></div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 absolute top-0 left-0 transition-all opacity-0 scale-50" aria-hidden="true"><path d="M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"></path></svg></div></div></button></div></div><div class="text-text-500 font-small p-3.5 pb-0">javascript</div><div><pre class="code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border-radius: 0.3em;"><code class="language-javascript" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none;"><span><span class="token" style="color: rgb(198, 120, 221);">const</span><span> server </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">createServer</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token parameter">request</span><span class="token parameter" style="color: rgb(171, 178, 191);">,</span><span class="token parameter"> response</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token arrow" style="color: rgb(97, 175, 239);">=&gt;</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// RequestListener function</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span></span></code></pre></div></div>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">Видите, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">RequestListener</code> — это функция, которая принимает два объекта: <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">request</code> и <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">response</code>. Она будет обрабатывать запрос каждого клиента. Теперь запускаем прослушивание порта:</p>
<div class="relative group/copy bg-bg-000/50 border-0.5 border-border-400 rounded-lg"><div class="sticky opacity-0 group-hover/copy:opacity-100 top-2 py-2 h-12 w-0 float-right"><div class="absolute right-0 h-8 px-2 items-center inline-flex z-10"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)] h-8 w-8 rounded-md active:scale-95 backdrop-blur-md Button_ghost__BUAoh" type="button" aria-label="Copy to clipboard" data-state="closed"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 transition-all opacity-100 scale-100" aria-hidden="true"><path d="M12.5 3C13.3284 3 14 3.67157 14 4.5V6H15.5C16.3284 6 17 6.67157 17 7.5V15.5C17 16.3284 16.3284 17 15.5 17H7.5C6.67157 17 6 16.3284 6 15.5V14H4.5C3.67157 14 3 13.3284 3 12.5V4.5C3 3.67157 3.67157 3 4.5 3H12.5ZM14 12.5C14 13.3284 13.3284 14 12.5 14H7V15.5C7 15.7761 7.22386 16 7.5 16H15.5C15.7761 16 16 15.7761 16 15.5V7.5C16 7.22386 15.7761 7 15.5 7H14V12.5ZM4.5 4C4.22386 4 4 4.22386 4 4.5V12.5C4 12.7761 4.22386 13 4.5 13H12.5C12.7761 13 13 12.7761 13 12.5V4.5C13 4.22386 12.7761 4 12.5 4H4.5Z"></path></svg></div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 absolute top-0 left-0 transition-all opacity-0 scale-50" aria-hidden="true"><path d="M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"></path></svg></div></div></button></div></div><div class="text-text-500 font-small p-3.5 pb-0">javascript</div><div><pre class="code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border-radius: 0.3em;"><code class="language-javascript" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none;"><span><span>server</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">listen</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(209, 154, 102);">3000</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span></span></code></pre></div></div>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:47:09 --- Смотрите, запускаю командой <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">node server.js</code>, и заметьте — программа запустилась и почему-то не завершается. Непонятно, правда? Вроде бы никаких новых <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">макротасков</code> нет. Но дело в том, что внутри функции <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">createServer</code> прописан механизм, который держит сервер активным — он просто не даёт очереди макротасков опустеть.</p>
<img :src="screenshot_2895" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:48:08 --- Самый простой способ не дать опустеть очереди макротасков... Придумайте! Самый простой, даже бредовый способ сделать так, чтобы макротаски никогда не закончились и система ждала вечно.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">Пока отвечу на вопрос Дениса: "В импорте всегда прописывал пути до модулей, а тут просто <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">http</code>?" Это стандартные модули ноды. Смотрите, когда работаем в JavaScript-среде со сборщиком проекта, например с ES-модулями, у нас нет никаких модулей из коробки.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:48:37 --- Все модули мы должны установить через <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">npm install</code> — например, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">view</code> или что-то ещё. Потом пишем <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">import createApp from 'view'</code> или, условно, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">import { useState } from 'react'</code>. Все эти модули можно найти в папке <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">node_modules</code>, потому что мы их установили через пакетный менеджер.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:49:01 --- А в Node.js у нас есть ряд стандартных предустановленных модулей — встроенных в саму платформу. Такие модули как <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">process</code>, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">http</code>, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">fs</code> для работы с файловой системой и так далее. Таких модулей много. Когда мы пишем:</p>
<div class="relative group/copy bg-bg-000/50 border-0.5 border-border-400 rounded-lg"><div class="sticky opacity-0 group-hover/copy:opacity-100 top-2 py-2 h-12 w-0 float-right"><div class="absolute right-0 h-8 px-2 items-center inline-flex z-10"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)] h-8 w-8 rounded-md active:scale-95 backdrop-blur-md Button_ghost__BUAoh" type="button" aria-label="Copy to clipboard" data-state="closed"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 transition-all opacity-100 scale-100" aria-hidden="true"><path d="M12.5 3C13.3284 3 14 3.67157 14 4.5V6H15.5C16.3284 6 17 6.67157 17 7.5V15.5C17 16.3284 16.3284 17 15.5 17H7.5C6.67157 17 6 16.3284 6 15.5V14H4.5C3.67157 14 3 13.3284 3 12.5V4.5C3 3.67157 3.67157 3 4.5 3H12.5ZM14 12.5C14 13.3284 13.3284 14 12.5 14H7V15.5C7 15.7761 7.22386 16 7.5 16H15.5C15.7761 16 16 15.7761 16 15.5V7.5C16 7.22386 15.7761 7 15.5 7H14V12.5ZM4.5 4C4.22386 4 4 4.22386 4 4.5V12.5C4 12.7761 4.22386 13 4.5 13H12.5C12.7761 13 13 12.7761 13 12.5V4.5C13 4.22386 12.7761 4 12.5 4H4.5Z"></path></svg></div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 absolute top-0 left-0 transition-all opacity-0 scale-50" aria-hidden="true"><path d="M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"></path></svg></div></div></button></div></div><div class="text-text-500 font-small p-3.5 pb-0">javascript</div><div><pre class="code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border-radius: 0.3em;"><code class="language-javascript" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none;"><span><span class="token" style="color: rgb(198, 120, 221);">const</span><span> http </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">require</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(152, 195, 121);">'http'</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// или</span><span>
</span></span><span><span></span><span class="token module" style="color: rgb(198, 120, 221);">import</span><span> </span><span class="token imports" style="color: rgb(171, 178, 191);">{</span><span class="token imports"> createServer </span><span class="token imports" style="color: rgb(171, 178, 191);">}</span><span> </span><span class="token module" style="color: rgb(198, 120, 221);">from</span><span> </span><span class="token" style="color: rgb(152, 195, 121);">'http'</span><span class="token" style="color: rgb(171, 178, 191);">;</span></span></code></pre></div></div>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">мы подключаем заранее готовый системный модуль ноды. Пощупать руками его нельзя нигде — он находится где-то в папке, куда мы устанавливали Node.js при первой установке на компьютер.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:49:26 --- Там это в совершенно нечитаемом виде, даже неизвестно, на каком языке там всё под капотом. Это надо просто читать в документации на сайте Node.js — что из себя этот модуль представляет, какие у него есть функции и так далее. Кстати, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Express</code> — это простейшая обёртка над <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">http</code>, которая позволяет удобным образом обрабатывать запросы.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:49:58 --- Как понимать по названию, что это встроенный модуль? По сути да — когда пишем путь с точкой или слешем (<code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">./</code>, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">../</code>, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">/</code>), система ищет модуль в нашей файловой системе. Когда начинаем путь до модуля без точки и без слешей, то система ищет его в списке установленных модулей.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:50:24 --- Сначала она ищет в папке <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">node_modules</code>. Если в <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">node_modules</code> этого модуля нет, последний шанс — проверить, не является ли это системным модулем. Для Node.js по названию <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">http</code> он найдёт системный модуль и отдаст нам данные с него. Если я тут напишу <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">http1</code>, он просто скажет: "Cannot find package" и так далее.</p>
<img :src="screenshot_3062" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:50:53 --- Итак, варианты: <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">setInterval</code>, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">setTimeout</code>, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">while(true)</code>... Но смотрите, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">while(true)</code> — это не совсем то, что нужно. С <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">while(true)</code> мы породили бы бесконечный синхронный код, который подвесил бы нашу программу внутри этого цикла, и она не смогла бы обрабатывать запросы. <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">setInterval</code> — да, можно, но проще всего поставить <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">setTimeout</code> на очень большое время:</p>
<div class="relative group/copy bg-bg-000/50 border-0.5 border-border-400 rounded-lg"><div class="sticky opacity-0 group-hover/copy:opacity-100 top-2 py-2 h-12 w-0 float-right"><div class="absolute right-0 h-8 px-2 items-center inline-flex z-10"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)] h-8 w-8 rounded-md active:scale-95 backdrop-blur-md Button_ghost__BUAoh" type="button" aria-label="Copy to clipboard" data-state="closed"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 transition-all opacity-100 scale-100" aria-hidden="true"><path d="M12.5 3C13.3284 3 14 3.67157 14 4.5V6H15.5C16.3284 6 17 6.67157 17 7.5V15.5C17 16.3284 16.3284 17 15.5 17H7.5C6.67157 17 6 16.3284 6 15.5V14H4.5C3.67157 14 3 13.3284 3 12.5V4.5C3 3.67157 3.67157 3 4.5 3H12.5ZM14 12.5C14 13.3284 13.3284 14 12.5 14H7V15.5C7 15.7761 7.22386 16 7.5 16H15.5C15.7761 16 16 15.7761 16 15.5V7.5C16 7.22386 15.7761 7 15.5 7H14V12.5ZM4.5 4C4.22386 4 4 4.22386 4 4.5V12.5C4 12.7761 4.22386 13 4.5 13H12.5C12.7761 13 13 12.7761 13 12.5V4.5C13 4.22386 12.7761 4 12.5 4H4.5Z"></path></svg></div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 absolute top-0 left-0 transition-all opacity-0 scale-50" aria-hidden="true"><path d="M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"></path></svg></div></div></button></div></div><div class="text-text-500 font-small p-3.5 pb-0">javascript</div><div><pre class="code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border-radius: 0.3em;"><code class="language-javascript" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none;"><span><span class="token" style="color: rgb(97, 175, 239);">setTimeout</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token arrow" style="color: rgb(97, 175, 239);">=&gt;</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>
</span></span><span><span>  </span><span class="token console" style="color: rgb(209, 154, 102);">console</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">log</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(152, 195, 121);">'Hello World'</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">1_000_000_000</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span> </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// миллиард миллисекунд — примерно 30 лет</span></span></code></pre></div></div>
<img :src="screenshot_3100" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:51:22 --- Сервер отработает практически 30 лет без выключения! Чтобы программа не завершалась, можно спокойно поставить какой-нибудь очень сильно отсроченный <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">макротаск</code>. Но под капотом <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">createServer</code> идёт работа, которая не требует таких извращений. Прослушка порта — это сама по себе операция <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">input-output</code>, правильно? По сути, на этом порту мы просто смотрим входящий поток данных.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:51:53 --- Это асинхронная <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">I/O-операция</code>, которая держит <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">event loop</code> активным без блокировки основного потока. Вряд ли там есть необходимость прописывать <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">setTimeout</code> на миллиард секунд. Но просьба плюсами подтвердить, если понятно, что теоретически мы можем сделать программу, которая никогда не завершится, за счёт такой простейшей операции — подписаться на <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">setTimeout</code> на миллиард секунд и заниматься в программе своими делами.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:52:16 --- Зачем именно <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">setTimeout</code>? Хороший вопрос! Если мы подписываемся на любой ивент, то всё равно не даём списку макротасков опустеть, верно? Если подписываемся, например, на то, что кто-то обращается к какому-то файлу типа <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">hosts</code> или ещё что-то, мы всё равно на какой-то <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">макротаск</code> подписываемся.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:52:44 --- Это верно. Но это был просто абстрактный пример, как сделать программу незавершающейся. А здесь идёт чтение потока на порту 3000, поэтому программа не завершается. Давайте добавим вывод в консоль:</p>
<div class="relative group/copy bg-bg-000/50 border-0.5 border-border-400 rounded-lg"><div class="sticky opacity-0 group-hover/copy:opacity-100 top-2 py-2 h-12 w-0 float-right"><div class="absolute right-0 h-8 px-2 items-center inline-flex z-10"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)] h-8 w-8 rounded-md active:scale-95 backdrop-blur-md Button_ghost__BUAoh" type="button" aria-label="Copy to clipboard" data-state="closed"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 transition-all opacity-100 scale-100" aria-hidden="true"><path d="M12.5 3C13.3284 3 14 3.67157 14 4.5V6H15.5C16.3284 6 17 6.67157 17 7.5V15.5C17 16.3284 16.3284 17 15.5 17H7.5C6.67157 17 6 16.3284 6 15.5V14H4.5C3.67157 14 3 13.3284 3 12.5V4.5C3 3.67157 3.67157 3 4.5 3H12.5ZM14 12.5C14 13.3284 13.3284 14 12.5 14H7V15.5C7 15.7761 7.22386 16 7.5 16H15.5C15.7761 16 16 15.7761 16 15.5V7.5C16 7.22386 15.7761 7 15.5 7H14V12.5ZM4.5 4C4.22386 4 4 4.22386 4 4.5V12.5C4 12.7761 4.22386 13 4.5 13H12.5C12.7761 13 13 12.7761 13 12.5V4.5C13 4.22386 12.7761 4 12.5 4H4.5Z"></path></svg></div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 absolute top-0 left-0 transition-all opacity-0 scale-50" aria-hidden="true"><path d="M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"></path></svg></div></div></button></div></div><div class="text-text-500 font-small p-3.5 pb-0">javascript</div><div><pre class="code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border-radius: 0.3em;"><code class="language-javascript" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none;"><span><span class="token console" style="color: rgb(209, 154, 102);">console</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">log</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(152, 195, 121);">'Сервер активен!'</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span></span></code></pre></div></div>
<img :src="screenshot_3208" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:53:13 --- Теперь действительно любой человек может подключиться к порту 3000 и остаться там. Захожу на <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">localhost:3000</code> — вкладка крутится, никакого таймаута нет, запрос обрабатывается, но не завершится никогда. Давайте добавим завершение запроса:</p>
<div class="relative group/copy bg-bg-000/50 border-0.5 border-border-400 rounded-lg"><div class="sticky opacity-0 group-hover/copy:opacity-100 top-2 py-2 h-12 w-0 float-right"><div class="absolute right-0 h-8 px-2 items-center inline-flex z-10"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)] h-8 w-8 rounded-md active:scale-95 backdrop-blur-md Button_ghost__BUAoh" type="button" aria-label="Copy to clipboard" data-state="closed"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 transition-all opacity-100 scale-100" aria-hidden="true"><path d="M12.5 3C13.3284 3 14 3.67157 14 4.5V6H15.5C16.3284 6 17 6.67157 17 7.5V15.5C17 16.3284 16.3284 17 15.5 17H7.5C6.67157 17 6 16.3284 6 15.5V14H4.5C3.67157 14 3 13.3284 3 12.5V4.5C3 3.67157 3.67157 3 4.5 3H12.5ZM14 12.5C14 13.3284 13.3284 14 12.5 14H7V15.5C7 15.7761 7.22386 16 7.5 16H15.5C15.7761 16 16 15.7761 16 15.5V7.5C16 7.22386 15.7761 7 15.5 7H14V12.5ZM4.5 4C4.22386 4 4 4.22386 4 4.5V12.5C4 12.7761 4.22386 13 4.5 13H12.5C12.7761 13 13 12.7761 13 12.5V4.5C13 4.22386 12.7761 4 12.5 4H4.5Z"></path></svg></div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 absolute top-0 left-0 transition-all opacity-0 scale-50" aria-hidden="true"><path d="M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"></path></svg></div></div></button></div></div><div class="text-text-500 font-small p-3.5 pb-0">javascript</div><div><pre class="code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border-radius: 0.3em;"><code class="language-javascript" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none;"><span><span>response</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">end</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(152, 195, 121);">'hi there'</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span></span></code></pre></div></div>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:53:41 --- Мне надо перезапустить сервер. Это, кстати, достаточно неудобно. Поэтому зачастую ставится какая-нибудь дополнительная программа, например, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">nodemon</code> — популярный пакет для разработки. На продакшене, конечно, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">PM2</code> считается значительно серьёзнее — это полноценный процесс-менеджер.</p>
<img :src="screenshot_3252" alt="Image" >
<img :src="screenshot_3269" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:54:09 --- Популярность у <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">nodemon</code> выше для разработки, но для развёртывания на боевых серверах <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">PM2</code> логичнее. Мы пока берём более простую штуку. Пропишем команду в <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">package.json</code>:</p>
<div class="relative group/copy bg-bg-000/50 border-0.5 border-border-400 rounded-lg"><div class="sticky opacity-0 group-hover/copy:opacity-100 top-2 py-2 h-12 w-0 float-right"><div class="absolute right-0 h-8 px-2 items-center inline-flex z-10"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)] h-8 w-8 rounded-md active:scale-95 backdrop-blur-md Button_ghost__BUAoh" type="button" aria-label="Copy to clipboard" data-state="closed"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 transition-all opacity-100 scale-100" aria-hidden="true"><path d="M12.5 3C13.3284 3 14 3.67157 14 4.5V6H15.5C16.3284 6 17 6.67157 17 7.5V15.5C17 16.3284 16.3284 17 15.5 17H7.5C6.67157 17 6 16.3284 6 15.5V14H4.5C3.67157 14 3 13.3284 3 12.5V4.5C3 3.67157 3.67157 3 4.5 3H12.5ZM14 12.5C14 13.3284 13.3284 14 12.5 14H7V15.5C7 15.7761 7.22386 16 7.5 16H15.5C15.7761 16 16 15.7761 16 15.5V7.5C16 7.22386 15.7761 7 15.5 7H14V12.5ZM4.5 4C4.22386 4 4 4.22386 4 4.5V12.5C4 12.7761 4.22386 13 4.5 13H12.5C12.7761 13 13 12.7761 13 12.5V4.5C13 4.22386 12.7761 4 12.5 4H4.5Z"></path></svg></div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 absolute top-0 left-0 transition-all opacity-0 scale-50" aria-hidden="true"><path d="M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"></path></svg></div></div></button></div></div><div class="text-text-500 font-small p-3.5 pb-0">json</div><div><pre class="code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border-radius: 0.3em;"><code class="language-json" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none;"><span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(224, 108, 117);">"scripts"</span><span class="token" style="color: rgb(97, 175, 239);">:</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(224, 108, 117);">"server"</span><span class="token" style="color: rgb(97, 175, 239);">:</span><span> </span><span class="token" style="color: rgb(152, 195, 121);">"nodemon server.js --watch server.js"</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(171, 178, 191);">}</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(171, 178, 191);">}</span></span></code></pre></div></div>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:54:47 --- Не факт, что я правильно сделал, но сейчас проверим. Эту программу запускаешь именно в процессе разработки чаще, чем в реальности. Давайте назовём команду <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">server</code>. Запускаем: <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">npm run server</code>.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:55:07 --- Так, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">--watch</code> прописал. Ага, "watching server.js, watching extensions" — окей, стартует! Теперь, когда буду менять код, сервер будет перезапускаться сам. Это очень удобно, потому что лезть в консоль, постоянно нажимать Ctrl+C и перезапускать — дико раздражает.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:55:35 --- Сергей пишет, что для понимания, что модуль тянется из ноды, можно писать <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">node:http</code>. Если работаем в стиле CommonJS, то да — <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">require('node:http')</code>. Здесь я так не писал, но тоже работает — берём стандартный модуль ноды. Соответственно, давайте посмотрим, что происходит теперь.</p>
<img :src="screenshot_3363" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:56:00 --- Заходим на порт 3000 — видим "hi there". Всё вроде нормально. Но это не показывает специфику ноды. А вот что покажет специфику сразу:</p>
<div class="relative group/copy bg-bg-000/50 border-0.5 border-border-400 rounded-lg"><div class="sticky opacity-0 group-hover/copy:opacity-100 top-2 py-2 h-12 w-0 float-right"><div class="absolute right-0 h-8 px-2 items-center inline-flex z-10"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)] h-8 w-8 rounded-md active:scale-95 backdrop-blur-md Button_ghost__BUAoh" type="button" aria-label="Copy to clipboard" data-state="closed"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 transition-all opacity-100 scale-100" aria-hidden="true"><path d="M12.5 3C13.3284 3 14 3.67157 14 4.5V6H15.5C16.3284 6 17 6.67157 17 7.5V15.5C17 16.3284 16.3284 17 15.5 17H7.5C6.67157 17 6 16.3284 6 15.5V14H4.5C3.67157 14 3 13.3284 3 12.5V4.5C3 3.67157 3.67157 3 4.5 3H12.5ZM14 12.5C14 13.3284 13.3284 14 12.5 14H7V15.5C7 15.7761 7.22386 16 7.5 16H15.5C15.7761 16 16 15.7761 16 15.5V7.5C16 7.22386 15.7761 7 15.5 7H14V12.5ZM4.5 4C4.22386 4 4 4.22386 4 4.5V12.5C4 12.7761 4.22386 13 4.5 13H12.5C12.7761 13 13 12.7761 13 12.5V4.5C13 4.22386 12.7761 4 12.5 4H4.5Z"></path></svg></div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 absolute top-0 left-0 transition-all opacity-0 scale-50" aria-hidden="true"><path d="M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"></path></svg></div></div></button></div></div><div class="text-text-500 font-small p-3.5 pb-0">javascript</div><div><pre class="code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border-radius: 0.3em;"><code class="language-javascript" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none;"><span><span class="token" style="color: rgb(198, 120, 221);">let</span><span> cnt </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span>
</span><span><span></span><span class="token" style="color: rgb(198, 120, 221);">const</span><span> server </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">createServer</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token parameter">request</span><span class="token parameter" style="color: rgb(171, 178, 191);">,</span><span class="token parameter"> response</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token arrow" style="color: rgb(97, 175, 239);">=&gt;</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>
</span></span><span><span>  response</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">end</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token template-string template-punctuation" style="color: rgb(152, 195, 121);">`</span><span class="token template-string" style="color: rgb(152, 195, 121);">Вы </span><span class="token template-string interpolation" style="color: rgb(171, 178, 191);">${</span><span class="token template-string interpolation" style="color: rgb(97, 175, 239);">++</span><span class="token template-string interpolation">cnt</span><span class="token template-string interpolation" style="color: rgb(171, 178, 191);">}</span><span class="token template-string" style="color: rgb(152, 195, 121);">-й клиент нашего сайта</span><span class="token template-string template-punctuation" style="color: rgb(152, 195, 121);">`</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span></span></code></pre></div></div>
<img :src="screenshot_3402" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:56:32 --- Смотрите, что будет происходить. Захожу из Chrome — "Вы 1-й клиент нашего сайта". Открываю Firefox — "Вы 3-й клиент". Почему третий? Потому что вкладка, которая была открыта с <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">localhost:3000</code>, перезапустилась сама, видимо. Или знаете, почему ещё?</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:56:56 --- Это не магия. Эти браузеры запрашивают адрес <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">favicon.ico</code> автоматически. Сергей про это тоже написал. Если откроем Network в DevTools, особенно с отключённым кэшем, увидим — браузер пытается запросить <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">favicon.ico</code>. Вот он виден в логах — браузер автоматически делает запрос на <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">/favicon.ico</code>, даже если мы это нигде не прописали.</p>
<img :src="screenshot_3471" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:57:25 --- Он хочет получить иконку для отображения во вкладке. Поэтому у нас идут два запроса на каждую загрузку страницы. Видите: по <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">/</code> отдаём "hi there, вы 20-й клиент", а по <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">/favicon.ico</code> — "вы 21-й клиент". Это специфика браузера — он в любом случае запрашивает фавикон, зараза такая.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">Заметьте самое важное: это <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">общая переменная</code> для всех клиентов! Получается, что это ровно один скрипт. Хоть к нам тысяча клиентов подключится — скрипт один, переменная <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">cnt</code> одна для всех.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:57:53 --- Из этого следуют очень интересные выводы на тему Node.js относительно того же PHP. В PHP такого нет — чтобы сделать там такую систему <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">общего состояния</code>, надо сильно постараться. Вообще получится сделать общую переменную просто так, придётся либо в Redis где-то данные хранить, либо ещё что-то изобретать. А в Node.js это из коробки.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:58:19 --- Это дико удобно, когда хотим сделать, например, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">real-time коммуникации</code>. У нас есть какой-то список клиентов, которые подписались на взаимодействие с нами по, скажем, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">WebSocket</code> или технологии <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Server-Sent Events</code>. Мы просто накапливаем их в массиве, потом пробегаем по списку и рассылаем всем события. Это очень удобно!</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:58:50 --- Но из этого следует такая специфика: здесь гораздо легче, чем в PHP, накосячить. Почему? В PHP ты накосячил, по какому-то запросу забил оперативку слишком сильно — эта оперативка освободится, когда клиент уйдёт. Когда он получил ответ от сервера, всё! Остальные клиенты работают с чистого листа в отдельных процессах, по сути.</p>
<img :src="screenshot_3575" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:59:15 --- Когда работаем в Node.js, нам один раз стоит накосячить — и зависать всё будет у всех клиентов сразу. Если где-то сделали переменную, которая переполнила оперативку дико, или написали огромную вычислительную задачу и по какому-то запросу её стартовали, то у всех клиентов система будет тупить. Почему она будет тупить?</p>
<img :src="screenshot_3601" alt="Image" >
<img :src="screenshot_3611" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">00:59:48 --- Потому что если мы заняли поток долгими вычислениями из какого-то <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">макротаска</code> — вот написали длинный цикл, например — то все остальные клиенты будут ждать. Давайте снова посмотрим на схему работы <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">event loop</code>. Рисую новым цветом для наглядности.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:00:13 --- Вот новый клиент к нам приходит — для него создаётся новый <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">макротаск</code> в очереди. Система заметила, что на порт 3000 пришёл новый клиент — поставила для него макротаск. Вот три клиента подключились — три макротаска в очереди: первый, второй, третий. Допустим, у первого клиента идёт обработка макротаска, и он полез в базу данных. Создаётся новый макротаск — ожидание ответа от базы.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:00:53 --- Пока первый клиент ждёт ответа от базы, начинается обработка запроса второго клиента. Если он не лезет в базу, а получает простую статическую страницу, то ему её сразу показали — всё хорошо! А теперь представьте: при обработке макротаска первого клиента из базы получили 10 тысяч строк или 100 тысяч строк и стали по ним делать расчёт какой-то аналитики — полностью синхронный расчёт.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">Получили данные из базы и запускаем синхронно написанную нейросеть в JavaScript, которая не умеет умножать матрицы параллельно, а умножает поэлементно каждую их часть. Это всё идёт как длинная синхронная операция.</p>
<img :src="screenshot_3705" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:01:20 --- И третий клиент будет ждать, даже если ему нужна простая статическая страница! Он будет ждать, потому что его <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">макротаск</code> не запустят, не зарезолвят, пока все <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">микротаски</code> не завершатся в текущем скрипте и пока не закончится текущий синхронный блок кода. Поэтому этот код надо писать аккуратно.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">Просьба плюсами подтвердить, если понятна специфика! И мы тогда отправимся на перерыв. После перерыва будем дальше разбираться, сделаем конкретный пример — специально напишем сложную длинную вычислительную задачу, бессмысленную, и увидим, как на это отреагируют остальные клиенты, которые будут хотеть получить даже самую простую страницу.</p>
<hr class="border-border-200 border-t-0.5 my-3 mx-1.5">
<h2 class="text-text-100 mt-3 -mb-1 text-[1.125rem] font-bold">Дополнительные объяснения</h2>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">Что такое Event Loop (Цикл событий)</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Event Loop</code> — это механизм, который позволяет Node.js выполнять асинхронные операции, несмотря на то, что JavaScript однопоточный. Представьте себе официанта в ресторане: он не стоит у каждого столика и не ждёт, пока гости закончат есть. Вместо этого он принимает заказ, относит его на кухню, идёт к следующему столику, потом возвращается за готовыми блюдами и разносит их.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Как это работает:</strong></p>
<ol class="[li_&amp;]:mb-0 [li_&amp;]:mt-1.5 [li_&amp;]:gap-1.5 [&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-decimal flex flex-col gap-2 pl-8 mb-3">
<li class="whitespace-normal break-words pl-2"><strong>Синхронный код</strong> выполняется сразу и до конца</li>
<li class="whitespace-normal break-words pl-2">После него выполняются все <strong>микротаски</strong> (Promises, process.nextTick)</li>
<li class="whitespace-normal break-words pl-2">Затем берётся следующий <strong>макротаск</strong> из очереди (setTimeout, I/O операции, запросы клиентов)</li>
<li class="whitespace-normal break-words pl-2">Цикл повторяется</li>
</ol>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Пример последовательности:</strong></p>
<div class="relative group/copy bg-bg-000/50 border-0.5 border-border-400 rounded-lg"><div class="sticky opacity-0 group-hover/copy:opacity-100 top-2 py-2 h-12 w-0 float-right"><div class="absolute right-0 h-8 px-2 items-center inline-flex z-10"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)] h-8 w-8 rounded-md active:scale-95 backdrop-blur-md Button_ghost__BUAoh" type="button" aria-label="Copy to clipboard" data-state="closed"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 transition-all opacity-100 scale-100" aria-hidden="true"><path d="M12.5 3C13.3284 3 14 3.67157 14 4.5V6H15.5C16.3284 6 17 6.67157 17 7.5V15.5C17 16.3284 16.3284 17 15.5 17H7.5C6.67157 17 6 16.3284 6 15.5V14H4.5C3.67157 14 3 13.3284 3 12.5V4.5C3 3.67157 3.67157 3 4.5 3H12.5ZM14 12.5C14 13.3284 13.3284 14 12.5 14H7V15.5C7 15.7761 7.22386 16 7.5 16H15.5C15.7761 16 16 15.7761 16 15.5V7.5C16 7.22386 15.7761 7 15.5 7H14V12.5ZM4.5 4C4.22386 4 4 4.22386 4 4.5V12.5C4 12.7761 4.22386 13 4.5 13H12.5C12.7761 13 13 12.7761 13 12.5V4.5C13 4.22386 12.7761 4 12.5 4H4.5Z"></path></svg></div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 absolute top-0 left-0 transition-all opacity-0 scale-50" aria-hidden="true"><path d="M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"></path></svg></div></div></button></div></div><div class="text-text-500 font-small p-3.5 pb-0">javascript</div><div><pre class="code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border-radius: 0.3em;"><code class="language-javascript" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none;"><span><span class="token console" style="color: rgb(209, 154, 102);">console</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">log</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(152, 195, 121);">'1. Синхронный код'</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span>
</span><span><span></span><span class="token known-class-name" style="color: rgb(209, 154, 102);">Promise</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">resolve</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">then</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token arrow" style="color: rgb(97, 175, 239);">=&gt;</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>
</span></span><span><span>  </span><span class="token console" style="color: rgb(209, 154, 102);">console</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">log</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(152, 195, 121);">'2. Микротаск (Promise)'</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span>
</span><span><span></span><span class="token" style="color: rgb(97, 175, 239);">setTimeout</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token arrow" style="color: rgb(97, 175, 239);">=&gt;</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>
</span></span><span><span>  </span><span class="token console" style="color: rgb(209, 154, 102);">console</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">log</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(152, 195, 121);">'3. Макротаск (setTimeout)'</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span>
</span><span><span></span><span class="token console" style="color: rgb(209, 154, 102);">console</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">log</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(152, 195, 121);">'4. Синхронный код продолжается'</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span>
</span><span><span></span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// Вывод:</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// 1. Синхронный код</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// 4. Синхронный код продолжается</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// 2. Микротаск (Promise)</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// 3. Макротаск (setTimeout)</span></span></code></pre></div></div>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">Алгоритм разрешения модулей</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">Когда вы пишете <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">import</code> или <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">require</code>, Node.js ищет модуль по определённому алгоритму:</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Шаг 1:</strong> Если путь начинается с <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">./</code>, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">../</code> или <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">/</code></p>
<ul class="[li_&amp;]:mb-0 [li_&amp;]:mt-1.5 [li_&amp;]:gap-1.5 [&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-disc flex flex-col gap-2 pl-8 mb-3">
<li class="whitespace-normal break-words pl-2">Node.js ищет файл в файловой системе по указанному пути</li>
<li class="whitespace-normal break-words pl-2">Пример: <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">import { myFunc } from './utils.js'</code></li>
</ul>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Шаг 2:</strong> Если путь не содержит префиксов</p>
<ul class="[li_&amp;]:mb-0 [li_&amp;]:mt-1.5 [li_&amp;]:gap-1.5 [&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-disc flex flex-col gap-2 pl-8 mb-3">
<li class="whitespace-normal break-words pl-2">Сначала ищет в папке <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">node_modules</code> текущего проекта</li>
<li class="whitespace-normal break-words pl-2">Если не находит, поднимается выше по директориям и ищет в родительских <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">node_modules</code></li>
<li class="whitespace-normal break-words pl-2">Пример: <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">import express from 'express'</code> → ищет в <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">node_modules/express</code></li>
</ul>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Шаг 3:</strong> Встроенные модули Node.js</p>
<ul class="[li_&amp;]:mb-0 [li_&amp;]:mt-1.5 [li_&amp;]:gap-1.5 [&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-disc flex flex-col gap-2 pl-8 mb-3">
<li class="whitespace-normal break-words pl-2">Если модуль не найден в <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">node_modules</code>, проверяет список встроенных модулей</li>
<li class="whitespace-normal break-words pl-2">Встроенные модули: <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">http</code>, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">fs</code>, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">path</code>, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">process</code>, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">crypto</code>, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">stream</code> и многие другие</li>
<li class="whitespace-normal break-words pl-2">Пример: <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">import { readFile } from 'fs'</code> → использует встроенный модуль</li>
<li class="whitespace-normal break-words pl-2">Можно явно указать: <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">import { readFile } from 'node:fs'</code></li>
</ul>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Если модуль не найден нигде</strong> — получаем ошибку "Cannot find module".</p>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">Node.js vs PHP: Модели памяти</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">Это одно из ключевых различий между платформами, которое влияет на всю архитектуру приложения.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>PHP (традиционная модель):</strong></p>
<ul class="[li_&amp;]:mb-0 [li_&amp;]:mt-1.5 [li_&amp;]:gap-1.5 [&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-disc flex flex-col gap-2 pl-8 mb-3">
<li class="whitespace-normal break-words pl-2">Каждый запрос = новый процесс или отдельный поток</li>
<li class="whitespace-normal break-words pl-2">У каждого запроса своя изолированная память</li>
<li class="whitespace-normal break-words pl-2">Переменные существуют только во время обработки одного запроса</li>
<li class="whitespace-normal break-words pl-2">После отправки ответа вся память освобождается</li>
<li class="whitespace-normal break-words pl-2">Невозможно случайно "протечь" память между запросами</li>
<li class="whitespace-normal break-words pl-2">Для общих данных нужны внешние хранилища (Redis, Memcached, база данных)</li>
</ul>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Node.js (модель общего состояния):</strong></p>
<ul class="[li_&amp;]:mb-0 [li_&amp;]:mt-1.5 [li_&amp;]:gap-1.5 [&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-disc flex flex-col gap-2 pl-8 mb-3">
<li class="whitespace-normal break-words pl-2">Один процесс обрабатывает все запросы</li>
<li class="whitespace-normal break-words pl-2">Вся память общая для всех клиентов</li>
<li class="whitespace-normal break-words pl-2">Переменные существуют до перезапуска сервера</li>
<li class="whitespace-normal break-words pl-2">Одна ошибка с памятью влияет на всех пользователей</li>
<li class="whitespace-normal break-words pl-2">Можно легко хранить данные в памяти (массивы клиентов, кэш)</li>
<li class="whitespace-normal break-words pl-2">Идеально для real-time приложений</li>
</ul>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Когда Node.js лучше:</strong></p>
<ul class="[li_&amp;]:mb-0 [li_&amp;]:mt-1.5 [li_&amp;]:gap-1.5 [&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-disc flex flex-col gap-2 pl-8 mb-3">
<li class="whitespace-normal break-words pl-2">Чат-приложения (WebSocket соединения)</li>
<li class="whitespace-normal break-words pl-2">Live-дашборды и графики реального времени</li>
<li class="whitespace-normal break-words pl-2">Онлайн-игры с общим состоянием</li>
<li class="whitespace-normal break-words pl-2">Совместное редактирование документов</li>
</ul>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Когда PHP безопаснее:</strong></p>
<ul class="[li_&amp;]:mb-0 [li_&amp;]:mt-1.5 [li_&amp;]:gap-1.5 [&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-disc flex flex-col gap-2 pl-8 mb-3">
<li class="whitespace-normal break-words pl-2">Когда разработчики не очень опытные</li>
<li class="whitespace-normal break-words pl-2">Когда нужна максимальная изоляция между запросами</li>
<li class="whitespace-normal break-words pl-2">Когда сложно предсказать нагрузку на память</li>
</ul>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">Пошаговый сценарий блокировки</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">Давайте разберём по шагам, что происходит, когда один клиент блокирует всех остальных:</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Начальная ситуация:</strong></p>
<ul class="[li_&amp;]:mb-0 [li_&amp;]:mt-1.5 [li_&amp;]:gap-1.5 [&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-disc flex flex-col gap-2 pl-8 mb-3">
<li class="whitespace-normal break-words pl-2">Сервер запущен и ждёт клиентов</li>
<li class="whitespace-normal break-words pl-2">Event Loop свободен и готов обрабатывать запросы</li>
</ul>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Шаг 1:</strong> Клиент A делает запрос</p>
<ul class="[li_&amp;]:mb-0 [li_&amp;]:mt-1.5 [li_&amp;]:gap-1.5 [&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-disc flex flex-col gap-2 pl-8 mb-3">
<li class="whitespace-normal break-words pl-2">Создаётся макротаск для обработки запроса</li>
<li class="whitespace-normal break-words pl-2">Event Loop начинает выполнять этот макротаск</li>
</ul>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Шаг 2:</strong> Клиент A запрашивает данные из базы</p>
<ul class="[li_&amp;]:mb-0 [li_&amp;]:mt-1.5 [li_&amp;]:gap-1.5 [&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-disc flex flex-col gap-2 pl-8 mb-3">
<li class="whitespace-normal break-words pl-2">Отправляется асинхронный запрос в базу данных</li>
<li class="whitespace-normal break-words pl-2">Создаётся новый макротаск: "ждать ответ от БД"</li>
<li class="whitespace-normal break-words pl-2">Event Loop переходит к следующему макротаску</li>
</ul>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Шаг 3:</strong> Клиент B делает запрос на статическую страницу</p>
<ul class="[li_&amp;]:mb-0 [li_&amp;]:mt-1.5 [li_&amp;]:gap-1.5 [&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-disc flex flex-col gap-2 pl-8 mb-3">
<li class="whitespace-normal break-words pl-2">Создаётся макротаск для Клиента B</li>
<li class="whitespace-normal break-words pl-2">Запрос обрабатывается быстро</li>
<li class="whitespace-normal break-words pl-2">Клиент B получает ответ — всё отлично!</li>
</ul>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Шаг 4:</strong> База данных возвращает данные Клиенту A</p>
<ul class="[li_&amp;]:mb-0 [li_&amp;]:mt-1.5 [li_&amp;]:gap-1.5 [&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-disc flex flex-col gap-2 pl-8 mb-3">
<li class="whitespace-normal break-words pl-2">Макротаск "ответ от БД" активируется</li>
<li class="whitespace-normal break-words pl-2">Начинается обработка данных</li>
</ul>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Шаг 5:</strong> ⚠️ ПРОБЛЕМА — Синхронная обработка больших данных</p>
<div class="relative group/copy bg-bg-000/50 border-0.5 border-border-400 rounded-lg"><div class="sticky opacity-0 group-hover/copy:opacity-100 top-2 py-2 h-12 w-0 float-right"><div class="absolute right-0 h-8 px-2 items-center inline-flex z-10"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)] h-8 w-8 rounded-md active:scale-95 backdrop-blur-md Button_ghost__BUAoh" type="button" aria-label="Copy to clipboard" data-state="closed"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 transition-all opacity-100 scale-100" aria-hidden="true"><path d="M12.5 3C13.3284 3 14 3.67157 14 4.5V6H15.5C16.3284 6 17 6.67157 17 7.5V15.5C17 16.3284 16.3284 17 15.5 17H7.5C6.67157 17 6 16.3284 6 15.5V14H4.5C3.67157 14 3 13.3284 3 12.5V4.5C3 3.67157 3.67157 3 4.5 3H12.5ZM14 12.5C14 13.3284 13.3284 14 12.5 14H7V15.5C7 15.7761 7.22386 16 7.5 16H15.5C15.7761 16 16 15.7761 16 15.5V7.5C16 7.22386 15.7761 7 15.5 7H14V12.5ZM4.5 4C4.22386 4 4 4.22386 4 4.5V12.5C4 12.7761 4.22386 13 4.5 13H12.5C12.7761 13 13 12.7761 13 12.5V4.5C13 4.22386 12.7761 4 12.5 4H4.5Z"></path></svg></div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 absolute top-0 left-0 transition-all opacity-0 scale-50" aria-hidden="true"><path d="M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"></path></svg></div></div></button></div></div><div class="text-text-500 font-small p-3.5 pb-0">javascript</div><div><pre class="code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border-radius: 0.3em;"><code class="language-javascript" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none;"><span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// Получили 100,000 строк из базы</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(198, 120, 221);">const</span><span> rows </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token control-flow" style="color: rgb(198, 120, 221);">await</span><span> db</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">query</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(152, 195, 121);">'SELECT * FROM big_table'</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span>
</span><span><span></span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// Начинаем синхронную обработку</span><span>
</span></span><span><span></span><span class="token control-flow" style="color: rgb(198, 120, 221);">for</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(198, 120, 221);">let</span><span> i </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span> i </span><span class="token" style="color: rgb(97, 175, 239);">&lt;</span><span> rows</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token property-access">length</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span> i</span><span class="token" style="color: rgb(97, 175, 239);">++</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// Сложные вычисления для каждой строки</span><span>
</span></span><span><span>  result </span><span class="token" style="color: rgb(97, 175, 239);">+=</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">complexCalculation</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>rows</span><span class="token" style="color: rgb(171, 178, 191);">[</span><span>i</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(171, 178, 191);">}</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// Этот цикл может занять секунды!</span></span></code></pre></div></div>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Шаг 6:</strong> Клиент C пытается получить простую страницу</p>
<ul class="[li_&amp;]:mb-0 [li_&amp;]:mt-1.5 [li_&amp;]:gap-1.5 [&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-disc flex flex-col gap-2 pl-8 mb-3">
<li class="whitespace-normal break-words pl-2">Создаётся макротаск для Клиента C</li>
<li class="whitespace-normal break-words pl-2">НО! Event Loop не может его начать</li>
<li class="whitespace-normal break-words pl-2">Причина: всё ещё выполняется синхронный цикл из Шага 5</li>
<li class="whitespace-normal break-words pl-2">Клиент C висит и ждёт...</li>
</ul>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Шаг 7:</strong> Клиент D тоже пытается подключиться</p>
<ul class="[li_&amp;]:mb-0 [li_&amp;]:mt-1.5 [li_&amp;]:gap-1.5 [&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-disc flex flex-col gap-2 pl-8 mb-3">
<li class="whitespace-normal break-words pl-2">Его макротаск тоже встаёт в очередь</li>
<li class="whitespace-normal break-words pl-2">Тоже ждёт...</li>
</ul>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Шаг 8:</strong> Наконец цикл завершается</p>
<ul class="[li_&amp;]:mb-0 [li_&amp;]:mt-1.5 [li_&amp;]:gap-1.5 [&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-disc flex flex-col gap-2 pl-8 mb-3">
<li class="whitespace-normal break-words pl-2">Клиент A получает свой ответ</li>
<li class="whitespace-normal break-words pl-2">Event Loop переходит к макротаску Клиента C</li>
<li class="whitespace-normal break-words pl-2">Затем к макротаску Клиента D</li>
<li class="whitespace-normal break-words pl-2">Все наконец получают ответы</li>
</ul>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Время ожидания:</strong></p>
<ul class="[li_&amp;]:mb-0 [li_&amp;]:mt-1.5 [li_&amp;]:gap-1.5 [&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-disc flex flex-col gap-2 pl-8 mb-3">
<li class="whitespace-normal break-words pl-2">Если синхронный цикл занял 5 секунд</li>
<li class="whitespace-normal break-words pl-2">Клиент C ждал 5 секунд (хотя ему нужна простая страница!)</li>
<li class="whitespace-normal break-words pl-2">Клиент D ждал ещё дольше</li>
</ul>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Как избежать:</strong></p>
<div class="relative group/copy bg-bg-000/50 border-0.5 border-border-400 rounded-lg"><div class="sticky opacity-0 group-hover/copy:opacity-100 top-2 py-2 h-12 w-0 float-right"><div class="absolute right-0 h-8 px-2 items-center inline-flex z-10"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)] h-8 w-8 rounded-md active:scale-95 backdrop-blur-md Button_ghost__BUAoh" type="button" aria-label="Copy to clipboard" data-state="closed"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 transition-all opacity-100 scale-100" aria-hidden="true"><path d="M12.5 3C13.3284 3 14 3.67157 14 4.5V6H15.5C16.3284 6 17 6.67157 17 7.5V15.5C17 16.3284 16.3284 17 15.5 17H7.5C6.67157 17 6 16.3284 6 15.5V14H4.5C3.67157 14 3 13.3284 3 12.5V4.5C3 3.67157 3.67157 3 4.5 3H12.5ZM14 12.5C14 13.3284 13.3284 14 12.5 14H7V15.5C7 15.7761 7.22386 16 7.5 16H15.5C15.7761 16 16 15.7761 16 15.5V7.5C16 7.22386 15.7761 7 15.5 7H14V12.5ZM4.5 4C4.22386 4 4 4.22386 4 4.5V12.5C4 12.7761 4.22386 13 4.5 13H12.5C12.7761 13 13 12.7761 13 12.5V4.5C13 4.22386 12.7761 4 12.5 4H4.5Z"></path></svg></div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 absolute top-0 left-0 transition-all opacity-0 scale-50" aria-hidden="true"><path d="M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"></path></svg></div></div></button></div></div><div class="text-text-500 font-small p-3.5 pb-0">javascript</div><div><pre class="code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border-radius: 0.3em;"><code class="language-javascript" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none;"><span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// ПЛОХО - блокирует всех</span><span>
</span></span><span><span></span><span class="token control-flow" style="color: rgb(198, 120, 221);">for</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(198, 120, 221);">let</span><span> i </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span> i </span><span class="token" style="color: rgb(97, 175, 239);">&lt;</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">100000</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span> i</span><span class="token" style="color: rgb(97, 175, 239);">++</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>
</span></span><span><span>  result </span><span class="token" style="color: rgb(97, 175, 239);">+=</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">heavyCalculation</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>data</span><span class="token" style="color: rgb(171, 178, 191);">[</span><span>i</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(171, 178, 191);">}</span><span>
</span></span><span>
</span><span><span></span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// ХОРОШО - даём другим клиентам работать</span><span>
</span></span><span><span></span><span class="token control-flow" style="color: rgb(198, 120, 221);">for</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(198, 120, 221);">let</span><span> i </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span> i </span><span class="token" style="color: rgb(97, 175, 239);">&lt;</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">100000</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span> i</span><span class="token" style="color: rgb(97, 175, 239);">++</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>
</span></span><span><span>  result </span><span class="token" style="color: rgb(97, 175, 239);">+=</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">heavyCalculation</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>data</span><span class="token" style="color: rgb(171, 178, 191);">[</span><span>i</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// Каждые 100 итераций даём другим макротаскам шанс</span><span>
</span></span><span><span>  </span><span class="token control-flow" style="color: rgb(198, 120, 221);">if</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>i </span><span class="token" style="color: rgb(97, 175, 239);">%</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">100</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">===</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>
</span></span><span><span>    </span><span class="token control-flow" style="color: rgb(198, 120, 221);">await</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">new</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">Promise</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token parameter">resolve</span><span> </span><span class="token arrow" style="color: rgb(97, 175, 239);">=&gt;</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">setImmediate</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>resolve</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(171, 178, 191);">}</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(171, 178, 191);">}</span><span>
</span></span><span>
</span><span><span></span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// ЕЩЁ ЛУЧШЕ - выносим в отдельный процесс</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(198, 120, 221);">const</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span> </span><span class="token maybe-class-name">Worker</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">}</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">require</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(152, 195, 121);">'worker_threads'</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(198, 120, 221);">const</span><span> worker </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">new</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">Worker</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(152, 195, 121);">'./heavy-calculation.js'</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span></span></code></pre></div></div>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">I/O операции и асинхронность</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Что такое I/O операции:</strong></p>
<ul class="[li_&amp;]:mb-0 [li_&amp;]:mt-1.5 [li_&amp;]:gap-1.5 [&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-disc flex flex-col gap-2 pl-8 mb-3">
<li class="whitespace-normal break-words pl-2"><strong>I</strong> = Input (ввод) - чтение данных</li>
<li class="whitespace-normal break-words pl-2"><strong>O</strong> = Output (вывод) - запись данных</li>
<li class="whitespace-normal break-words pl-2">Примеры: чтение файлов, запросы к БД, сетевые запросы, прослушивание портов</li>
</ul>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Почему они не блокируют:</strong></p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">В традиционных языках (например, Java без асинхронности):</p>
<div class="relative group/copy bg-bg-000/50 border-0.5 border-border-400 rounded-lg"><div class="sticky opacity-0 group-hover/copy:opacity-100 top-2 py-2 h-12 w-0 float-right"><div class="absolute right-0 h-8 px-2 items-center inline-flex z-10"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)] h-8 w-8 rounded-md active:scale-95 backdrop-blur-md Button_ghost__BUAoh" type="button" aria-label="Copy to clipboard" data-state="closed"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 transition-all opacity-100 scale-100" aria-hidden="true"><path d="M12.5 3C13.3284 3 14 3.67157 14 4.5V6H15.5C16.3284 6 17 6.67157 17 7.5V15.5C17 16.3284 16.3284 17 15.5 17H7.5C6.67157 17 6 16.3284 6 15.5V14H4.5C3.67157 14 3 13.3284 3 12.5V4.5C3 3.67157 3.67157 3 4.5 3H12.5ZM14 12.5C14 13.3284 13.3284 14 12.5 14H7V15.5C7 15.7761 7.22386 16 7.5 16H15.5C15.7761 16 16 15.7761 16 15.5V7.5C16 7.22386 15.7761 7 15.5 7H14V12.5ZM4.5 4C4.22386 4 4 4.22386 4 4.5V12.5C4 12.7761 4.22386 13 4.5 13H12.5C12.7761 13 13 12.7761 13 12.5V4.5C13 4.22386 12.7761 4 12.5 4H4.5Z"></path></svg></div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 absolute top-0 left-0 transition-all opacity-0 scale-50" aria-hidden="true"><path d="M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"></path></svg></div></div></button></div></div><div class="text-text-500 font-small p-3.5 pb-0">java</div><div><pre class="code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border-radius: 0.3em;"><code class="language-java" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none;"><span><span class="token" style="color: rgb(209, 154, 102);">String</span><span> data </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">readFile</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(152, 195, 121);">"big-file.txt"</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span> </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// Ждём... 5 секунд</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// Все остальные операции стоят и ждут</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(97, 175, 239);">processData</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>data</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span></span></code></pre></div></div>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">В Node.js:</p>
<div class="relative group/copy bg-bg-000/50 border-0.5 border-border-400 rounded-lg"><div class="sticky opacity-0 group-hover/copy:opacity-100 top-2 py-2 h-12 w-0 float-right"><div class="absolute right-0 h-8 px-2 items-center inline-flex z-10"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)] h-8 w-8 rounded-md active:scale-95 backdrop-blur-md Button_ghost__BUAoh" type="button" aria-label="Copy to clipboard" data-state="closed"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 transition-all opacity-100 scale-100" aria-hidden="true"><path d="M12.5 3C13.3284 3 14 3.67157 14 4.5V6H15.5C16.3284 6 17 6.67157 17 7.5V15.5C17 16.3284 16.3284 17 15.5 17H7.5C6.67157 17 6 16.3284 6 15.5V14H4.5C3.67157 14 3 13.3284 3 12.5V4.5C3 3.67157 3.67157 3 4.5 3H12.5ZM14 12.5C14 13.3284 13.3284 14 12.5 14H7V15.5C7 15.7761 7.22386 16 7.5 16H15.5C15.7761 16 16 15.7761 16 15.5V7.5C16 7.22386 15.7761 7 15.5 7H14V12.5ZM4.5 4C4.22386 4 4 4.22386 4 4.5V12.5C4 12.7761 4.22386 13 4.5 13H12.5C12.7761 13 13 12.7761 13 12.5V4.5C13 4.22386 12.7761 4 12.5 4H4.5Z"></path></svg></div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 absolute top-0 left-0 transition-all opacity-0 scale-50" aria-hidden="true"><path d="M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"></path></svg></div></div></button></div></div><div class="text-text-500 font-small p-3.5 pb-0">javascript</div><div><pre class="code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border-radius: 0.3em;"><code class="language-javascript" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none;"><span><span>fs</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">readFile</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(152, 195, 121);">'big-file.txt'</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token parameter">err</span><span class="token parameter" style="color: rgb(171, 178, 191);">,</span><span class="token parameter"> data</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token arrow" style="color: rgb(97, 175, 239);">=&gt;</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// Этот код выполнится ПОТОМ, когда файл прочитается</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(97, 175, 239);">processData</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>data</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// А ТУТ код продолжает выполняться СРАЗУ!</span><span>
</span></span><span><span></span><span class="token console" style="color: rgb(209, 154, 102);">console</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">log</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(152, 195, 121);">'Я не жду файл!'</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span></span></code></pre></div></div>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Секрет Node.js:</strong></p>
<ul class="[li_&amp;]:mb-0 [li_&amp;]:mt-1.5 [li_&amp;]:gap-1.5 [&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-disc flex flex-col gap-2 pl-8 mb-3">
<li class="whitespace-normal break-words pl-2">I/O операции передаются операционной системе</li>
<li class="whitespace-normal break-words pl-2">ОС читает файл / делает запрос в фоне</li>
<li class="whitespace-normal break-words pl-2">Node.js продолжает обрабатывать других клиентов</li>
<li class="whitespace-normal break-words pl-2">Когда ОС завершила операцию → создаётся макротаск с результатом</li>
<li class="whitespace-normal break-words pl-2">Event Loop обрабатывает результат, когда дойдёт очередь</li>
</ul>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Прослушивание порта:</strong></p>
<div class="relative group/copy bg-bg-000/50 border-0.5 border-border-400 rounded-lg"><div class="sticky opacity-0 group-hover/copy:opacity-100 top-2 py-2 h-12 w-0 float-right"><div class="absolute right-0 h-8 px-2 items-center inline-flex z-10"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)] h-8 w-8 rounded-md active:scale-95 backdrop-blur-md Button_ghost__BUAoh" type="button" aria-label="Copy to clipboard" data-state="closed"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 transition-all opacity-100 scale-100" aria-hidden="true"><path d="M12.5 3C13.3284 3 14 3.67157 14 4.5V6H15.5C16.3284 6 17 6.67157 17 7.5V15.5C17 16.3284 16.3284 17 15.5 17H7.5C6.67157 17 6 16.3284 6 15.5V14H4.5C3.67157 14 3 13.3284 3 12.5V4.5C3 3.67157 3.67157 3 4.5 3H12.5ZM14 12.5C14 13.3284 13.3284 14 12.5 14H7V15.5C7 15.7761 7.22386 16 7.5 16H15.5C15.7761 16 16 15.7761 16 15.5V7.5C16 7.22386 15.7761 7 15.5 7H14V12.5ZM4.5 4C4.22386 4 4 4.22386 4 4.5V12.5C4 12.7761 4.22386 13 4.5 13H12.5C12.7761 13 13 12.7761 13 12.5V4.5C13 4.22386 12.7761 4 12.5 4H4.5Z"></path></svg></div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 absolute top-0 left-0 transition-all opacity-0 scale-50" aria-hidden="true"><path d="M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"></path></svg></div></div></button></div></div><div class="text-text-500 font-small p-3.5 pb-0">javascript</div><div><pre class="code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border-radius: 0.3em;"><code class="language-javascript" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none;"><span><span>server</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">listen</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(209, 154, 102);">3000</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span></span></code></pre></div></div>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">Это I/O операция! Сервер говорит ОС: "Скажи мне, когда кто-то подключится к порту 3000". И программа не завершается, потому что ждёт этих событий от ОС.</p>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">Реальные примеры использования общего состояния</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>1. Чат-приложение:</strong></p>
<div class="relative group/copy bg-bg-000/50 border-0.5 border-border-400 rounded-lg"><div class="sticky opacity-0 group-hover/copy:opacity-100 top-2 py-2 h-12 w-0 float-right"><div class="absolute right-0 h-8 px-2 items-center inline-flex z-10"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)] h-8 w-8 rounded-md active:scale-95 backdrop-blur-md Button_ghost__BUAoh" type="button" aria-label="Copy to clipboard" data-state="closed"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 transition-all opacity-100 scale-100" aria-hidden="true"><path d="M12.5 3C13.3284 3 14 3.67157 14 4.5V6H15.5C16.3284 6 17 6.67157 17 7.5V15.5C17 16.3284 16.3284 17 15.5 17H7.5C6.67157 17 6 16.3284 6 15.5V14H4.5C3.67157 14 3 13.3284 3 12.5V4.5C3 3.67157 3.67157 3 4.5 3H12.5ZM14 12.5C14 13.3284 13.3284 14 12.5 14H7V15.5C7 15.7761 7.22386 16 7.5 16H15.5C15.7761 16 16 15.7761 16 15.5V7.5C16 7.22386 15.7761 7 15.5 7H14V12.5ZM4.5 4C4.22386 4 4 4.22386 4 4.5V12.5C4 12.7761 4.22386 13 4.5 13H12.5C12.7761 13 13 12.7761 13 12.5V4.5C13 4.22386 12.7761 4 12.5 4H4.5Z"></path></svg></div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 absolute top-0 left-0 transition-all opacity-0 scale-50" aria-hidden="true"><path d="M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"></path></svg></div></div></button></div></div><div class="text-text-500 font-small p-3.5 pb-0">javascript</div><div><pre class="code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border-radius: 0.3em;"><code class="language-javascript" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none;"><span><span class="token" style="color: rgb(198, 120, 221);">const</span><span> clients </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">[</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span> </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// Массив всех подключённых пользователей</span><span>
</span></span><span>
</span><span><span></span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// Когда новый пользователь подключается через WebSocket</span><span>
</span></span><span><span>wss</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">on</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(152, 195, 121);">'connection'</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token parameter">ws</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token arrow" style="color: rgb(97, 175, 239);">=&gt;</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>
</span></span><span><span>  clients</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">push</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>ws</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span> </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// Добавляем в общий список</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// Когда один пользователь отправляет сообщение</span><span>
</span></span><span><span>  ws</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">on</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(152, 195, 121);">'message'</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token parameter">msg</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token arrow" style="color: rgb(97, 175, 239);">=&gt;</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// Отправляем всем остальным</span><span>
</span></span><span><span>    clients</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">forEach</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token parameter">client</span><span> </span><span class="token arrow" style="color: rgb(97, 175, 239);">=&gt;</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>
</span></span><span><span>      </span><span class="token control-flow" style="color: rgb(198, 120, 221);">if</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>client </span><span class="token" style="color: rgb(97, 175, 239);">!==</span><span> ws</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>
</span></span><span><span>        client</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">send</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>msg</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(171, 178, 191);">}</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span></span></code></pre></div></div>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>2. Живой дашборд с метриками:</strong></p>
<div class="relative group/copy bg-bg-000/50 border-0.5 border-border-400 rounded-lg"><div class="sticky opacity-0 group-hover/copy:opacity-100 top-2 py-2 h-12 w-0 float-right"><div class="absolute right-0 h-8 px-2 items-center inline-flex z-10"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)] h-8 w-8 rounded-md active:scale-95 backdrop-blur-md Button_ghost__BUAoh" type="button" aria-label="Copy to clipboard" data-state="closed"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 transition-all opacity-100 scale-100" aria-hidden="true"><path d="M12.5 3C13.3284 3 14 3.67157 14 4.5V6H15.5C16.3284 6 17 6.67157 17 7.5V15.5C17 16.3284 16.3284 17 15.5 17H7.5C6.67157 17 6 16.3284 6 15.5V14H4.5C3.67157 14 3 13.3284 3 12.5V4.5C3 3.67157 3.67157 3 4.5 3H12.5ZM14 12.5C14 13.3284 13.3284 14 12.5 14H7V15.5C7 15.7761 7.22386 16 7.5 16H15.5C15.7761 16 16 15.7761 16 15.5V7.5C16 7.22386 15.7761 7 15.5 7H14V12.5ZM4.5 4C4.22386 4 4 4.22386 4 4.5V12.5C4 12.7761 4.22386 13 4.5 13H12.5C12.7761 13 13 12.7761 13 12.5V4.5C13 4.22386 12.7761 4 12.5 4H4.5Z"></path></svg></div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 absolute top-0 left-0 transition-all opacity-0 scale-50" aria-hidden="true"><path d="M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"></path></svg></div></div></button></div></div><div class="text-text-500 font-small p-3.5 pb-0">javascript</div><div><pre class="code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border-radius: 0.3em;"><code class="language-javascript" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none;"><span><span class="token" style="color: rgb(198, 120, 221);">let</span><span> cachedData </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token nil" style="color: rgb(198, 120, 221);">null</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(198, 120, 221);">let</span><span> lastUpdate </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span>
</span><span><span>app</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">get</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(152, 195, 121);">'/dashboard'</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">async</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token parameter">req</span><span class="token parameter" style="color: rgb(171, 178, 191);">,</span><span class="token parameter"> res</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token arrow" style="color: rgb(97, 175, 239);">=&gt;</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// Обновляем кэш только раз в минуту</span><span>
</span></span><span><span>  </span><span class="token control-flow" style="color: rgb(198, 120, 221);">if</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token known-class-name" style="color: rgb(209, 154, 102);">Date</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">now</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">-</span><span> lastUpdate </span><span class="token" style="color: rgb(97, 175, 239);">&gt;</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">60000</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>
</span></span><span><span>    cachedData </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token control-flow" style="color: rgb(198, 120, 221);">await</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">fetchExpensiveMetrics</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span><span>    lastUpdate </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token known-class-name" style="color: rgb(209, 154, 102);">Date</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">now</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(171, 178, 191);">}</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// Все клиенты получают один и тот же кэш</span><span>
</span></span><span><span>  res</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">json</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>cachedData</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span></span></code></pre></div></div>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>3. Онлайн-игра:</strong></p>
<div class="relative group/copy bg-bg-000/50 border-0.5 border-border-400 rounded-lg"><div class="sticky opacity-0 group-hover/copy:opacity-100 top-2 py-2 h-12 w-0 float-right"><div class="absolute right-0 h-8 px-2 items-center inline-flex z-10"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)] h-8 w-8 rounded-md active:scale-95 backdrop-blur-md Button_ghost__BUAoh" type="button" aria-label="Copy to clipboard" data-state="closed"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 transition-all opacity-100 scale-100" aria-hidden="true"><path d="M12.5 3C13.3284 3 14 3.67157 14 4.5V6H15.5C16.3284 6 17 6.67157 17 7.5V15.5C17 16.3284 16.3284 17 15.5 17H7.5C6.67157 17 6 16.3284 6 15.5V14H4.5C3.67157 14 3 13.3284 3 12.5V4.5C3 3.67157 3.67157 3 4.5 3H12.5ZM14 12.5C14 13.3284 13.3284 14 12.5 14H7V15.5C7 15.7761 7.22386 16 7.5 16H15.5C15.7761 16 16 15.7761 16 15.5V7.5C16 7.22386 15.7761 7 15.5 7H14V12.5ZM4.5 4C4.22386 4 4 4.22386 4 4.5V12.5C4 12.7761 4.22386 13 4.5 13H12.5C12.7761 13 13 12.7761 13 12.5V4.5C13 4.22386 12.7761 4 12.5 4H4.5Z"></path></svg></div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 absolute top-0 left-0 transition-all opacity-0 scale-50" aria-hidden="true"><path d="M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"></path></svg></div></div></button></div></div><div class="text-text-500 font-small p-3.5 pb-0">javascript</div><div><pre class="code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border-radius: 0.3em;"><code class="language-javascript" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none;"><span><span class="token" style="color: rgb(198, 120, 221);">const</span><span> gameState </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>
</span></span><span><span>  </span><span class="token literal-property" style="color: rgb(224, 108, 117);">players</span><span class="token" style="color: rgb(97, 175, 239);">:</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>  </span><span class="token literal-property" style="color: rgb(224, 108, 117);">score</span><span class="token" style="color: rgb(97, 175, 239);">:</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>  </span><span class="token literal-property" style="color: rgb(224, 108, 117);">currentRound</span><span class="token" style="color: rgb(97, 175, 239);">:</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">1</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span>
</span><span><span></span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// Все игроки видят одно и то же состояние игры</span><span>
</span></span><span><span>io</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">on</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(152, 195, 121);">'connection'</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token parameter">socket</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token arrow" style="color: rgb(97, 175, 239);">=&gt;</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>
</span></span><span><span>  gameState</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token property-access">players</span><span class="token" style="color: rgb(171, 178, 191);">[</span><span>socket</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token property-access">id</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>
</span></span><span><span>    </span><span class="token literal-property" style="color: rgb(224, 108, 117);">x</span><span class="token" style="color: rgb(97, 175, 239);">:</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token literal-property" style="color: rgb(224, 108, 117);">y</span><span class="token" style="color: rgb(97, 175, 239);">:</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token literal-property" style="color: rgb(224, 108, 117);">health</span><span class="token" style="color: rgb(97, 175, 239);">:</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">100</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// Когда игрок двигается</span><span>
</span></span><span><span>  socket</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">on</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(152, 195, 121);">'move'</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token parameter">position</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token arrow" style="color: rgb(97, 175, 239);">=&gt;</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>
</span></span><span><span>    gameState</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token property-access">players</span><span class="token" style="color: rgb(171, 178, 191);">[</span><span>socket</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token property-access">id</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token property-access">x</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> position</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token property-access">x</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span><span>    gameState</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token property-access">players</span><span class="token" style="color: rgb(171, 178, 191);">[</span><span>socket</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token property-access">id</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token property-access">y</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> position</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token property-access">y</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span>    
</span><span><span>    </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// Отправляем обновлённое состояние всем</span><span>
</span></span><span><span>    io</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">emit</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(152, 195, 121);">'gameState'</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> gameState</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span></span></code></pre></div></div>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>4. Счётчик активных пользователей:</strong></p>
<div class="relative group/copy bg-bg-000/50 border-0.5 border-border-400 rounded-lg"><div class="sticky opacity-0 group-hover/copy:opacity-100 top-2 py-2 h-12 w-0 float-right"><div class="absolute right-0 h-8 px-2 items-center inline-flex z-10"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)] h-8 w-8 rounded-md active:scale-95 backdrop-blur-md Button_ghost__BUAoh" type="button" aria-label="Copy to clipboard" data-state="closed"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 transition-all opacity-100 scale-100" aria-hidden="true"><path d="M12.5 3C13.3284 3 14 3.67157 14 4.5V6H15.5C16.3284 6 17 6.67157 17 7.5V15.5C17 16.3284 16.3284 17 15.5 17H7.5C6.67157 17 6 16.3284 6 15.5V14H4.5C3.67157 14 3 13.3284 3 12.5V4.5C3 3.67157 3.67157 3 4.5 3H12.5ZM14 12.5C14 13.3284 13.3284 14 12.5 14H7V15.5C7 15.7761 7.22386 16 7.5 16H15.5C15.7761 16 16 15.7761 16 15.5V7.5C16 7.22386 15.7761 7 15.5 7H14V12.5ZM4.5 4C4.22386 4 4 4.22386 4 4.5V12.5C4 12.7761 4.22386 13 4.5 13H12.5C12.7761 13 13 12.7761 13 12.5V4.5C13 4.22386 12.7761 4 12.5 4H4.5Z"></path></svg></div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 absolute top-0 left-0 transition-all opacity-0 scale-50" aria-hidden="true"><path d="M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"></path></svg></div></div></button></div></div><div class="text-text-500 font-small p-3.5 pb-0">javascript</div><div><pre class="code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border-radius: 0.3em;"><code class="language-javascript" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none;"><span><span class="token" style="color: rgb(198, 120, 221);">let</span><span> activeUsers </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span>
</span><span><span>app</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">use</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token parameter">req</span><span class="token parameter" style="color: rgb(171, 178, 191);">,</span><span class="token parameter"> res</span><span class="token parameter" style="color: rgb(171, 178, 191);">,</span><span class="token parameter"> next</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token arrow" style="color: rgb(97, 175, 239);">=&gt;</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>
</span></span><span><span>  activeUsers</span><span class="token" style="color: rgb(97, 175, 239);">++</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span>  
</span><span><span>  res</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">on</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(152, 195, 121);">'finish'</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token arrow" style="color: rgb(97, 175, 239);">=&gt;</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>
</span></span><span><span>    activeUsers</span><span class="token" style="color: rgb(97, 175, 239);">--</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(97, 175, 239);">next</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span>
</span><span><span>app</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">get</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(152, 195, 121);">'/stats'</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token parameter">req</span><span class="token parameter" style="color: rgb(171, 178, 191);">,</span><span class="token parameter"> res</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token arrow" style="color: rgb(97, 175, 239);">=&gt;</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>
</span></span><span><span>  res</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">json</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">{</span><span> activeUsers </span><span class="token" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span> </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// Все видят реальное число</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span></span></code></pre></div></div>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">Инструменты разработки: nodemon vs PM2</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>nodemon — для разработки:</strong></p>
<ul class="[li_&amp;]:mb-0 [li_&amp;]:mt-1.5 [li_&amp;]:gap-1.5 [&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-disc flex flex-col gap-2 pl-8 mb-3">
<li class="whitespace-normal break-words pl-2"><strong>Назначение:</strong> Автоматический перезапуск при изменении файлов</li>
<li class="whitespace-normal break-words pl-2"><strong>Установка:</strong> <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">npm install -g nodemon</code> или <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">npm install --save-dev nodemon</code></li>
<li class="whitespace-normal break-words pl-2"><strong>Использование:</strong> <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">nodemon server.js</code> или через npm-скрипт</li>
<li class="whitespace-normal break-words pl-2"><strong>Возможности:</strong>
<ul class="[li_&amp;]:mb-0 [li_&amp;]:mt-1.5 [li_&amp;]:gap-1.5 [&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-disc flex flex-col gap-2 pl-8 mb-3">
<li class="whitespace-normal break-words pl-2">Отслеживает изменения в файлах</li>
<li class="whitespace-normal break-words pl-2">Мгновенно перезапускает приложение</li>
<li class="whitespace-normal break-words pl-2">Можно настроить, какие файлы/папки отслеживать</li>
<li class="whitespace-normal break-words pl-2">Можно игнорировать определённые файлы</li>
</ul>
</li>
<li class="whitespace-normal break-words pl-2"><strong>Когда использовать:</strong> Только во время разработки на локальной машине</li>
<li class="whitespace-normal break-words pl-2"><strong>Пример конфигурации:</strong></li>
</ul>
<div class="relative group/copy bg-bg-000/50 border-0.5 border-border-400 rounded-lg"><div class="sticky opacity-0 group-hover/copy:opacity-100 top-2 py-2 h-12 w-0 float-right"><div class="absolute right-0 h-8 px-2 items-center inline-flex z-10"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)] h-8 w-8 rounded-md active:scale-95 backdrop-blur-md Button_ghost__BUAoh" type="button" aria-label="Copy to clipboard" data-state="closed"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 transition-all opacity-100 scale-100" aria-hidden="true"><path d="M12.5 3C13.3284 3 14 3.67157 14 4.5V6H15.5C16.3284 6 17 6.67157 17 7.5V15.5C17 16.3284 16.3284 17 15.5 17H7.5C6.67157 17 6 16.3284 6 15.5V14H4.5C3.67157 14 3 13.3284 3 12.5V4.5C3 3.67157 3.67157 3 4.5 3H12.5ZM14 12.5C14 13.3284 13.3284 14 12.5 14H7V15.5C7 15.7761 7.22386 16 7.5 16H15.5C15.7761 16 16 15.7761 16 15.5V7.5C16 7.22386 15.7761 7 15.5 7H14V12.5ZM4.5 4C4.22386 4 4 4.22386 4 4.5V12.5C4 12.7761 4.22386 13 4.5 13H12.5C12.7761 13 13 12.7761 13 12.5V4.5C13 4.22386 12.7761 4 12.5 4H4.5Z"></path></svg></div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 absolute top-0 left-0 transition-all opacity-0 scale-50" aria-hidden="true"><path d="M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"></path></svg></div></div></button></div></div><div class="text-text-500 font-small p-3.5 pb-0">json</div><div><pre class="code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border-radius: 0.3em;"><code class="language-json" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none;"><span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(224, 108, 117);">"watch"</span><span class="token" style="color: rgb(97, 175, 239);">:</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">[</span><span class="token" style="color: rgb(152, 195, 121);">"src"</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(224, 108, 117);">"ext"</span><span class="token" style="color: rgb(97, 175, 239);">:</span><span> </span><span class="token" style="color: rgb(152, 195, 121);">"js,json"</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(224, 108, 117);">"ignore"</span><span class="token" style="color: rgb(97, 175, 239);">:</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">[</span><span class="token" style="color: rgb(152, 195, 121);">"src/tests/*"</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(224, 108, 117);">"delay"</span><span class="token" style="color: rgb(97, 175, 239);">:</span><span> </span><span class="token" style="color: rgb(152, 195, 121);">"2500"</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(171, 178, 191);">}</span></span></code></pre></div></div>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>PM2 — для продакшена:</strong></p>
<ul class="[li_&amp;]:mb-0 [li_&amp;]:mt-1.5 [li_&amp;]:gap-1.5 [&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-disc flex flex-col gap-2 pl-8 mb-3">
<li class="whitespace-normal break-words pl-2"><strong>Назначение:</strong> Полноценный менеджер процессов для production</li>
<li class="whitespace-normal break-words pl-2"><strong>Установка:</strong> <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">npm install -g pm2</code></li>
<li class="whitespace-normal break-words pl-2"><strong>Использование:</strong> <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">pm2 start server.js</code></li>
<li class="whitespace-normal break-words pl-2"><strong>Возможности:</strong>
<ul class="[li_&amp;]:mb-0 [li_&amp;]:mt-1.5 [li_&amp;]:gap-1.5 [&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-disc flex flex-col gap-2 pl-8 mb-3">
<li class="whitespace-normal break-words pl-2">Автоматический перезапуск при сбоях</li>
<li class="whitespace-normal break-words pl-2">Кластеризация (запуск на нескольких ядрах)</li>
<li class="whitespace-normal break-words pl-2">Мониторинг CPU и памяти</li>
<li class="whitespace-normal break-words pl-2">Логирование и ротация логов</li>
<li class="whitespace-normal break-words pl-2">Балансировка нагрузки</li>
<li class="whitespace-normal break-words pl-2">Запуск при старте системы</li>
<li class="whitespace-normal break-words pl-2">Zero-downtime reload (перезапуск без остановки сервиса)</li>
</ul>
</li>
<li class="whitespace-normal break-words pl-2"><strong>Когда использовать:</strong> На боевых серверах в production</li>
<li class="whitespace-normal break-words pl-2"><strong>Пример команд:</strong></li>
</ul>
<div class="relative group/copy bg-bg-000/50 border-0.5 border-border-400 rounded-lg"><div class="sticky opacity-0 group-hover/copy:opacity-100 top-2 py-2 h-12 w-0 float-right"><div class="absolute right-0 h-8 px-2 items-center inline-flex z-10"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)] h-8 w-8 rounded-md active:scale-95 backdrop-blur-md Button_ghost__BUAoh" type="button" aria-label="Copy to clipboard" data-state="closed"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 transition-all opacity-100 scale-100" aria-hidden="true"><path d="M12.5 3C13.3284 3 14 3.67157 14 4.5V6H15.5C16.3284 6 17 6.67157 17 7.5V15.5C17 16.3284 16.3284 17 15.5 17H7.5C6.67157 17 6 16.3284 6 15.5V14H4.5C3.67157 14 3 13.3284 3 12.5V4.5C3 3.67157 3.67157 3 4.5 3H12.5ZM14 12.5C14 13.3284 13.3284 14 12.5 14H7V15.5C7 15.7761 7.22386 16 7.5 16H15.5C15.7761 16 16 15.7761 16 15.5V7.5C16 7.22386 15.7761 7 15.5 7H14V12.5ZM4.5 4C4.22386 4 4 4.22386 4 4.5V12.5C4 12.7761 4.22386 13 4.5 13H12.5C12.7761 13 13 12.7761 13 12.5V4.5C13 4.22386 12.7761 4 12.5 4H4.5Z"></path></svg></div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 absolute top-0 left-0 transition-all opacity-0 scale-50" aria-hidden="true"><path d="M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"></path></svg></div></div></button></div></div><div class="text-text-500 font-small p-3.5 pb-0">bash</div><div><pre class="code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border-radius: 0.3em;"><code class="language-bash" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none;"><span><span>pm2 start server.js -i </span><span class="token" style="color: rgb(209, 154, 102);">4</span><span>  </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;"># Запустить 4 экземпляра</span><span>
</span></span><span><span>pm2 list                   </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;"># Список процессов</span><span>
</span></span><span><span>pm2 monit                  </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;"># Мониторинг в реальном времени</span><span>
</span></span><span><span>pm2 logs                   </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;"># Просмотр логов</span><span>
</span></span><span><span>pm2 restart server         </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;"># Перезапуск</span><span>
</span></span><span><span>pm2 stop server            </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;"># Остановка</span><span>
</span></span><span><span>pm2 startup                </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;"># Настройка автозапуска</span></span></code></pre></div></div>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Сравнительная таблица:</strong></p>
<div class="overflow-x-auto w-full px-2 mb-6"><table class="min-w-full border-collapse text-sm leading-[1.7] whitespace-normal"><thead class="text-left"><tr><th class="text-text-100 border-b-0.5 border-border-300/60 py-2 pr-4 align-top font-bold">Характеристика</th><th class="text-text-100 border-b-0.5 border-border-300/60 py-2 pr-4 align-top font-bold">nodemon</th><th class="text-text-100 border-b-0.5 border-border-300/60 py-2 pr-4 align-top font-bold">PM2</th></tr></thead><tbody><tr><td class="border-b-0.5 border-border-300/30 py-2 pr-4 align-top">Среда</td><td class="border-b-0.5 border-border-300/30 py-2 pr-4 align-top">Development</td><td class="border-b-0.5 border-border-300/30 py-2 pr-4 align-top">Production</td></tr><tr><td class="border-b-0.5 border-border-300/30 py-2 pr-4 align-top">Авто-рестарт при изменениях</td><td class="border-b-0.5 border-border-300/30 py-2 pr-4 align-top">✅ Да</td><td class="border-b-0.5 border-border-300/30 py-2 pr-4 align-top">❌ Нет</td></tr><tr><td class="border-b-0.5 border-border-300/30 py-2 pr-4 align-top">Авто-рестарт при сбоях</td><td class="border-b-0.5 border-border-300/30 py-2 pr-4 align-top">❌ Нет</td><td class="border-b-0.5 border-border-300/30 py-2 pr-4 align-top">✅ Да</td></tr><tr><td class="border-b-0.5 border-border-300/30 py-2 pr-4 align-top">Кластеризация</td><td class="border-b-0.5 border-border-300/30 py-2 pr-4 align-top">❌ Нет</td><td class="border-b-0.5 border-border-300/30 py-2 pr-4 align-top">✅ Да</td></tr><tr><td class="border-b-0.5 border-border-300/30 py-2 pr-4 align-top">Мониторинг</td><td class="border-b-0.5 border-border-300/30 py-2 pr-4 align-top">❌ Нет</td><td class="border-b-0.5 border-border-300/30 py-2 pr-4 align-top">✅ Да</td></tr><tr><td class="border-b-0.5 border-border-300/30 py-2 pr-4 align-top">Управление логами</td><td class="border-b-0.5 border-border-300/30 py-2 pr-4 align-top">❌ Нет</td><td class="border-b-0.5 border-border-300/30 py-2 pr-4 align-top">✅ Да</td></tr><tr><td class="border-b-0.5 border-border-300/30 py-2 pr-4 align-top">Zero-downtime reload</td><td class="border-b-0.5 border-border-300/30 py-2 pr-4 align-top">❌ Нет</td><td class="border-b-0.5 border-border-300/30 py-2 pr-4 align-top">✅ Да</td></tr><tr><td class="border-b-0.5 border-border-300/30 py-2 pr-4 align-top">Простота использования</td><td class="border-b-0.5 border-border-300/30 py-2 pr-4 align-top">✅ Очень просто</td><td class="border-b-0.5 border-border-300/30 py-2 pr-4 align-top">⚠️ Сложнее</td></tr></tbody></table></div>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Типичный workflow:</strong></p>
<div class="relative group/copy bg-bg-000/50 border-0.5 border-border-400 rounded-lg"><div class="sticky opacity-0 group-hover/copy:opacity-100 top-2 py-2 h-12 w-0 float-right"><div class="absolute right-0 h-8 px-2 items-center inline-flex z-10"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)] h-8 w-8 rounded-md active:scale-95 backdrop-blur-md Button_ghost__BUAoh" type="button" aria-label="Copy to clipboard" data-state="closed"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 transition-all opacity-100 scale-100" aria-hidden="true"><path d="M12.5 3C13.3284 3 14 3.67157 14 4.5V6H15.5C16.3284 6 17 6.67157 17 7.5V15.5C17 16.3284 16.3284 17 15.5 17H7.5C6.67157 17 6 16.3284 6 15.5V14H4.5C3.67157 14 3 13.3284 3 12.5V4.5C3 3.67157 3.67157 3 4.5 3H12.5ZM14 12.5C14 13.3284 13.3284 14 12.5 14H7V15.5C7 15.7761 7.22386 16 7.5 16H15.5C15.7761 16 16 15.7761 16 15.5V7.5C16 7.22386 15.7761 7 15.5 7H14V12.5ZM4.5 4C4.22386 4 4 4.22386 4 4.5V12.5C4 12.7761 4.22386 13 4.5 13H12.5C12.7761 13 13 12.7761 13 12.5V4.5C13 4.22386 12.7761 4 12.5 4H4.5Z"></path></svg></div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 absolute top-0 left-0 transition-all opacity-0 scale-50" aria-hidden="true"><path d="M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"></path></svg></div></div></button></div></div><div class="text-text-500 font-small p-3.5 pb-0">bash</div><div><pre class="code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border-radius: 0.3em;"><code class="language-bash" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none;"><span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;"># Разработка</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(97, 175, 239);">npm</span><span> run dev  </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;"># nodemon server.js</span><span>
</span></span><span>
</span><span><span></span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;"># Деплой на сервер</span><span>
</span></span><span>pm2 start ecosystem.config.js --env production
</span><span>pm2 save
</span><span>pm2 startup</span></code></pre></div></div></div></div><div><div class="standard-markdown grid-cols-1 grid gap-4 [&amp;_&gt;_*]:min-w-0 !gap-3.5"><h1 class="text-text-100 mt-3 -mb-1 text-[1.375rem] font-bold">Лекция по изучению Node.js. Урок 1 (продолжение)</h1>
<h2 class="text-text-100 mt-3 -mb-1 text-[1.125rem] font-bold">Отредактированный транскрипт</h2>
<img :src="screenshot_3715" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:01:46 --- Как раз да, посмотрим вот этот кейс. Ну, а как противостоять DDoS-атакам? Сложно сказать. Сложно точнее применить что-то специфичное к Node.js отдельно. Обычно DDoS-атаки чем характерны? Тем, что с одного IP-адреса идет слишком много однотипных запросов в секунду.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:02:05 --- Ну или даже не однотипных, а просто слишком много — превышается какой-то лимит. И если этот лимит оказывается превышен, то надо просто по IP-адресу сразу давать <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">response.end()</code> с кодом 500 или другим соответствующим статусом. То есть мы не можем никаким образом предотвратить создание новых <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">макротасков</code> от DDoS до этого момента — запрос уже поступил на сервер. Но мы можем здесь написать проверку: если IP-адрес в черном списке, то сразу делаем <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">response.end()</code>.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:02:35 --- Зачем? Чтобы не создавать на этого клиента новые <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">макротаски</code> — там, на запросы к базе данных и еще что-то такое. И эта операция <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">response.end()</code> безумно быстрая. Ну, как бы, тут нужны будут миллионы запросов, чтобы перегрузить сервер даже с такой защитой. А если на ваш сайт навалились люди, которые могут оплатить DDoS с тысячами или миллионами запросов с разных IP-адресов, то явно что-то пошло не так, да? Это значит, очень серьезные люди какие-то, и этот вопрос уже в другой плоскости лежит скорее.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:03:10 --- В административной, возможно. Получается, что здесь идеальной защиты не может быть. То есть, если есть люди, которые готовы на вас таким объемом навалиться, у вас должен быть, соответственно, пул серверов соответствующий. Который готов, в случае чего, ненадолго прилечь, но переварить потом это все, восстановиться.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:03:32 --- Вот, поэтому DDoS — это вопрос всегда очень философский, на который четкого ответа нет. Ну ладно, традиционно в середине занятия мы делаем перерыв на 5-6 минут. Да, попить чайку, кофейку, набраться сил и продолжаем, соответственно, где-то в 21:11. Пока что перерыв. Ну что ж, продолжаем. Рисуйте плюсы, когда снова все появится на экране.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:03:54 --- Так, и мы будем дальше с этим примером разбираться. Ну, я, наверное, скопирую FightXServer. Назову его третьим файлом, скажем, LongTask. В <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">package.json</code>, давайте вот это назовем командой server2. А эту команду назовем server3. Немножко такое топорное использование системы, но да ладно.</p>
<img :src="screenshot_3880" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:04:25 --- Так, .js, .js. Останавливаем, запускаем через <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">npm run server3</code>. И вот, значит, сразу важный момент для понимания. Очень интересный вопрос Тарас написал: если для каждого пользователя создаются новые объекты, то по сути они все идут в оперативную память. Если сервер работает неделю, все объекты там и живут?</p>
<img :src="screenshot_3898" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:04:51 --- Привык, что в C# есть <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">сборщик мусора</code>, освобождение ресурсов и так далее. Здесь есть два момента. Момент первый: что сервера на всякий случай все равно перезапускаются с определенной периодичностью. Даже самые крупные сайты. Вон, не знаю, для примера там Lichess, Chess.com. Да, ну мне просто это знакомо по шахматной тематике.</p>
<img :src="screenshot_3927" alt="Image" >
<img :src="screenshot_3939" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:05:20 --- У них же сотни тысяч людей в онлайне. Вон, больше 100 тысяч человек на Lichess. На Chess.com еще больше. Все равно периодически появляется баннер: "Lichess — рестарт через 9 минут". Да, или на Chess.com та же самая история. То есть все равно для профилактики сервера перезапускают. Конечно, это связано не только с профилактикой, но и с выкатом каких-то обновлений в любом случае. Но так или иначе плановый рестарт раз в неделю имеет место быть в то время, когда не прайм-тайм, когда клиентов мало.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:05:54 --- Это первое. Второе, вот по запросу, например, да, Тарас опасается, что мы для человека создадим 100 объектов, да, может быть и тысячу, почему нет? Если мы используем <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">ORM</code>-ку, делаем запрос к базе, да, каждая запись из базы превращается в один объект, например, после выборки, то счет таких простых объектов может идти действительно на сотни.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:06:17 --- Но почему это не так важно? Потому что смотрите: запрос конкретного клиента обрабатывается в рамках этой функции-обработчика. Все объекты, все переменные, которые мы создадим в рамках этой функции или в функциях, которые она запустит, они все имеют локальную зону видимости.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:06:38 --- И когда клиент получает <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">response.end()</code>, этот <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">макротаск</code> — по факту, ну давайте так: эта функция завершена, по сути, и все, что у этой функции внутри было. Она ведь, эта функция, была <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">макротаском</code>, она регистрировала новые <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">макротаски</code>: <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">макротаск</code> запроса к базе, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">макротаск</code> чтения какого-то файла, запись лога. Могла делать какие-то другие вещи типа дополнительных ответов — это новые <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">макротаски</code>.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:07:15 --- Так вот, когда <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">макротаски</code> иссякнут, переменные <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">request</code> и <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">response</code> станут никому не нужны, да, и <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">response.end()</code>, скорее всего, сработает. И <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">сборщик мусора</code> всю эту память очистит. Даже если вы здесь вот напишите на пятой строке сейчас создание вручную там 100 объектов принципиально, эти объекты <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">сборщик мусора</code> скушает тогда, когда данная функция утихомирится — из нее не будет создано новых <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">макротасков</code>.</p>
<img :src="screenshot_4079" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:07:40 --- Все <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">макротаски</code>, которые она как подзадачу реализовала, завершились. Все, эта функция свое отжила. Запрос клиента на сервер завершен. И все созданные объекты чистятся, поэтому неделю они жить не будут. Вот, линию отчеркиваю, просьба клиентам подтвердить плюсами, если это понятно. Да, что тут ничего страшного нет, что <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">сборщик мусора</code> с этим всем прекрасно справится.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:08:16 --- Но если вы, конечно, сделаете вот здесь какую-нибудь веселую переменную <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">clientObjects</code> и будете в эту переменную пушить все объекты в этот массив, тогда да. Но вряд ли же вы так сделаете. Это очень "талантливый" вариант создания утечки памяти. Типа взять от клиента и пушить все технические объекты, которые по завершению запроса не нужны.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:08:47 --- Проблема таких переменных, которые надо как-то очищать вручную, она становится актуальной тогда, когда мы, например, работаем с real-time коммуникациями. Когда у нас есть список клиентов, которые либо по старой технологии <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">XHR Long Polling</code>, или по технологии <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Server-Sent Events</code>, или по технологии <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">WebSockets</code>, висят вот в каком-то массиве клиенты. И на сервере происходит событие, мы всем клиентам рассылаем информацию о произошедшем событии.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:09:20 --- Тогда эта переменная, которая объявлена по уровню зон видимости выше функции-обработчика запроса, где люди коннектятся к этому, например, сокет-серверу — за такой переменной мы должны очень внимательно следить. Например, отключать клиентов, если они не пинговали сервер в течение минуты. Или по еще какой-то причине — сами можем ее придумать, но чаще всего, если долго сервер не пинговали, то клиентов отключают.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:09:45 --- И да, за такими переменными мы должны следить сами. А за переменными и техническими объектами, создаваемыми внутри этой функции-обработчика, следит <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">сборщик мусора</code>. Но опять же, если вдруг по какой-то причине у вас есть такой кейс в коде, что у клиента не вызывается <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">response.end()</code> вообще, тогда это может быть проблемой. Потому что пока <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">response.end()</code> не вызван, функция и порожденные ей <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">макротаски</code> могут быть теоретически живы.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:10:17 --- Но все равно это все теория, потому что если клиент отключится, у себя вкладку браузера закроет, то все равно <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">request</code> будет принудительно разорван. Если браузер успел послать команду на разрыв этого соединения. Если браузер вырубили там Ctrl+Alt+Delete, "завершить процесс", то да, клиент на сервер не пошлет команду, что соединение закрыто.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:10:36 --- Если вы не написали <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">response.end()</code>, то теоретически этот клиент и все его созданные сущности могут подвиснуть. Поэтому тут просто главное грамотно код написать, не допустив того, что мы ответ клиенту не закроем. Ну, а чтобы подстраховаться, можно, конечно, поставить таймаут. Да, где-то есть глобальная настройка, по-моему, в <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">createServer</code>, какой таймаут у запроса. И тогда точно этих проблем мы избежим. Но тогда возникнет проблема с запросом на инициализацию вебсокет-соединения. Так что нюансов масса, а мы давайте попробуем сделать вот что.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:11:05 --- Чтобы лучше прочувствовать <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Event Loop</code> и сопутствующие проблемы, делаем <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">switch</code> по <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">request.url</code>. Допустим, есть какой-то адрес, который называется просто <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">/</code> — слэш. Для чистоты эксперимента я сейчас еще один адрес пропишу быстренько. Такой технический мусорный адрес.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:11:34 --- <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">/favicon.ico</code>. Значит, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">response.end()</code>. Пустое изображение. Ну, боюсь, что это некорректная картинка, но нам как бы все равно. Вот. Мы не хотим, чтобы это в основной код попадало. Значит, теперь по главной странице мы отдаем информацию, что это homepage.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:12:07 --- И допустим, есть какой-то адрес хитрый, который называется, допустим, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">/admin/calc</code>. И вот здесь мы будем выполнять какую-то долгую-долгую операцию. Сейчас мы ее напишем.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:12:33 --- Давайте сделаем отдельную функцию. Да, эмуляция долгой операции, которая принимает <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">request</code> и <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">response</code>. Так, и чуть ниже я эту функцию реализую. Так, ну и можем прописать еще, скажем, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">default</code>: <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">response.statusCode = 404</code>, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">end()</code>, "page not found".</p>
<img :src="screenshot_4390" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:13:03 --- Ну так, на всякий случай. Значит, что сейчас происходит? Homepage. На адресе <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">/admin/calc</code> пока что система будет крутиться бесконечно. Но это ладно — эту функцию мы просто еще не написали. А значит, если <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">/favicon.ico</code> — это пустое изображение, на любой другой адрес видим код 404. То есть вот такая заготовка. Кстати, а почему он крутится? Адрес a...</p>
<img :src="screenshot_4423" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:13:41 --- Ой. А, это скидывали какой-то сайт на интенсиве по оптимизации под Google. Не работает.</p>
<img :src="screenshot_4437" alt="Image" >
<img :src="screenshot_4448" alt="Image" >
<img :src="screenshot_4455" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:13:51 --- Какой там статус? Так, у нас, видимо, сервер лег, нет? Приложение падает. <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">response.statusCode</code>. А почему <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">statusCode</code>? Это дурацкая автоподстановка какая-то. Система сама это сделала. Вот, сейчас она восстановится, и мы видим... Нет, снова ошибка. А, ну понятно, да. Я работаю в духе Express-обертки, а не в духе чистого Node.js. <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">response</code>, наверное, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">set</code>, что там — <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">status</code>, или <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">setHeader</code>, может быть.</p>
<img :src="screenshot_4497" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:14:34 --- Не знаю как. Мы стартовую строку установим или нет, но ладно, попробую дописать "404 not found", но и не уверен, что это приведет, кстати, к реальному not found. Так, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">setHeader</code>.</p>
<img :src="screenshot_4524" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:14:58 --- "Header name must be valid HTTP token". Ну понятно. Невалидный заголовок, короче, мы устанавливаем, да. Может быть, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">statusMessage</code> — такое поле. Сейчас давайте попробуем задать. О, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">statusCode</code> — 200, 404. Да, видите: "page not found", <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">statusCode</code> 404, все четко.</p>
<img :src="screenshot_4533" alt="Image" >
<img :src="screenshot_4544" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:15:26 --- Ну, а на главной странице все как раньше. Так, значит. Может, использовать <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">setTimeout</code> на 10 секунд для длинной задачи, вызвать callback и сделать <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">response</code>? Но нет, не подойдет. Потому что если длинная задача начнет выполняться, она через 10 секунд забьет <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">макротаски</code> для других клиентов. Да, то есть мы отложим ее на 10 секунд выполнения, но допустим, через 10 секунд придут еще клиенты, и они будут ее ждать.</p>
<img :src="screenshot_4557" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:15:53 --- Так что это не вариант, тут надо делать по-другому. Значит, смотрите, наша задача такая: в рамках функции <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">emulLongOperation</code> сделать какую-то синхронную операцию расчета, какой-то белиберды не особо нужной, которая будет просто нагружать процессор. И мы должны понять, будет это как-то мешать клиентам, попадающим на главную страницу, или не будет.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:16:21 --- Просьба плюсами подтвердить, если задумка понятна. Ну, а чтобы эта операция куда-то записывала свой результат, мы как раз сделаем, например, переменную <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">longOperationRes</code>, присвоим "not ready" пока что, и будем на homepage просто выводить.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:16:52 --- На <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">response</code>, что он не рассчитан. <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">response</code>, допустим, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">long-res-oper</code>. Так, поставили. Homepage "not ready", видим.</p>
<img :src="screenshot_4640" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:17:16 --- И теперь давайте мы запустим цикл: <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">i = 1</code>, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">i &lt; 20000</code>, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">i++</code>, вложенный цикл: <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">j = 1</code>, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">j &lt; 20000</code>, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">j++</code>, и мы, не знаю, делаем какую-нибудь переменную <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">result = 0</code>.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:17:55 --- И, например, мы просто делаем белиберду какую-то: <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">result += j / i</code>. Не знаю, что из этого выйдет хорошего. Но очень странные какие-то числа у нас получатся, надо признать. Но ладно. Значит, здесь мы в итоге напишем <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">response.end(result)</code>.</p>
<img :src="screenshot_4707" alt="Image" >
<img :src="screenshot_4717" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:18:19 --- А сколько будет длиться такой запрос? Да кто его знает? Вот я пытаюсь обратиться на адрес <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">/admin/calc</code>, который был у нас сделан. Вот видите, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">/admin/calc</code>. Рассчитывает система его. Где-то я ошибку допустил. "Chunk argument must be type of string". Ну понятно. Надо число привести к строке, безусловно, перед тем как отдавать его в <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">response.end()</code>.</p>
<img :src="screenshot_4741" alt="Image" >
<img :src="screenshot_4753" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:18:47 --- Но смотрите, мы запускаемся, давайте посчитаем: 1, 2, 3 секунды длится эта операция. В принципе, не так уж и много. Давайте поставим пожестче, например, по 30 тысяч здесь будут числа. Может быть, надо еще больше ставить. Вот видите, уже подольше длится этот запрос. Я поставлю по 40 тогда. Вот, по 40, я думаю, сейчас в районе 5-6 секунд мы получим, наверное, да, выполнение этой операции.</p>
<img :src="screenshot_4768" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:19:18 --- Даже больше. Ну вот нормально, что-то там посчитал. Абсолютно бессмысленная математическая нагрузка процессора. Но, может быть, была какая-то осмысленная операция, да? В банковском клиенте для криптографии искали ближайшее простое число, да, на каком-нибудь очень крупном числе, неизвестном науке. Все шутки, конечно, плюс-минус.</p>
<hr class="border-border-200 border-t-0.5 my-3 mx-1.5">
<h2 class="text-text-100 mt-3 -mb-1 text-[1.125rem] font-bold">Дополнительные объяснения</h2>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">Что такое макротаски (Macrotasks)?</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Макротаски</code> — это единицы работы, которые ставятся в очередь <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Event Loop</code> для последующего выполнения. В Node.js к макротаскам относятся:</p>
<ul class="[li_&amp;]:mb-0 [li_&amp;]:mt-1.5 [li_&amp;]:gap-1.5 [&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-disc flex flex-col gap-2 pl-8 mb-3">
<li class="whitespace-normal break-words pl-2">Обработка входящих HTTP-запросов</li>
<li class="whitespace-normal break-words pl-2">Callback-функции из <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">setTimeout</code> и <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">setInterval</code></li>
<li class="whitespace-normal break-words pl-2">Callback-функции после завершения операций ввода-вывода (чтение файлов, запросы к базе данных)</li>
<li class="whitespace-normal break-words pl-2">Обработка событий</li>
</ul>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">Когда один <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">макротаск</code> завершается, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Event Loop</code> берет следующий из очереди. Это позволяет Node.js эффективно обрабатывать множество операций, не блокируя выполнение программы.</p>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">Что такое Event Loop?</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Event Loop</code> (цикл событий) — это механизм Node.js для управления асинхронными операциями в однопоточной среде.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Как это работает:</strong></p>
<ol class="[li_&amp;]:mb-0 [li_&amp;]:mt-1.5 [li_&amp;]:gap-1.5 [&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-decimal flex flex-col gap-2 pl-8 mb-3">
<li class="whitespace-normal break-words pl-2">JavaScript-код в Node.js выполняется в одном потоке</li>
<li class="whitespace-normal break-words pl-2">Когда встречается асинхронная операция (чтение файла, запрос к БД), Node.js делегирует ее системным ресурсам</li>
<li class="whitespace-normal break-words pl-2"><code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Event Loop</code> продолжает обрабатывать другие задачи, не дожидаясь завершения асинхронной операции</li>
<li class="whitespace-normal break-words pl-2">Когда операция завершается, ее callback попадает в очередь <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">макротасков</code></li>
<li class="whitespace-normal break-words pl-2"><code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Event Loop</code> берет следующий <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">макротаск</code> из очереди и выполняет его</li>
</ol>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Критическая проблема:</strong> Если один <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">макротаск</code> выполняется слишком долго (синхронная операция), весь <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Event Loop</code> блокируется, и другие клиенты не могут получить ответ от сервера.</p>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">Защита от DDoS и макротаски</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">Когда мы говорим о защите от DDoS через проверку IP-адресов и быстрый <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">response.end()</code>, важно понимать последовательность событий:</p>
<ol class="[li_&amp;]:mb-0 [li_&amp;]:mt-1.5 [li_&amp;]:gap-1.5 [&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-decimal flex flex-col gap-2 pl-8 mb-3">
<li class="whitespace-normal break-words pl-2"><strong>Запрос приходит на сервер</strong> → создается <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">макротаск</code> для его обработки</li>
<li class="whitespace-normal break-words pl-2"><strong>Проверка черного списка IP</strong> → если IP в черном списке, сразу <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">response.end()</code></li>
<li class="whitespace-normal break-words pl-2"><strong>Предотвращение создания новых макротасков</strong> → не запускаются запросы к БД, чтение файлов, другие операции</li>
</ol>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Почему это важно:</strong> Каждый <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">макротаск</code> занимает место в очереди и потребляет ресурсы. Если мы создадим тысячи <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">макротасков</code> для вредоносных запросов (обращения к БД, чтение файлов), сервер быстро исчерпает ресурсы.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Стоимость макротаска:</strong></p>
<ul class="[li_&amp;]:mb-0 [li_&amp;]:mt-1.5 [li_&amp;]:gap-1.5 [&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-disc flex flex-col gap-2 pl-8 mb-3">
<li class="whitespace-normal break-words pl-2">Память для хранения контекста выполнения</li>
<li class="whitespace-normal break-words pl-2">Место в очереди <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Event Loop</code></li>
<li class="whitespace-normal break-words pl-2">Время процессора на переключение контекста</li>
</ul>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">ORM (Object-Relational Mapping)</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">ORM</code> — это технология, которая позволяет работать с базой данных через объекты вместо написания SQL-запросов вручную.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Пример:</strong> Вместо запроса <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">SELECT * FROM users WHERE id = 1</code> вы пишете <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">User.findById(1)</code>, и <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">ORM</code> автоматически преобразует это в SQL-запрос.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Популярные ORM для Node.js:</strong> Sequelize, TypeORM, Prisma.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Связь с памятью:</strong> Когда <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">ORM</code> делает выборку из базы данных, каждая запись превращается в JavaScript-объект. Если вы выбираете 1000 записей, создается 1000 объектов в памяти.</p>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">Real-time технологии коммуникации</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>XHR Long Polling (старая технология):</strong></p>
<ul class="[li_&amp;]:mb-0 [li_&amp;]:mt-1.5 [li_&amp;]:gap-1.5 [&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-disc flex flex-col gap-2 pl-8 mb-3">
<li class="whitespace-normal break-words pl-2">Клиент отправляет запрос на сервер</li>
<li class="whitespace-normal break-words pl-2">Сервер держит соединение открытым, пока не произойдет событие</li>
<li class="whitespace-normal break-words pl-2">Когда событие происходит, сервер отправляет ответ</li>
<li class="whitespace-normal break-words pl-2">Клиент сразу отправляет новый запрос</li>
</ul>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Server-Sent Events (SSE):</strong></p>
<ul class="[li_&amp;]:mb-0 [li_&amp;]:mt-1.5 [li_&amp;]:gap-1.5 [&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-disc flex flex-col gap-2 pl-8 mb-3">
<li class="whitespace-normal break-words pl-2">Односторонняя связь от сервера к клиенту</li>
<li class="whitespace-normal break-words pl-2">Сервер может отправлять сообщения клиенту в любое время</li>
<li class="whitespace-normal break-words pl-2">Клиент просто слушает поток событий</li>
<li class="whitespace-normal break-words pl-2">Используется для обновлений в реальном времени (биржевые котировки, уведомления)</li>
</ul>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>WebSockets:</strong></p>
<ul class="[li_&amp;]:mb-0 [li_&amp;]:mt-1.5 [li_&amp;]:gap-1.5 [&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-disc flex flex-col gap-2 pl-8 mb-3">
<li class="whitespace-normal break-words pl-2">Двусторонняя связь между клиентом и сервером</li>
<li class="whitespace-normal break-words pl-2">Постоянное открытое соединение</li>
<li class="whitespace-normal break-words pl-2">Любая сторона может отправить сообщение в любое время</li>
<li class="whitespace-normal break-words pl-2">Используется для чатов, онлайн-игр, совместного редактирования</li>
</ul>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Проблема с памятью:</strong> Клиенты в real-time приложениях "висят" в массиве на сервере. Если не отключать неактивных клиентов, массив будет расти бесконечно, вызывая утечку памяти.</p>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">Почему setTimeout не решает проблему блокировки?</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">Когда мы пишем:</p>
<div class="relative group/copy bg-bg-000/50 border-0.5 border-border-400 rounded-lg"><div class="sticky opacity-0 group-hover/copy:opacity-100 top-2 py-2 h-12 w-0 float-right"><div class="absolute right-0 h-8 px-2 items-center inline-flex z-10"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)] h-8 w-8 rounded-md active:scale-95 backdrop-blur-md Button_ghost__BUAoh" type="button" aria-label="Copy to clipboard" data-state="closed"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 transition-all opacity-100 scale-100" aria-hidden="true"><path d="M12.5 3C13.3284 3 14 3.67157 14 4.5V6H15.5C16.3284 6 17 6.67157 17 7.5V15.5C17 16.3284 16.3284 17 15.5 17H7.5C6.67157 17 6 16.3284 6 15.5V14H4.5C3.67157 14 3 13.3284 3 12.5V4.5C3 3.67157 3.67157 3 4.5 3H12.5ZM14 12.5C14 13.3284 13.3284 14 12.5 14H7V15.5C7 15.7761 7.22386 16 7.5 16H15.5C15.7761 16 16 15.7761 16 15.5V7.5C16 7.22386 15.7761 7 15.5 7H14V12.5ZM4.5 4C4.22386 4 4 4.22386 4 4.5V12.5C4 12.7761 4.22386 13 4.5 13H12.5C12.7761 13 13 12.7761 13 12.5V4.5C13 4.22386 12.7761 4 12.5 4H4.5Z"></path></svg></div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 absolute top-0 left-0 transition-all opacity-0 scale-50" aria-hidden="true"><path d="M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"></path></svg></div></div></button></div></div><div class="text-text-500 font-small p-3.5 pb-0">javascript</div><div><pre class="code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border-radius: 0.3em;"><code class="language-javascript" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none;"><span><span class="token" style="color: rgb(97, 175, 239);">setTimeout</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token arrow" style="color: rgb(97, 175, 239);">=&gt;</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// долгая синхронная операция</span><span>
</span></span><span><span>  </span><span class="token control-flow" style="color: rgb(198, 120, 221);">for</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(198, 120, 221);">let</span><span> i </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span> i </span><span class="token" style="color: rgb(97, 175, 239);">&lt;</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">40000</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span> i</span><span class="token" style="color: rgb(97, 175, 239);">++</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>
</span></span><span><span>    </span><span class="token control-flow" style="color: rgb(198, 120, 221);">for</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(198, 120, 221);">let</span><span> j </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span> j </span><span class="token" style="color: rgb(97, 175, 239);">&lt;</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">40000</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span> j</span><span class="token" style="color: rgb(97, 175, 239);">++</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>
</span></span><span><span>      result </span><span class="token" style="color: rgb(97, 175, 239);">+=</span><span> j </span><span class="token" style="color: rgb(97, 175, 239);">/</span><span> i</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(171, 178, 191);">}</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(171, 178, 191);">}</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">10000</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span></span></code></pre></div></div>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">setTimeout</code> <strong>не делает операцию асинхронной</strong>. Он только <strong>откладывает</strong> ее выполнение на 10 секунд.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Что происходит:</strong></p>
<ol class="[li_&amp;]:mb-0 [li_&amp;]:mt-1.5 [li_&amp;]:gap-1.5 [&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-decimal flex flex-col gap-2 pl-8 mb-3">
<li class="whitespace-normal break-words pl-2">Через 10 секунд callback попадает в очередь <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">макротасков</code></li>
<li class="whitespace-normal break-words pl-2">Когда <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Event Loop</code> берет этот <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">макротаск</code>, он начинает выполнять циклы</li>
<li class="whitespace-normal break-words pl-2"><strong>Вся работа выполняется синхронно</strong> — <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Event Loop</code> заблокирован на время выполнения циклов</li>
<li class="whitespace-normal break-words pl-2">Другие клиенты, которые обращаются к серверу в это время, не получат ответ, пока циклы не завершатся</li>
</ol>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Правильное решение:</strong> Использовать Worker Threads, Child Processes или вынести тяжелые вычисления в отдельный сервис.</p>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">Цель эксперимента с синхронными операциями</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Внимание: Это демонстрация антипаттерна!</strong></p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">Код с вложенными циклами 40000 × 40000 показывает, что <strong>НИКОГДА НЕЛЬЗЯ ДЕЛАТЬ</strong> в production-коде:</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Что мы демонстрируем:</strong></p>
<ol class="[li_&amp;]:mb-0 [li_&amp;]:mt-1.5 [li_&amp;]:gap-1.5 [&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-decimal flex flex-col gap-2 pl-8 mb-3">
<li class="whitespace-normal break-words pl-2">Создаем маршрут <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">/admin/calc</code> с долгой синхронной операцией (5-6+ секунд)</li>
<li class="whitespace-normal break-words pl-2">Проверяем, могут ли другие клиенты получить ответ на главной странице <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">/</code> во время выполнения этой операции</li>
<li class="whitespace-normal break-words pl-2">Результат: <strong>все клиенты заблокированы</strong>, пока не завершится синхронная операция</li>
</ol>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Почему это плохо:</strong></p>
<ul class="[li_&amp;]:mb-0 [li_&amp;]:mt-1.5 [li_&amp;]:gap-1.5 [&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-disc flex flex-col gap-2 pl-8 mb-3">
<li class="whitespace-normal break-words pl-2">Node.js — однопоточная среда</li>
<li class="whitespace-normal break-words pl-2">Синхронная операция блокирует единственный поток</li>
<li class="whitespace-normal break-words pl-2">Пока один клиент ждет завершения вычислений, <strong>ВСЕ остальные клиенты не могут получить ответ</strong>, даже на простейший запрос</li>
</ul>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Правильный подход в реальных приложениях:</strong></p>
<ul class="[li_&amp;]:mb-0 [li_&amp;]:mt-1.5 [li_&amp;]:gap-1.5 [&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-disc flex flex-col gap-2 pl-8 mb-3">
<li class="whitespace-normal break-words pl-2">Использовать асинхронные операции везде, где возможно</li>
<li class="whitespace-normal break-words pl-2">Тяжелые вычисления выносить в Worker Threads</li>
<li class="whitespace-normal break-words pl-2">Использовать внешние сервисы для сложных операций</li>
<li class="whitespace-normal break-words pl-2">Применять очереди задач (Bull, RabbitMQ) для фоновой обработки</li>
</ul>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">HTTP статусы и заголовки: правильные подходы</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">В чистом Node.js (без фреймворков) есть два основных способа работы со статусами и заголовками:</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Установка статус-кода:</strong></p>
<div class="relative group/copy bg-bg-000/50 border-0.5 border-border-400 rounded-lg"><div class="sticky opacity-0 group-hover/copy:opacity-100 top-2 py-2 h-12 w-0 float-right"><div class="absolute right-0 h-8 px-2 items-center inline-flex z-10"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)] h-8 w-8 rounded-md active:scale-95 backdrop-blur-md Button_ghost__BUAoh" type="button" aria-label="Copy to clipboard" data-state="closed"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 transition-all opacity-100 scale-100" aria-hidden="true"><path d="M12.5 3C13.3284 3 14 3.67157 14 4.5V6H15.5C16.3284 6 17 6.67157 17 7.5V15.5C17 16.3284 16.3284 17 15.5 17H7.5C6.67157 17 6 16.3284 6 15.5V14H4.5C3.67157 14 3 13.3284 3 12.5V4.5C3 3.67157 3.67157 3 4.5 3H12.5ZM14 12.5C14 13.3284 13.3284 14 12.5 14H7V15.5C7 15.7761 7.22386 16 7.5 16H15.5C15.7761 16 16 15.7761 16 15.5V7.5C16 7.22386 15.7761 7 15.5 7H14V12.5ZM4.5 4C4.22386 4 4 4.22386 4 4.5V12.5C4 12.7761 4.22386 13 4.5 13H12.5C12.7761 13 13 12.7761 13 12.5V4.5C13 4.22386 12.7761 4 12.5 4H4.5Z"></path></svg></div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 absolute top-0 left-0 transition-all opacity-0 scale-50" aria-hidden="true"><path d="M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"></path></svg></div></div></button></div></div><div class="text-text-500 font-small p-3.5 pb-0">javascript</div><div><pre class="code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border-radius: 0.3em;"><code class="language-javascript" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none;"><span><span>response</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token property-access">statusCode</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">404</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span><span>response</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">end</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(152, 195, 121);">'Page not found'</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span></span></code></pre></div></div>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Установка заголовков:</strong></p>
<div class="relative group/copy bg-bg-000/50 border-0.5 border-border-400 rounded-lg"><div class="sticky opacity-0 group-hover/copy:opacity-100 top-2 py-2 h-12 w-0 float-right"><div class="absolute right-0 h-8 px-2 items-center inline-flex z-10"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)] h-8 w-8 rounded-md active:scale-95 backdrop-blur-md Button_ghost__BUAoh" type="button" aria-label="Copy to clipboard" data-state="closed"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 transition-all opacity-100 scale-100" aria-hidden="true"><path d="M12.5 3C13.3284 3 14 3.67157 14 4.5V6H15.5C16.3284 6 17 6.67157 17 7.5V15.5C17 16.3284 16.3284 17 15.5 17H7.5C6.67157 17 6 16.3284 6 15.5V14H4.5C3.67157 14 3 13.3284 3 12.5V4.5C3 3.67157 3.67157 3 4.5 3H12.5ZM14 12.5C14 13.3284 13.3284 14 12.5 14H7V15.5C7 15.7761 7.22386 16 7.5 16H15.5C15.7761 16 16 15.7761 16 15.5V7.5C16 7.22386 15.7761 7 15.5 7H14V12.5ZM4.5 4C4.22386 4 4 4.22386 4 4.5V12.5C4 12.7761 4.22386 13 4.5 13H12.5C12.7761 13 13 12.7761 13 12.5V4.5C13 4.22386 12.7761 4 12.5 4H4.5Z"></path></svg></div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 absolute top-0 left-0 transition-all opacity-0 scale-50" aria-hidden="true"><path d="M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"></path></svg></div></div></button></div></div><div class="text-text-500 font-small p-3.5 pb-0">javascript</div><div><pre class="code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border-radius: 0.3em;"><code class="language-javascript" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none;"><span><span>response</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">setHeader</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(152, 195, 121);">'Content-Type'</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(152, 195, 121);">'application/json'</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span><span>response</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">end</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token known-class-name" style="color: rgb(209, 154, 102);">JSON</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">stringify</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">{</span><span class="token literal-property" style="color: rgb(224, 108, 117);">error</span><span class="token" style="color: rgb(97, 175, 239);">:</span><span> </span><span class="token" style="color: rgb(152, 195, 121);">'Not found'</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span></span></code></pre></div></div>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Распространенная ошибка:</strong> Путать методы из фреймворков (например, Express) с чистым Node.js API. В Express есть метод <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">response.status(404)</code>, но в чистом Node.js его нет.</p>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">Сборщик мусора и жизненный цикл объектов</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Автоматическая очистка памяти работает для:</strong></p>
<ul class="[li_&amp;]:mb-0 [li_&amp;]:mt-1.5 [li_&amp;]:gap-1.5 [&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-disc flex flex-col gap-2 pl-8 mb-3">
<li class="whitespace-normal break-words pl-2">Локальных переменных внутри функции-обработчика запроса</li>
<li class="whitespace-normal break-words pl-2">Объектов, созданных в рамках обработки одного запроса</li>
<li class="whitespace-normal break-words pl-2">Временных данных, которые больше не нужны после <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">response.end()</code></li>
</ul>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Когда нужно управлять памятью вручную:</strong></p>
<ul class="[li_&amp;]:mb-0 [li_&amp;]:mt-1.5 [li_&amp;]:gap-1.5 [&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-disc flex flex-col gap-2 pl-8 mb-3">
<li class="whitespace-normal break-words pl-2">Глобальные переменные или переменные уровня модуля</li>
<li class="whitespace-normal break-words pl-2">Списки активных клиентов в real-time приложениях</li>
<li class="whitespace-normal break-words pl-2">Кэши, которые могут расти бесконечно</li>
<li class="whitespace-normal break-words pl-2">Подписки на события, которые не отписываются автоматически</li>
</ul>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Правило:</strong> Если данные нужны только для обработки одного запроса — <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">сборщик мусора</code> очистит их сам. Если данные живут между запросами — следите за ними вручную.</p></div></div><div><div class="standard-markdown grid-cols-1 grid gap-4 [&amp;_&gt;_*]:min-w-0 !gap-3.5"><h1 class="text-text-100 mt-3 -mb-1 text-[1.375rem] font-bold">Лекция по Node.js: Event Loop и оптимизация производительности</h1>
<h2 class="text-text-100 mt-3 -mb-1 text-[1.125rem] font-bold">Часть 1: Отредактированный транскрипт</h2>
<hr class="border-border-200 border-t-0.5 my-3 mx-1.5">
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:19:43 --- Рассмотрим ситуацию, когда на сервере выполняются тяжёлые математические вычисления. Смотрите, что происходит. Клиенты быстро получают главную страницу — всё работает отлично. Но если я запускаю синхронный код (неважно, сам синхронный код или <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">микротаски</code>), для нового клиента <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">макротаск</code> не запустится до тех пор, пока в рамках текущего макротаска не завершатся все микротаски. Только после того, как завершится расчёт результата, мы увидим эту страницу тоже.</p>
<img :src="screenshot_4814" alt="Image" >
<img :src="screenshot_4824" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:20:10 --- Проблема в том, что клиент на этой странице результат не видит. Чтобы он его увидел, можем сделать примерно так (демонстрирую для примера). Суть проблемы в следующем: если на сервере запущена длительная операция, клиенты, которым нужна простая статическая страница, также вынуждены ждать. Потому что система не доходит до их макротасков. Прошу подтвердить плюсами в чате, если эта проблема понятна.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:20:38 --- Любые длинные задачи — серьёзная проблема в Node.js. Сергей пишет: "Как-то грустно получается". Но почему грустно? На самом деле, мы вряд ли получим такую длинную задачу, если пишем код правильно. Что я имею в виду под "правильным кодом"? Когда делаем запрос к базе данных, до тех пор пока база не ответила, обработка происходит в отдельном макротаске.</p>
<img :src="screenshot_4869" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:21:03 --- Можно подумать, что мы затормозим остальных клиентов, если сделаем запрос с кучей джойнов к базе данных. В PHP, например, запрос к базе с множеством джойнов действительно тормозит выполнение кода. Правда, там для каждого клиента файл запускается заново, что несколько компенсирует ситуацию. В JavaScript (JS) же всё работает иначе. Если напишем запрос с использованием пакета <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">mysql2</code>, вызвав метод <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">query</code>, то запрос к базе будет отправлен, и момент окончания этого запроса станет новым макротаском.</p>
<img :src="screenshot_4903" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:21:36 --- Независимо от того, насколько тяжёлым является этот запрос к базе данных, другие клиенты не страдают. Если читаем большой файл с аналитическими данными и напишем <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">fs.readFileSync</code>, это может стать проблемой, потому что <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">readFileSync</code> — это <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">блокирующий</code> синхронный код.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:21:59 --- Буду читать огромный файл размером в мегабайты и анализировать его содержимое — все клиенты подвиснут. Но если напишу просто <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">fs.readFile</code> (функцию, которая работает либо через промисы, либо через колбэки), то независимо от того, сколько времени займёт чтение файла, его обработка и чтение уйдут в отдельный макротаск, а другие клиенты ждать не будут. Поэтому, если мы сами не вредим системе, всё работает нормально.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:22:30 --- Тяжёлые расчёты можно выносить на другой сервер или на другое процессорное ядро с помощью модуля <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">worker_threads</code>. Чтение файла в любом случае происходит в соседнем потоке. Фишка в том, что в браузере, например, JavaScript — однопоточный язык, но сам браузер написан на многопоточном языке.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:23:02 --- Поэтому существуют <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Web Workers</code> — возможность вынести какую-то вычислительную операцию на другое ядро процессора даже в JavaScript. Вы просто создаёте веб-воркер, даёте ссылку на файл, он работает в отдельном потоке и присылает сообщение, когда результат рассчитан. В Node.js можно сделать то же самое с помощью модуля <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">worker_threads</code>.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:23:25 --- Если будет время и желание, посмотрим, как это могло бы выглядеть. Но даже если у вас нет worker threads или нет возможности вынести тяжёлую операцию на отдельное ядро, что тогда делать? Нужно разбить её на макротаски. Чем технически можем заменить цикл? Ведь цикл в <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">setTimeout</code> передать нельзя.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:23:54 --- Что можно передать в setTimeout? Правильно — функции и рекурсию. Можем создать функцию <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">iLoop</code>, внутри которой будет инкремент <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">i++</code>, и проверка: если <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">i</code> меньше 40000, тогда снова вызываем <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">iLoop</code>.</p>
<div class="relative group/copy bg-bg-000/50 border-0.5 border-border-400 rounded-lg"><div class="sticky opacity-0 group-hover/copy:opacity-100 top-2 py-2 h-12 w-0 float-right"><div class="absolute right-0 h-8 px-2 items-center inline-flex z-10"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)] h-8 w-8 rounded-md active:scale-95 backdrop-blur-md Button_ghost__BUAoh" type="button" aria-label="Copy to clipboard" data-state="closed"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 transition-all opacity-100 scale-100" aria-hidden="true"><path d="M12.5 3C13.3284 3 14 3.67157 14 4.5V6H15.5C16.3284 6 17 6.67157 17 7.5V15.5C17 16.3284 16.3284 17 15.5 17H7.5C6.67157 17 6 16.3284 6 15.5V14H4.5C3.67157 14 3 13.3284 3 12.5V4.5C3 3.67157 3.67157 3 4.5 3H12.5ZM14 12.5C14 13.3284 13.3284 14 12.5 14H7V15.5C7 15.7761 7.22386 16 7.5 16H15.5C15.7761 16 16 15.7761 16 15.5V7.5C16 7.22386 15.7761 7 15.5 7H14V12.5ZM4.5 4C4.22386 4 4 4.22386 4 4.5V12.5C4 12.7761 4.22386 13 4.5 13H12.5C12.7761 13 13 12.7761 13 12.5V4.5C13 4.22386 12.7761 4 12.5 4H4.5Z"></path></svg></div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 absolute top-0 left-0 transition-all opacity-0 scale-50" aria-hidden="true"><path d="M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"></path></svg></div></div></button></div></div><div class="text-text-500 font-small p-3.5 pb-0">javascript</div><div><pre class="code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border-radius: 0.3em;"><code class="language-javascript" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none;"><span><span class="token" style="color: rgb(198, 120, 221);">let</span><span> i </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(198, 120, 221);">function</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">iLoop</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>
</span></span><span><span>  i</span><span class="token" style="color: rgb(97, 175, 239);">++</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span><span>  </span><span class="token control-flow" style="color: rgb(198, 120, 221);">if</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>i </span><span class="token" style="color: rgb(97, 175, 239);">&lt;</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">40000</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(97, 175, 239);">iLoop</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(171, 178, 191);">}</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(171, 178, 191);">}</span></span></code></pre></div></div>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:24:39 --- Погодите-ка, это пока неправильный вариант запуска. Это пока просто код, написанный по-другому, который не решает проблему блокировки. Эта рекурсивная функция всё ещё выполняется синхронно.</p>
<img :src="screenshot_5102" alt="Image" >
<img :src="screenshot_5121" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:24:56 --- Проверим, что код написан правильно и не запустили ли мы бесконечную рекурсию. Когда запускаю с большими числами, вижу ошибку: <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">RangeError: Maximum call stack size exceeded</code> (превышен максимум стека вызовов). Вылетела оперативная память из-за ограничения на глубину стека вызовов.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:25:22 --- Переменная <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">i</code> видна функции по замыканию, и за один запуск она изменяет переменную на единицу. <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">iLoop</code> видит эту переменную по замыканию и редактирует её. Когда значение достигнет 40001, функция должна прекратить вызовы.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:25:52 --- В JavaScript разрешена рекурсия на определённое количество уровней, но не на 40 тысяч уровней вглубь. Сорок тысяч — это перебор. Если напишу 100, то всё пройдёт нормально.</p>
<img :src="screenshot_5205" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:26:19 --- Проверяем: для 100 итераций работает нормально, для 1000 тоже проходит. Просто 40 тысяч синхронных рекурсивных вызовов запустить нельзя — JavaScript защищает систему от подобных ситуаций. Прошу подтвердить плюсами, если понятно, что код написан правильно, но JavaScript ограничивает глубину синхронной рекурсии.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:26:47 --- JavaScript защищает от ошибок программиста лучше, чем мы думаем: если вы запустили 40 тысяч рекурсивных вызовов вглубь, лучше крашнуть приложение, чем допустить непредсказуемое поведение. Этот код всё ещё полностью синхронный. Пока идёт расчёт, главная страница клиентам не показывается.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:27:11 --- Обе страницы резолвятся одновременно только после завершения расчётов. Что можно сделать? Абсолютно правильно написали про <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">setTimeout</code>. Если даже оставим 40000 итераций, но добавим <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">setTimeout(iLoop, 0)</code> внутри функции, и в else-блоке напишем <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">response.end(longResult)</code>, создадим <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">неблокирующий расчёт</code> из 40 000 макрозадач.</p>
<div class="relative group/copy bg-bg-000/50 border-0.5 border-border-400 rounded-lg"><div class="sticky opacity-0 group-hover/copy:opacity-100 top-2 py-2 h-12 w-0 float-right"><div class="absolute right-0 h-8 px-2 items-center inline-flex z-10"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)] h-8 w-8 rounded-md active:scale-95 backdrop-blur-md Button_ghost__BUAoh" type="button" aria-label="Copy to clipboard" data-state="closed"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 transition-all opacity-100 scale-100" aria-hidden="true"><path d="M12.5 3C13.3284 3 14 3.67157 14 4.5V6H15.5C16.3284 6 17 6.67157 17 7.5V15.5C17 16.3284 16.3284 17 15.5 17H7.5C6.67157 17 6 16.3284 6 15.5V14H4.5C3.67157 14 3 13.3284 3 12.5V4.5C3 3.67157 3.67157 3 4.5 3H12.5ZM14 12.5C14 13.3284 13.3284 14 12.5 14H7V15.5C7 15.7761 7.22386 16 7.5 16H15.5C15.7761 16 16 15.7761 16 15.5V7.5C16 7.22386 15.7761 7 15.5 7H14V12.5ZM4.5 4C4.22386 4 4 4.22386 4 4.5V12.5C4 12.7761 4.22386 13 4.5 13H12.5C12.7761 13 13 12.7761 13 12.5V4.5C13 4.22386 12.7761 4 12.5 4H4.5Z"></path></svg></div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 absolute top-0 left-0 transition-all opacity-0 scale-50" aria-hidden="true"><path d="M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"></path></svg></div></div></button></div></div><div class="text-text-500 font-small p-3.5 pb-0">javascript</div><div><pre class="code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border-radius: 0.3em;"><code class="language-javascript" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none;"><span><span class="token" style="color: rgb(198, 120, 221);">let</span><span> i </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(198, 120, 221);">let</span><span> longResult </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span>
</span><span><span></span><span class="token" style="color: rgb(198, 120, 221);">function</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">iLoop</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>
</span></span><span><span>  </span><span class="token control-flow" style="color: rgb(198, 120, 221);">for</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(198, 120, 221);">let</span><span> j </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span> j </span><span class="token" style="color: rgb(97, 175, 239);">&lt;</span><span> i</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span> j</span><span class="token" style="color: rgb(97, 175, 239);">++</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>
</span></span><span><span>    longResult </span><span class="token" style="color: rgb(97, 175, 239);">+=</span><span> j</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(171, 178, 191);">}</span><span>
</span></span><span><span>  i</span><span class="token" style="color: rgb(97, 175, 239);">++</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token control-flow" style="color: rgb(198, 120, 221);">if</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>i </span><span class="token" style="color: rgb(97, 175, 239);">&lt;</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">40000</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(97, 175, 239);">setTimeout</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>iLoop</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(171, 178, 191);">}</span><span> </span><span class="token control-flow" style="color: rgb(198, 120, 221);">else</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>
</span></span><span><span>    response</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">end</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>longResult</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">toString</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(171, 178, 191);">}</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(171, 178, 191);">}</span></span></code></pre></div></div>
<img :src="screenshot_5269" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:27:41 --- Каждый вызов теперь — новая макрозадача. Смотрите, что происходит. Переходим на адрес с длинным расчётом, а статическую страницу клиентам отдаём без проблем. Потому что задача разбита на 40 тысяч макротасков, по одному циклу на каждое значение <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">i</code>. Никакого ограничения на рекурсию здесь нет. Почему? Потому что ограничения на рекурсию есть только в <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">синхронном коде</code>.</p>
<img :src="screenshot_5314" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:28:07 --- В <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">асинхронном коде</code> рекурсия работает без ограничений. Правда, есть ощущение, что код работает не совсем корректно, потому что система не хочет завершать расчёты. Поставлю пока меньшее число и проверю, насколько нормально она работает. За счёт разбивки на макротаски операция стала выполняться гораздо дольше.</p>
<img :src="screenshot_5326" alt="Image" >
<img :src="screenshot_5338" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:28:39 --- Это нагрузка для <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Event Loop</code>: он откладывает макротаск, запускает из него микротаски, откладывает следующий макротаск, запускает микротаски — и так постоянно. Расчёт стал очень долгим. Раньше система считала 40 тысяч в квадрате быстро, а теперь не может посчитать 40 тысяч на 2000 за 5-6 секунд.</p>
<img :src="screenshot_5359" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:29:03 --- Видите, как мы оптимизировали блокируемость операции? Она не блокирует главную страницу, но скорость расчёта стала просто ужасной. Суть в том, что если есть длинная операция, которую удалось сегментировать на части, это приемлемо. Можно запускать <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">setTimeout</code> через каждую тысячу операций, а не через каждую.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:29:31 --- Разбивка на 40 тысяч отдельных тасков явно избыточна. Понятно, что надо рассчитывать более крупными порциями. Но <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">setTimeout</code> — не самый удачный колбэк для Node.js. Это решение пришло из браузерного JavaScript. В Node.js есть более подходящий колбэк — <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">setImmediate</code>. Он выполняет код немедленно, после завершения других активных макротасков.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:30:03 --- Тарас пишет, что setTimeout в браузере работает иначе с точки зрения области видимости переменных. На самом деле, в браузере <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">setTimeout(fn, 0)</code> тоже переносит выполнение кода за всю синхронность. Область видимости переменных от таймаута не зависит — какие переменные функция видит по замыканию, такие и видит. До тех пор, пока существует хотя бы одна активная ссылка на функцию, она продлевает срок жизни переменным (например, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">res</code>, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">request</code>, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">response</code>).</p>
<img :src="screenshot_5453" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:30:36 --- <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">setImmediate</code> восстановит производительность более адекватно. Будет быстрее, чем с <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">setTimeout(0)</code>, потому что setTimeout — это обращение к операционной системе, установка таймера и вся сопутствующая работа.</p>
<img :src="screenshot_5465" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:30:56 --- Даже расчёт на 40 тысяч итераций будет идти за приемлемое время. Хотя это будет медленнее, чем обычный синхронный код, но явно не так долго, как с setTimeout(0).</p>
<img :src="screenshot_5498" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:31:24 --- Видим, что система испытывает нагрузку. 40 на 40 тысяч рассчитала не за 5-6 секунд, как с setTimeout, а примерно за 15 секунд. Это культурный способ отложить выполнение задачи на ближайшее свободное время. Прошу подтвердить плюсами, если понятно, как теоретически можно разбить длинную задачу в Node.js на части. Но, конечно, на том же ядре, где обрабатываются все клиенты, запускать длинные задачи нехорошо.</p>
<img :src="screenshot_5546" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:31:57 --- Это факт. Если клиентов много, они в приоритете благодаря <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">setImmediate</code> — не будем их тормозить, но затормозим выполнение нашей длинной задачи. Каждый приходящий на сайт клиент будет немного тормозить выполнение этой задачи. Важно понимать: если сейчас заново зайду на адрес <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">/admin/calc</code>, запустится тот же самый расчёт заново.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:32:28 --- То есть этот адрес не тот, на который все пользователи обращаются постоянно. Это просто URL, который является триггером запуска операции.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:32:41 --- Представим: на фронтенде принимаем запросы от клиентов, раздаём статику. А тут приходит администратор и загружает в админку Excel-файл на 10 или даже 100 мегабайт, который нужно распарсить, посчитать аналитику и показать клиентам. Администратор загрузкой файла симулирует тяжёлую операцию, которая может начать тормозить клиентов, и мы этого боимся. Этот адрес всё равно приведёт к проблемам, если отправлю на него запросы с трёх вкладок одновременно.</p>
<img :src="screenshot_5603" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:33:18 --- Ничего хорошего от этого не будет. Теоретически можно попробовать вынести эту операцию на отдельное ядро процессора. Интересно ли вам поэкспериментировать с этим? Попробуем с выносом на отдельные ядра через worker threads. Скопирую проект в отдельную папку.</p>
<img :src="screenshot_5658" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:33:52 --- Применять микросервисную архитектуру мы будем позже. Сейчас попробуем решение с worker threads. Создаю новую структуру проекта.</p>
<img :src="screenshot_5674" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:34:26 --- Сначала базовая система без эмуляции сложной операции. Упрощаю код: <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">response.end('here')</code>, удаляю worker, подключаю пакет на 4-й порт, дописываю новый скрипт. Теперь нас интересует модуль <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">worker_threads</code>.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:35:03 --- Импортируем Worker из модуля worker_threads:</p>
<div class="relative group/copy bg-bg-000/50 border-0.5 border-border-400 rounded-lg"><div class="sticky opacity-0 group-hover/copy:opacity-100 top-2 py-2 h-12 w-0 float-right"><div class="absolute right-0 h-8 px-2 items-center inline-flex z-10"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)] h-8 w-8 rounded-md active:scale-95 backdrop-blur-md Button_ghost__BUAoh" type="button" aria-label="Copy to clipboard" data-state="closed"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 transition-all opacity-100 scale-100" aria-hidden="true"><path d="M12.5 3C13.3284 3 14 3.67157 14 4.5V6H15.5C16.3284 6 17 6.67157 17 7.5V15.5C17 16.3284 16.3284 17 15.5 17H7.5C6.67157 17 6 16.3284 6 15.5V14H4.5C3.67157 14 3 13.3284 3 12.5V4.5C3 3.67157 3.67157 3 4.5 3H12.5ZM14 12.5C14 13.3284 13.3284 14 12.5 14H7V15.5C7 15.7761 7.22386 16 7.5 16H15.5C15.7761 16 16 15.7761 16 15.5V7.5C16 7.22386 15.7761 7 15.5 7H14V12.5ZM4.5 4C4.22386 4 4 4.22386 4 4.5V12.5C4 12.7761 4.22386 13 4.5 13H12.5C12.7761 13 13 12.7761 13 12.5V4.5C13 4.22386 12.7761 4 12.5 4H4.5Z"></path></svg></div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 absolute top-0 left-0 transition-all opacity-0 scale-50" aria-hidden="true"><path d="M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"></path></svg></div></div></button></div></div><div class="text-text-500 font-small p-3.5 pb-0">javascript</div><div><pre class="code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border-radius: 0.3em;"><code class="language-javascript" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none;"><span><span class="token" style="color: rgb(198, 120, 221);">const</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span> </span><span class="token maybe-class-name">Worker</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">}</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">require</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(152, 195, 121);">'worker_threads'</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span></span></code></pre></div></div>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">Проверяю, что ничего не сломалось.</p>
<img :src="screenshot_5737" alt="Image" >
<img :src="screenshot_5751" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:35:26 --- Четвёртый сервер стартовал. Адрес <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">/admin/calc</code> должен выдавать просто надпись "here". Проверяю — работает. Перезапускаюсь с правильной конфигурацией. Здесь должно написаться в консоли "look here", а в браузере — "результат не рассчитан".</p>
<img :src="screenshot_5776" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:35:54 --- Суть модуля <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">worker_threads</code> в следующем: можем в этой точке создать новый воркер:</p>
<div class="relative group/copy bg-bg-000/50 border-0.5 border-border-400 rounded-lg"><div class="sticky opacity-0 group-hover/copy:opacity-100 top-2 py-2 h-12 w-0 float-right"><div class="absolute right-0 h-8 px-2 items-center inline-flex z-10"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)] h-8 w-8 rounded-md active:scale-95 backdrop-blur-md Button_ghost__BUAoh" type="button" aria-label="Copy to clipboard" data-state="closed"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 transition-all opacity-100 scale-100" aria-hidden="true"><path d="M12.5 3C13.3284 3 14 3.67157 14 4.5V6H15.5C16.3284 6 17 6.67157 17 7.5V15.5C17 16.3284 16.3284 17 15.5 17H7.5C6.67157 17 6 16.3284 6 15.5V14H4.5C3.67157 14 3 13.3284 3 12.5V4.5C3 3.67157 3.67157 3 4.5 3H12.5ZM14 12.5C14 13.3284 13.3284 14 12.5 14H7V15.5C7 15.7761 7.22386 16 7.5 16H15.5C15.7761 16 16 15.7761 16 15.5V7.5C16 7.22386 15.7761 7 15.5 7H14V12.5ZM4.5 4C4.22386 4 4 4.22386 4 4.5V12.5C4 12.7761 4.22386 13 4.5 13H12.5C12.7761 13 13 12.7761 13 12.5V4.5C13 4.22386 12.7761 4 12.5 4H4.5Z"></path></svg></div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 absolute top-0 left-0 transition-all opacity-0 scale-50" aria-hidden="true"><path d="M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"></path></svg></div></div></button></div></div><div class="text-text-500 font-small p-3.5 pb-0">javascript</div><div><pre class="code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border-radius: 0.3em;"><code class="language-javascript" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none;"><span><span class="token" style="color: rgb(198, 120, 221);">const</span><span> worker </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">new</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">Worker</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(152, 195, 121);">'./worker.js'</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span></span></code></pre></div></div>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:36:19 --- Здесь указываем путь к файлу в файловой системе, который является рассчитывающим модулем, например <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">worker.js</code>. Создаю этот файл. Ничего не должно сломаться — всё работает.</p>
<img :src="screenshot_5827" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:36:56 --- Web Workers традиционно не имеют доступа к стандартному API системы. Если создаём Worker из обычного JavaScript, в воркере нет <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">window</code>, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">document</code> — он работает в изолированном окружении. Какие переменные создали, какие модули подключили — с тем и работаете в этом изолированном контексте.</p>
<hr class="border-border-200 border-t-0.5 my-3 mx-1.5">
<h2 class="text-text-100 mt-3 -mb-1 text-[1.125rem] font-bold">Часть 2: Дополнительные объяснения</h2>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">1. Механизм Event Loop в Node.js</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Event Loop</code> (цикл событий) — это основа асинхронной работы Node.js. Он работает в одном потоке и обрабатывает задачи в несколько этапов:</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Макротаски</strong> — это основные единицы работы, которые Event Loop обрабатывает по очереди. Примеры макротасков:</p>
<ul class="[li_&amp;]:mb-0 [li_&amp;]:mt-1.5 [li_&amp;]:gap-1.5 [&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-disc flex flex-col gap-2 pl-8 mb-3">
<li class="whitespace-normal break-words pl-2">Обработка нового HTTP-запроса</li>
<li class="whitespace-normal break-words pl-2">Выполнение колбэка таймера (setTimeout, setInterval)</li>
<li class="whitespace-normal break-words pl-2">Выполнение setImmediate</li>
<li class="whitespace-normal break-words pl-2">Завершение I/O операции (чтение файла, запрос к БД)</li>
</ul>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Микротаски</strong> — это задачи с более высоким приоритетом, которые выполняются после завершения текущего макротаска, но ДО следующего. Примеры микротасков:</p>
<ul class="[li_&amp;]:mb-0 [li_&amp;]:mt-1.5 [li_&amp;]:gap-1.5 [&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-disc flex flex-col gap-2 pl-8 mb-3">
<li class="whitespace-normal break-words pl-2">Обработка промисов (.then, .catch, .finally)</li>
<li class="whitespace-normal break-words pl-2">process.nextTick</li>
</ul>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Ключевой принцип</strong>: Event Loop не переходит к следующему макротаску, пока не выполнит ВСЕ микротаски текущего макротаска. Если в текущем макротаске выполняется тяжёлый синхронный код, все остальные макротаски (включая обработку запросов от других клиентов) ждут своей очереди.</p>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">2. PHP vs Node.js: архитектурные различия</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>PHP (традиционная модель)</strong>:</p>
<ul class="[li_&amp;]:mb-0 [li_&amp;]:mt-1.5 [li_&amp;]:gap-1.5 [&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-disc flex flex-col gap-2 pl-8 mb-3">
<li class="whitespace-normal break-words pl-2">Для каждого запроса создаётся отдельный процесс</li>
<li class="whitespace-normal break-words pl-2">Каждый процесс имеет свою память и выполняется независимо</li>
<li class="whitespace-normal break-words pl-2">Если один запрос тормозит (например, сложный SQL), другие запросы не затрагиваются</li>
<li class="whitespace-normal break-words pl-2">Недостаток: большое потребление памяти при множестве одновременных запросов</li>
</ul>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Node.js (событийная модель)</strong>:</p>
<ul class="[li_&amp;]:mb-0 [li_&amp;]:mt-1.5 [li_&amp;]:gap-1.5 [&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-disc flex flex-col gap-2 pl-8 mb-3">
<li class="whitespace-normal break-words pl-2">Один процесс обрабатывает все запросы</li>
<li class="whitespace-normal break-words pl-2">Все клиенты используют один Event Loop</li>
<li class="whitespace-normal break-words pl-2">Если один запрос блокирует Event Loop синхронным кодом, страдают все клиенты</li>
<li class="whitespace-normal break-words pl-2">Преимущество: эффективное использование памяти, высокая производительность при правильном коде</li>
</ul>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">3. Блокирующие vs Неблокирующие операции</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Блокирующие операции</strong> (опасные для Node.js):</p>
<div class="relative group/copy bg-bg-000/50 border-0.5 border-border-400 rounded-lg"><div class="sticky opacity-0 group-hover/copy:opacity-100 top-2 py-2 h-12 w-0 float-right"><div class="absolute right-0 h-8 px-2 items-center inline-flex z-10"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)] h-8 w-8 rounded-md active:scale-95 backdrop-blur-md Button_ghost__BUAoh" type="button" aria-label="Copy to clipboard" data-state="closed"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 transition-all opacity-100 scale-100" aria-hidden="true"><path d="M12.5 3C13.3284 3 14 3.67157 14 4.5V6H15.5C16.3284 6 17 6.67157 17 7.5V15.5C17 16.3284 16.3284 17 15.5 17H7.5C6.67157 17 6 16.3284 6 15.5V14H4.5C3.67157 14 3 13.3284 3 12.5V4.5C3 3.67157 3.67157 3 4.5 3H12.5ZM14 12.5C14 13.3284 13.3284 14 12.5 14H7V15.5C7 15.7761 7.22386 16 7.5 16H15.5C15.7761 16 16 15.7761 16 15.5V7.5C16 7.22386 15.7761 7 15.5 7H14V12.5ZM4.5 4C4.22386 4 4 4.22386 4 4.5V12.5C4 12.7761 4.22386 13 4.5 13H12.5C12.7761 13 13 12.7761 13 12.5V4.5C13 4.22386 12.7761 4 12.5 4H4.5Z"></path></svg></div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 absolute top-0 left-0 transition-all opacity-0 scale-50" aria-hidden="true"><path d="M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"></path></svg></div></div></button></div></div><div class="text-text-500 font-small p-3.5 pb-0">javascript</div><div><pre class="code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border-radius: 0.3em;"><code class="language-javascript" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none;"><span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// ПЛОХО: Блокирует Event Loop</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(198, 120, 221);">const</span><span> data </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> fs</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">readFileSync</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(152, 195, 121);">'huge-file.txt'</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span><span></span><span class="token console" style="color: rgb(209, 154, 102);">console</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">log</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>data</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span>
</span><span><span></span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// ПЛОХО: Тяжёлые вычисления</span><span>
</span></span><span><span></span><span class="token control-flow" style="color: rgb(198, 120, 221);">for</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(198, 120, 221);">let</span><span> i </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span> i </span><span class="token" style="color: rgb(97, 175, 239);">&lt;</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">1000000000</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span> i</span><span class="token" style="color: rgb(97, 175, 239);">++</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// сложные вычисления</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(171, 178, 191);">}</span></span></code></pre></div></div>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Неблокирующие операции</strong> (правильные для Node.js):</p>
<div class="relative group/copy bg-bg-000/50 border-0.5 border-border-400 rounded-lg"><div class="sticky opacity-0 group-hover/copy:opacity-100 top-2 py-2 h-12 w-0 float-right"><div class="absolute right-0 h-8 px-2 items-center inline-flex z-10"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)] h-8 w-8 rounded-md active:scale-95 backdrop-blur-md Button_ghost__BUAoh" type="button" aria-label="Copy to clipboard" data-state="closed"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 transition-all opacity-100 scale-100" aria-hidden="true"><path d="M12.5 3C13.3284 3 14 3.67157 14 4.5V6H15.5C16.3284 6 17 6.67157 17 7.5V15.5C17 16.3284 16.3284 17 15.5 17H7.5C6.67157 17 6 16.3284 6 15.5V14H4.5C3.67157 14 3 13.3284 3 12.5V4.5C3 3.67157 3.67157 3 4.5 3H12.5ZM14 12.5C14 13.3284 13.3284 14 12.5 14H7V15.5C7 15.7761 7.22386 16 7.5 16H15.5C15.7761 16 16 15.7761 16 15.5V7.5C16 7.22386 15.7761 7 15.5 7H14V12.5ZM4.5 4C4.22386 4 4 4.22386 4 4.5V12.5C4 12.7761 4.22386 13 4.5 13H12.5C12.7761 13 13 12.7761 13 12.5V4.5C13 4.22386 12.7761 4 12.5 4H4.5Z"></path></svg></div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 absolute top-0 left-0 transition-all opacity-0 scale-50" aria-hidden="true"><path d="M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"></path></svg></div></div></button></div></div><div class="text-text-500 font-small p-3.5 pb-0">javascript</div><div><pre class="code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border-radius: 0.3em;"><code class="language-javascript" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none;"><span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// ХОРОШО: Не блокирует Event Loop</span><span>
</span></span><span><span>fs</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">readFile</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(152, 195, 121);">'huge-file.txt'</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token parameter">err</span><span class="token parameter" style="color: rgb(171, 178, 191);">,</span><span class="token parameter"> data</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token arrow" style="color: rgb(97, 175, 239);">=&gt;</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>
</span></span><span><span>  </span><span class="token console" style="color: rgb(209, 154, 102);">console</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">log</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>data</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span>
</span><span><span></span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// ХОРОШО: Асинхронный запрос к БД</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(198, 120, 221);">const</span><span> mysql </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">require</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(152, 195, 121);">'mysql2/promise'</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(198, 120, 221);">const</span><span> result </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token control-flow" style="color: rgb(198, 120, 221);">await</span><span> connection</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">query</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(152, 195, 121);">'SELECT * FROM users'</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span></span></code></pre></div></div>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Почему неблокирующие операции безопасны?</strong>
Когда Node.js вызывает асинхронную операцию (чтение файла, запрос к БД), он передаёт задачу операционной системе или специальному потоку. Event Loop продолжает работать с другими задачами. Когда операция завершается, её результат обрабатывается в новом макротаске.</p>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">4. Замыкания и область видимости в setTimeout</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">Замыкание — это механизм, при котором функция "запоминает" переменные из внешней области видимости, даже если внешняя функция завершилась.</p>
<div class="relative group/copy bg-bg-000/50 border-0.5 border-border-400 rounded-lg"><div class="sticky opacity-0 group-hover/copy:opacity-100 top-2 py-2 h-12 w-0 float-right"><div class="absolute right-0 h-8 px-2 items-center inline-flex z-10"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)] h-8 w-8 rounded-md active:scale-95 backdrop-blur-md Button_ghost__BUAoh" type="button" aria-label="Copy to clipboard" data-state="closed"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 transition-all opacity-100 scale-100" aria-hidden="true"><path d="M12.5 3C13.3284 3 14 3.67157 14 4.5V6H15.5C16.3284 6 17 6.67157 17 7.5V15.5C17 16.3284 16.3284 17 15.5 17H7.5C6.67157 17 6 16.3284 6 15.5V14H4.5C3.67157 14 3 13.3284 3 12.5V4.5C3 3.67157 3.67157 3 4.5 3H12.5ZM14 12.5C14 13.3284 13.3284 14 12.5 14H7V15.5C7 15.7761 7.22386 16 7.5 16H15.5C15.7761 16 16 15.7761 16 15.5V7.5C16 7.22386 15.7761 7 15.5 7H14V12.5ZM4.5 4C4.22386 4 4 4.22386 4 4.5V12.5C4 12.7761 4.22386 13 4.5 13H12.5C12.7761 13 13 12.7761 13 12.5V4.5C13 4.22386 12.7761 4 12.5 4H4.5Z"></path></svg></div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 absolute top-0 left-0 transition-all opacity-0 scale-50" aria-hidden="true"><path d="M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"></path></svg></div></div></button></div></div><div class="text-text-500 font-small p-3.5 pb-0">javascript</div><div><pre class="code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border-radius: 0.3em;"><code class="language-javascript" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none;"><span><span class="token" style="color: rgb(198, 120, 221);">function</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">createCounter</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">let</span><span> count </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span> </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// Эта переменная "захватывается" замыканием</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token control-flow" style="color: rgb(198, 120, 221);">return</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">function</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>
</span></span><span><span>    count</span><span class="token" style="color: rgb(97, 175, 239);">++</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span> </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// Функция имеет доступ к count</span><span>
</span></span><span><span>    </span><span class="token console" style="color: rgb(209, 154, 102);">console</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">log</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>count</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(171, 178, 191);">}</span><span>
</span></span><span>
</span><span><span></span><span class="token" style="color: rgb(198, 120, 221);">const</span><span> counter </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">createCounter</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(97, 175, 239);">counter</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span> </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// 1</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(97, 175, 239);">counter</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span> </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// 2</span></span></code></pre></div></div>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">В контексте setTimeout с рекурсией:</p>
<div class="relative group/copy bg-bg-000/50 border-0.5 border-border-400 rounded-lg"><div class="sticky opacity-0 group-hover/copy:opacity-100 top-2 py-2 h-12 w-0 float-right"><div class="absolute right-0 h-8 px-2 items-center inline-flex z-10"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)] h-8 w-8 rounded-md active:scale-95 backdrop-blur-md Button_ghost__BUAoh" type="button" aria-label="Copy to clipboard" data-state="closed"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 transition-all opacity-100 scale-100" aria-hidden="true"><path d="M12.5 3C13.3284 3 14 3.67157 14 4.5V6H15.5C16.3284 6 17 6.67157 17 7.5V15.5C17 16.3284 16.3284 17 15.5 17H7.5C6.67157 17 6 16.3284 6 15.5V14H4.5C3.67157 14 3 13.3284 3 12.5V4.5C3 3.67157 3.67157 3 4.5 3H12.5ZM14 12.5C14 13.3284 13.3284 14 12.5 14H7V15.5C7 15.7761 7.22386 16 7.5 16H15.5C15.7761 16 16 15.7761 16 15.5V7.5C16 7.22386 15.7761 7 15.5 7H14V12.5ZM4.5 4C4.22386 4 4 4.22386 4 4.5V12.5C4 12.7761 4.22386 13 4.5 13H12.5C12.7761 13 13 12.7761 13 12.5V4.5C13 4.22386 12.7761 4 12.5 4H4.5Z"></path></svg></div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 absolute top-0 left-0 transition-all opacity-0 scale-50" aria-hidden="true"><path d="M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"></path></svg></div></div></button></div></div><div class="text-text-500 font-small p-3.5 pb-0">javascript</div><div><pre class="code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border-radius: 0.3em;"><code class="language-javascript" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none;"><span><span class="token" style="color: rgb(198, 120, 221);">let</span><span> i </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(198, 120, 221);">let</span><span> result </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span>
</span><span><span></span><span class="token" style="color: rgb(198, 120, 221);">function</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">iLoop</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// iLoop видит i и result по замыканию</span><span>
</span></span><span><span>  result </span><span class="token" style="color: rgb(97, 175, 239);">+=</span><span> i</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span><span>  i</span><span class="token" style="color: rgb(97, 175, 239);">++</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token control-flow" style="color: rgb(198, 120, 221);">if</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>i </span><span class="token" style="color: rgb(97, 175, 239);">&lt;</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">1000</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(97, 175, 239);">setTimeout</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>iLoop</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span> </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// Ссылка на iLoop сохраняется</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(171, 178, 191);">}</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(171, 178, 191);">}</span><span>
</span></span><span>
</span><span><span></span><span class="token" style="color: rgb(97, 175, 239);">iLoop</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span> </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// Запуск</span></span></code></pre></div></div>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">До тех пор, пока существует хотя бы одна ссылка на функцию <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">iLoop</code> (в очереди setTimeout), переменные <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">i</code> и <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">result</code> не удаляются из памяти.</p>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">5. Ограничения глубины рекурсии в JavaScript</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">JavaScript защищает систему от переполнения стека вызовов. Типичные лимиты:</p>
<ul class="[li_&amp;]:mb-0 [li_&amp;]:mt-1.5 [li_&amp;]:gap-1.5 [&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-disc flex flex-col gap-2 pl-8 mb-3">
<li class="whitespace-normal break-words pl-2"><strong>Chrome/V8</strong>: ~10,000-15,000 вызовов</li>
<li class="whitespace-normal break-words pl-2"><strong>Firefox</strong>: ~50,000 вызовов</li>
<li class="whitespace-normal break-words pl-2"><strong>Node.js</strong>: ~10,000-12,000 вызовов</li>
</ul>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">Когда превышается лимит, выбрасывается ошибка:</p>
<div class="relative group/copy bg-bg-000/50 border-0.5 border-border-400 rounded-lg"><div class="sticky opacity-0 group-hover/copy:opacity-100 top-2 py-2 h-12 w-0 float-right"><div class="absolute right-0 h-8 px-2 items-center inline-flex z-10"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)] h-8 w-8 rounded-md active:scale-95 backdrop-blur-md Button_ghost__BUAoh" type="button" aria-label="Copy to clipboard" data-state="closed"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 transition-all opacity-100 scale-100" aria-hidden="true"><path d="M12.5 3C13.3284 3 14 3.67157 14 4.5V6H15.5C16.3284 6 17 6.67157 17 7.5V15.5C17 16.3284 16.3284 17 15.5 17H7.5C6.67157 17 6 16.3284 6 15.5V14H4.5C3.67157 14 3 13.3284 3 12.5V4.5C3 3.67157 3.67157 3 4.5 3H12.5ZM14 12.5C14 13.3284 13.3284 14 12.5 14H7V15.5C7 15.7761 7.22386 16 7.5 16H15.5C15.7761 16 16 15.7761 16 15.5V7.5C16 7.22386 15.7761 7 15.5 7H14V12.5ZM4.5 4C4.22386 4 4 4.22386 4 4.5V12.5C4 12.7761 4.22386 13 4.5 13H12.5C12.7761 13 13 12.7761 13 12.5V4.5C13 4.22386 12.7761 4 12.5 4H4.5Z"></path></svg></div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 absolute top-0 left-0 transition-all opacity-0 scale-50" aria-hidden="true"><path d="M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"></path></svg></div></div></button></div></div><div><pre class="code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border-radius: 0.3em;"><code style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre-wrap; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none;"><span><span>RangeError: Maximum call stack size exceeded</span></span></code></pre></div></div>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Синхронная рекурсия</strong> (ограничена):</p>
<div class="relative group/copy bg-bg-000/50 border-0.5 border-border-400 rounded-lg"><div class="sticky opacity-0 group-hover/copy:opacity-100 top-2 py-2 h-12 w-0 float-right"><div class="absolute right-0 h-8 px-2 items-center inline-flex z-10"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)] h-8 w-8 rounded-md active:scale-95 backdrop-blur-md Button_ghost__BUAoh" type="button" aria-label="Copy to clipboard" data-state="closed"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 transition-all opacity-100 scale-100" aria-hidden="true"><path d="M12.5 3C13.3284 3 14 3.67157 14 4.5V6H15.5C16.3284 6 17 6.67157 17 7.5V15.5C17 16.3284 16.3284 17 15.5 17H7.5C6.67157 17 6 16.3284 6 15.5V14H4.5C3.67157 14 3 13.3284 3 12.5V4.5C3 3.67157 3.67157 3 4.5 3H12.5ZM14 12.5C14 13.3284 13.3284 14 12.5 14H7V15.5C7 15.7761 7.22386 16 7.5 16H15.5C15.7761 16 16 15.7761 16 15.5V7.5C16 7.22386 15.7761 7 15.5 7H14V12.5ZM4.5 4C4.22386 4 4 4.22386 4 4.5V12.5C4 12.7761 4.22386 13 4.5 13H12.5C12.7761 13 13 12.7761 13 12.5V4.5C13 4.22386 12.7761 4 12.5 4H4.5Z"></path></svg></div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 absolute top-0 left-0 transition-all opacity-0 scale-50" aria-hidden="true"><path d="M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"></path></svg></div></div></button></div></div><div class="text-text-500 font-small p-3.5 pb-0">javascript</div><div><pre class="code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border-radius: 0.3em;"><code class="language-javascript" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none;"><span><span class="token" style="color: rgb(198, 120, 221);">let</span><span> i </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(198, 120, 221);">function</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">syncRecursion</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>
</span></span><span><span>  i</span><span class="token" style="color: rgb(97, 175, 239);">++</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span><span>  </span><span class="token control-flow" style="color: rgb(198, 120, 221);">if</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>i </span><span class="token" style="color: rgb(97, 175, 239);">&lt;</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">50000</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(97, 175, 239);">syncRecursion</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span> </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// Все вызовы накапливаются в стеке</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(171, 178, 191);">}</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(171, 178, 191);">}</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(97, 175, 239);">syncRecursion</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span> </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// ОШИБКА на ~10,000-15,000</span></span></code></pre></div></div>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Асинхронная рекурсия</strong> (не ограничена):</p>
<div class="relative group/copy bg-bg-000/50 border-0.5 border-border-400 rounded-lg"><div class="sticky opacity-0 group-hover/copy:opacity-100 top-2 py-2 h-12 w-0 float-right"><div class="absolute right-0 h-8 px-2 items-center inline-flex z-10"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)] h-8 w-8 rounded-md active:scale-95 backdrop-blur-md Button_ghost__BUAoh" type="button" aria-label="Copy to clipboard" data-state="closed"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 transition-all opacity-100 scale-100" aria-hidden="true"><path d="M12.5 3C13.3284 3 14 3.67157 14 4.5V6H15.5C16.3284 6 17 6.67157 17 7.5V15.5C17 16.3284 16.3284 17 15.5 17H7.5C6.67157 17 6 16.3284 6 15.5V14H4.5C3.67157 14 3 13.3284 3 12.5V4.5C3 3.67157 3.67157 3 4.5 3H12.5ZM14 12.5C14 13.3284 13.3284 14 12.5 14H7V15.5C7 15.7761 7.22386 16 7.5 16H15.5C15.7761 16 16 15.7761 16 15.5V7.5C16 7.22386 15.7761 7 15.5 7H14V12.5ZM4.5 4C4.22386 4 4 4.22386 4 4.5V12.5C4 12.7761 4.22386 13 4.5 13H12.5C12.7761 13 13 12.7761 13 12.5V4.5C13 4.22386 12.7761 4 12.5 4H4.5Z"></path></svg></div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 absolute top-0 left-0 transition-all opacity-0 scale-50" aria-hidden="true"><path d="M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"></path></svg></div></div></button></div></div><div class="text-text-500 font-small p-3.5 pb-0">javascript</div><div><pre class="code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border-radius: 0.3em;"><code class="language-javascript" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none;"><span><span class="token" style="color: rgb(198, 120, 221);">let</span><span> i </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(198, 120, 221);">function</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">asyncRecursion</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>
</span></span><span><span>  i</span><span class="token" style="color: rgb(97, 175, 239);">++</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span><span>  </span><span class="token control-flow" style="color: rgb(198, 120, 221);">if</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>i </span><span class="token" style="color: rgb(97, 175, 239);">&lt;</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">50000</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(97, 175, 239);">setTimeout</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>asyncRecursion</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span> </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// Каждый вызов — новый макротаск</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(171, 178, 191);">}</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(171, 178, 191);">}</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(97, 175, 239);">asyncRecursion</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span> </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// Работает для любого количества итераций</span></span></code></pre></div></div>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">6. setTimeout(0) vs setImmediate</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">Оба метода откладывают выполнение кода, но работают по-разному:</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>setTimeout(fn, 0)</strong>:</p>
<ul class="[li_&amp;]:mb-0 [li_&amp;]:mt-1.5 [li_&amp;]:gap-1.5 [&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-disc flex flex-col gap-2 pl-8 mb-3">
<li class="whitespace-normal break-words pl-2">Минимальная задержка зависит от операционной системы (обычно 1-4 мс)</li>
<li class="whitespace-normal break-words pl-2">Обращается к таймерам ОС</li>
<li class="whitespace-normal break-words pl-2">Выполняется в фазе "timers" Event Loop</li>
<li class="whitespace-normal break-words pl-2">Работает и в браузере, и в Node.js</li>
</ul>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>setImmediate(fn)</strong> (только Node.js):</p>
<ul class="[li_&amp;]:mb-0 [li_&amp;]:mt-1.5 [li_&amp;]:gap-1.5 [&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-disc flex flex-col gap-2 pl-8 mb-3">
<li class="whitespace-normal break-words pl-2">Выполняется в специальной фазе "check" Event Loop</li>
<li class="whitespace-normal break-words pl-2">Не обращается к таймерам ОС</li>
<li class="whitespace-normal break-words pl-2">Более эффективен для Node.js</li>
<li class="whitespace-normal break-words pl-2">После завершения I/O операций выполняется раньше setTimeout</li>
</ul>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Порядок выполнения</strong>:</p>
<div class="relative group/copy bg-bg-000/50 border-0.5 border-border-400 rounded-lg"><div class="sticky opacity-0 group-hover/copy:opacity-100 top-2 py-2 h-12 w-0 float-right"><div class="absolute right-0 h-8 px-2 items-center inline-flex z-10"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)] h-8 w-8 rounded-md active:scale-95 backdrop-blur-md Button_ghost__BUAoh" type="button" aria-label="Copy to clipboard" data-state="closed"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 transition-all opacity-100 scale-100" aria-hidden="true"><path d="M12.5 3C13.3284 3 14 3.67157 14 4.5V6H15.5C16.3284 6 17 6.67157 17 7.5V15.5C17 16.3284 16.3284 17 15.5 17H7.5C6.67157 17 6 16.3284 6 15.5V14H4.5C3.67157 14 3 13.3284 3 12.5V4.5C3 3.67157 3.67157 3 4.5 3H12.5ZM14 12.5C14 13.3284 13.3284 14 12.5 14H7V15.5C7 15.7761 7.22386 16 7.5 16H15.5C15.7761 16 16 15.7761 16 15.5V7.5C16 7.22386 15.7761 7 15.5 7H14V12.5ZM4.5 4C4.22386 4 4 4.22386 4 4.5V12.5C4 12.7761 4.22386 13 4.5 13H12.5C12.7761 13 13 12.7761 13 12.5V4.5C13 4.22386 12.7761 4 12.5 4H4.5Z"></path></svg></div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 absolute top-0 left-0 transition-all opacity-0 scale-50" aria-hidden="true"><path d="M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"></path></svg></div></div></button></div></div><div class="text-text-500 font-small p-3.5 pb-0">javascript</div><div><pre class="code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border-radius: 0.3em;"><code class="language-javascript" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none;"><span><span class="token" style="color: rgb(97, 175, 239);">setTimeout</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token arrow" style="color: rgb(97, 175, 239);">=&gt;</span><span> </span><span class="token console" style="color: rgb(209, 154, 102);">console</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">log</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(152, 195, 121);">'setTimeout'</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(97, 175, 239);">setImmediate</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token arrow" style="color: rgb(97, 175, 239);">=&gt;</span><span> </span><span class="token console" style="color: rgb(209, 154, 102);">console</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">log</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(152, 195, 121);">'setImmediate'</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span>
</span><span><span></span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// В Node.js порядок может варьироваться в зависимости от контекста</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// Внутри I/O колбэка setImmediate всегда выполняется первым</span></span></code></pre></div></div>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Рекомендация</strong>: В Node.js для разбиения задач на макротаски используйте <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">setImmediate</code>, так как он быстрее и предсказуемее.</p>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">7. Worker Threads: полное руководство</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Worker Threads</code> позволяют выполнять JavaScript код в отдельных потоках, не блокируя главный Event Loop.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Основной файл (main.js)</strong>:</p>
<div class="relative group/copy bg-bg-000/50 border-0.5 border-border-400 rounded-lg"><div class="sticky opacity-0 group-hover/copy:opacity-100 top-2 py-2 h-12 w-0 float-right"><div class="absolute right-0 h-8 px-2 items-center inline-flex z-10"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)] h-8 w-8 rounded-md active:scale-95 backdrop-blur-md Button_ghost__BUAoh" type="button" aria-label="Copy to clipboard" data-state="closed"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 transition-all opacity-100 scale-100" aria-hidden="true"><path d="M12.5 3C13.3284 3 14 3.67157 14 4.5V6H15.5C16.3284 6 17 6.67157 17 7.5V15.5C17 16.3284 16.3284 17 15.5 17H7.5C6.67157 17 6 16.3284 6 15.5V14H4.5C3.67157 14 3 13.3284 3 12.5V4.5C3 3.67157 3.67157 3 4.5 3H12.5ZM14 12.5C14 13.3284 13.3284 14 12.5 14H7V15.5C7 15.7761 7.22386 16 7.5 16H15.5C15.7761 16 16 15.7761 16 15.5V7.5C16 7.22386 15.7761 7 15.5 7H14V12.5ZM4.5 4C4.22386 4 4 4.22386 4 4.5V12.5C4 12.7761 4.22386 13 4.5 13H12.5C12.7761 13 13 12.7761 13 12.5V4.5C13 4.22386 12.7761 4 12.5 4H4.5Z"></path></svg></div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 absolute top-0 left-0 transition-all opacity-0 scale-50" aria-hidden="true"><path d="M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"></path></svg></div></div></button></div></div><div class="text-text-500 font-small p-3.5 pb-0">javascript</div><div><pre class="code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border-radius: 0.3em;"><code class="language-javascript" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none;"><span><span class="token" style="color: rgb(198, 120, 221);">const</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span> </span><span class="token maybe-class-name">Worker</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">}</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">require</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(152, 195, 121);">'worker_threads'</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span>
</span><span><span></span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// Создание воркера</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(198, 120, 221);">const</span><span> worker </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">new</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">Worker</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(152, 195, 121);">'./worker.js'</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>
</span></span><span><span>  </span><span class="token literal-property" style="color: rgb(224, 108, 117);">workerData</span><span class="token" style="color: rgb(97, 175, 239);">:</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span> </span><span class="token literal-property" style="color: rgb(224, 108, 117);">value</span><span class="token" style="color: rgb(97, 175, 239);">:</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">42</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">}</span><span> </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// Передача начальных данных</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span>
</span><span><span></span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// Получение сообщений от воркера</span><span>
</span></span><span><span>worker</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">on</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(152, 195, 121);">'message'</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token parameter">result</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token arrow" style="color: rgb(97, 175, 239);">=&gt;</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>
</span></span><span><span>  </span><span class="token console" style="color: rgb(209, 154, 102);">console</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">log</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(152, 195, 121);">'Результат от воркера:'</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> result</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span>
</span><span><span></span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// Обработка ошибок</span><span>
</span></span><span><span>worker</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">on</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(152, 195, 121);">'error'</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token parameter">error</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token arrow" style="color: rgb(97, 175, 239);">=&gt;</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>
</span></span><span><span>  </span><span class="token console" style="color: rgb(209, 154, 102);">console</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">error</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(152, 195, 121);">'Ошибка в воркере:'</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> error</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span>
</span><span><span></span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// Завершение работы воркера</span><span>
</span></span><span><span>worker</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">on</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(152, 195, 121);">'exit'</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token parameter">code</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token arrow" style="color: rgb(97, 175, 239);">=&gt;</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>
</span></span><span><span>  </span><span class="token console" style="color: rgb(209, 154, 102);">console</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">log</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token template-string template-punctuation" style="color: rgb(152, 195, 121);">`</span><span class="token template-string" style="color: rgb(152, 195, 121);">Воркер завершился с кодом </span><span class="token template-string interpolation" style="color: rgb(171, 178, 191);">${</span><span class="token template-string interpolation">code</span><span class="token template-string interpolation" style="color: rgb(171, 178, 191);">}</span><span class="token template-string template-punctuation" style="color: rgb(152, 195, 121);">`</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span>
</span><span><span></span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// Отправка сообщений воркеру</span><span>
</span></span><span><span>worker</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">postMessage</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">{</span><span> </span><span class="token literal-property" style="color: rgb(224, 108, 117);">command</span><span class="token" style="color: rgb(97, 175, 239);">:</span><span> </span><span class="token" style="color: rgb(152, 195, 121);">'calculate'</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token literal-property" style="color: rgb(224, 108, 117);">data</span><span class="token" style="color: rgb(97, 175, 239);">:</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">[</span><span class="token" style="color: rgb(209, 154, 102);">1</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">2</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">3</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span></span></code></pre></div></div>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Файл воркера (worker.js)</strong>:</p>
<div class="relative group/copy bg-bg-000/50 border-0.5 border-border-400 rounded-lg"><div class="sticky opacity-0 group-hover/copy:opacity-100 top-2 py-2 h-12 w-0 float-right"><div class="absolute right-0 h-8 px-2 items-center inline-flex z-10"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)] h-8 w-8 rounded-md active:scale-95 backdrop-blur-md Button_ghost__BUAoh" type="button" aria-label="Copy to clipboard" data-state="closed"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 transition-all opacity-100 scale-100" aria-hidden="true"><path d="M12.5 3C13.3284 3 14 3.67157 14 4.5V6H15.5C16.3284 6 17 6.67157 17 7.5V15.5C17 16.3284 16.3284 17 15.5 17H7.5C6.67157 17 6 16.3284 6 15.5V14H4.5C3.67157 14 3 13.3284 3 12.5V4.5C3 3.67157 3.67157 3 4.5 3H12.5ZM14 12.5C14 13.3284 13.3284 14 12.5 14H7V15.5C7 15.7761 7.22386 16 7.5 16H15.5C15.7761 16 16 15.7761 16 15.5V7.5C16 7.22386 15.7761 7 15.5 7H14V12.5ZM4.5 4C4.22386 4 4 4.22386 4 4.5V12.5C4 12.7761 4.22386 13 4.5 13H12.5C12.7761 13 13 12.7761 13 12.5V4.5C13 4.22386 12.7761 4 12.5 4H4.5Z"></path></svg></div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 absolute top-0 left-0 transition-all opacity-0 scale-50" aria-hidden="true"><path d="M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"></path></svg></div></div></button></div></div><div class="text-text-500 font-small p-3.5 pb-0">javascript</div><div><pre class="code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border-radius: 0.3em;"><code class="language-javascript" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none;"><span><span class="token" style="color: rgb(198, 120, 221);">const</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span> parentPort</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> workerData </span><span class="token" style="color: rgb(171, 178, 191);">}</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">require</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(152, 195, 121);">'worker_threads'</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span>
</span><span><span></span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// Получение начальных данных</span><span>
</span></span><span><span></span><span class="token console" style="color: rgb(209, 154, 102);">console</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">log</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(152, 195, 121);">'Начальные данные:'</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> workerData</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span> </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// { value: 42 }</span><span>
</span></span><span>
</span><span><span></span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// Получение сообщений от главного потока</span><span>
</span></span><span><span>parentPort</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">on</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(152, 195, 121);">'message'</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token parameter">message</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token arrow" style="color: rgb(97, 175, 239);">=&gt;</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>
</span></span><span><span>  </span><span class="token control-flow" style="color: rgb(198, 120, 221);">if</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>message</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token property-access">command</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">===</span><span> </span><span class="token" style="color: rgb(152, 195, 121);">'calculate'</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// Выполняем тяжёлые вычисления</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(198, 120, 221);">let</span><span> result </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span><span>    </span><span class="token control-flow" style="color: rgb(198, 120, 221);">for</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(198, 120, 221);">let</span><span> i </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span> i </span><span class="token" style="color: rgb(97, 175, 239);">&lt;</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">1000000</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span> i</span><span class="token" style="color: rgb(97, 175, 239);">++</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>
</span></span><span><span>      result </span><span class="token" style="color: rgb(97, 175, 239);">+=</span><span> i</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(171, 178, 191);">}</span><span>
</span></span><span>    
</span><span><span>    </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// Отправляем результат обратно</span><span>
</span></span><span><span>    parentPort</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">postMessage</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>result</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(171, 178, 191);">}</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span></span></code></pre></div></div>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Изоляция воркера</strong>:
Worker работает в изолированной среде:</p>
<ul class="[li_&amp;]:mb-0 [li_&amp;]:mt-1.5 [li_&amp;]:gap-1.5 [&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-disc flex flex-col gap-2 pl-8 mb-3">
<li class="whitespace-normal break-words pl-2">Нет доступа к переменным главного потока</li>
<li class="whitespace-normal break-words pl-2">Нет <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">global</code> объекта главного потока</li>
<li class="whitespace-normal break-words pl-2">Есть свой собственный <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">require()</code> для загрузки модулей</li>
<li class="whitespace-normal break-words pl-2">Коммуникация только через сообщения (message passing)</li>
</ul>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">8. Оптимальная разбивка задач на макротаски</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">Не нужно разбивать задачу на слишком мелкие части — это замедляет выполнение. Оптимальный подход:</p>
<div class="relative group/copy bg-bg-000/50 border-0.5 border-border-400 rounded-lg"><div class="sticky opacity-0 group-hover/copy:opacity-100 top-2 py-2 h-12 w-0 float-right"><div class="absolute right-0 h-8 px-2 items-center inline-flex z-10"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)] h-8 w-8 rounded-md active:scale-95 backdrop-blur-md Button_ghost__BUAoh" type="button" aria-label="Copy to clipboard" data-state="closed"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 transition-all opacity-100 scale-100" aria-hidden="true"><path d="M12.5 3C13.3284 3 14 3.67157 14 4.5V6H15.5C16.3284 6 17 6.67157 17 7.5V15.5C17 16.3284 16.3284 17 15.5 17H7.5C6.67157 17 6 16.3284 6 15.5V14H4.5C3.67157 14 3 13.3284 3 12.5V4.5C3 3.67157 3.67157 3 4.5 3H12.5ZM14 12.5C14 13.3284 13.3284 14 12.5 14H7V15.5C7 15.7761 7.22386 16 7.5 16H15.5C15.7761 16 16 15.7761 16 15.5V7.5C16 7.22386 15.7761 7 15.5 7H14V12.5ZM4.5 4C4.22386 4 4 4.22386 4 4.5V12.5C4 12.7761 4.22386 13 4.5 13H12.5C12.7761 13 13 12.7761 13 12.5V4.5C13 4.22386 12.7761 4 12.5 4H4.5Z"></path></svg></div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 absolute top-0 left-0 transition-all opacity-0 scale-50" aria-hidden="true"><path d="M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"></path></svg></div></div></button></div></div><div class="text-text-500 font-small p-3.5 pb-0">javascript</div><div><pre class="code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border-radius: 0.3em;"><code class="language-javascript" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none;"><span><span class="token" style="color: rgb(198, 120, 221);">let</span><span> i </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(198, 120, 221);">const</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">BATCH_SIZE</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">1000</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span> </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// Обрабатываем по 1000 итераций за раз</span><span>
</span></span><span>
</span><span><span></span><span class="token" style="color: rgb(198, 120, 221);">function</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">processInBatches</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">const</span><span> endIndex </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token known-class-name" style="color: rgb(209, 154, 102);">Math</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">min</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>i </span><span class="token" style="color: rgb(97, 175, 239);">+</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">BATCH_SIZE</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">40000</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// Обрабатываем пакет итераций</span><span>
</span></span><span><span>  </span><span class="token control-flow" style="color: rgb(198, 120, 221);">for</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span> i </span><span class="token" style="color: rgb(97, 175, 239);">&lt;</span><span> endIndex</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span> i</span><span class="token" style="color: rgb(97, 175, 239);">++</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// Ваши вычисления</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(97, 175, 239);">heavyCalculation</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>i</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(171, 178, 191);">}</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token control-flow" style="color: rgb(198, 120, 221);">if</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>i </span><span class="token" style="color: rgb(97, 175, 239);">&lt;</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">40000</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// Откладываем следующий пакет</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(97, 175, 239);">setImmediate</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>processInBatches</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(171, 178, 191);">}</span><span> </span><span class="token control-flow" style="color: rgb(198, 120, 221);">else</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// Завершение</span><span>
</span></span><span><span>    </span><span class="token console" style="color: rgb(209, 154, 102);">console</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">log</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(152, 195, 121);">'Готово!'</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(171, 178, 191);">}</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(171, 178, 191);">}</span><span>
</span></span><span>
</span><span><span></span><span class="token" style="color: rgb(97, 175, 239);">processInBatches</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span></span></code></pre></div></div>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Как определить размер пакета?</strong></p>
<ul class="[li_&amp;]:mb-0 [li_&amp;]:mt-1.5 [li_&amp;]:gap-1.5 [&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-disc flex flex-col gap-2 pl-8 mb-3">
<li class="whitespace-normal break-words pl-2">Измерьте время выполнения одной итерации</li>
<li class="whitespace-normal break-words pl-2">Стремитесь к ~10-50 мс на пакет</li>
<li class="whitespace-normal break-words pl-2">Это позволит Event Loop обрабатывать другие задачи между пакетами</li>
</ul>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">9. Лучшие практики для избежания блокировки</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>✅ Делайте:</strong></p>
<ol class="[li_&amp;]:mb-0 [li_&amp;]:mt-1.5 [li_&amp;]:gap-1.5 [&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-decimal flex flex-col gap-2 pl-8 mb-3">
<li class="whitespace-normal break-words pl-2">Используйте асинхронные версии функций (fs.readFile, а не fs.readFileSync)</li>
<li class="whitespace-normal break-words pl-2">Разбивайте тяжёлые вычисления на пакеты с setImmediate</li>
<li class="whitespace-normal break-words pl-2">Выносите CPU-интенсивные задачи в worker threads</li>
<li class="whitespace-normal break-words pl-2">Используйте стримы для обработки больших файлов</li>
<li class="whitespace-normal break-words pl-2">Применяйте базы данных с асинхронными драйверами</li>
</ol>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>❌ Избегайте:</strong></p>
<ol class="[li_&amp;]:mb-0 [li_&amp;]:mt-1.5 [li_&amp;]:gap-1.5 [&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-decimal flex flex-col gap-2 pl-8 mb-3">
<li class="whitespace-normal break-words pl-2">Синхронных операций в production коде</li>
<li class="whitespace-normal break-words pl-2">Тяжёлых вычислений в главном потоке</li>
<li class="whitespace-normal break-words pl-2">Бесконечных циклов без разбиения</li>
<li class="whitespace-normal break-words pl-2">Глубокой синхронной рекурсии (&gt;1000 уровней)</li>
<li class="whitespace-normal break-words pl-2">Блокирующих операций в обработчиках запросов</li>
</ol>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">10. Когда использовать Worker Threads vs микросервисы</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Worker Threads подходят для</strong>:</p>
<ul class="[li_&amp;]:mb-0 [li_&amp;]:mt-1.5 [li_&amp;]:gap-1.5 [&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-disc flex flex-col gap-2 pl-8 mb-3">
<li class="whitespace-normal break-words pl-2">CPU-интенсивных задач (шифрование, сжатие, парсинг больших файлов)</li>
<li class="whitespace-normal break-words pl-2">Задач, которые требуют быстрой коммуникации с главным процессом</li>
<li class="whitespace-normal break-words pl-2">Когда нужно сохранить один кодовую базу</li>
</ul>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Микросервисы подходят для</strong>:</p>
<ul class="[li_&amp;]:mb-0 [li_&amp;]:mt-1.5 [li_&amp;]:gap-1.5 [&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-disc flex flex-col gap-2 pl-8 mb-3">
<li class="whitespace-normal break-words pl-2">Логически независимых компонентов системы</li>
<li class="whitespace-normal break-words pl-2">Масштабирования отдельных частей приложения</li>
<li class="whitespace-normal break-words pl-2">Использования разных технологий для разных задач</li>
<li class="whitespace-normal break-words pl-2">Независимого развёртывания компонентов</li>
</ul>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Комбинированный подход</strong>:
Можно использовать worker threads внутри микросервиса для обработки тяжёлых задач, получив преимущества обоих подходов.</p>
<hr class="border-border-200 border-t-0.5 my-3 mx-1.5">
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><em>Конец лекции. Практическая реализация worker threads будет продолжена в следующей части.</em></p></div></div><div><div class="standard-markdown grid-cols-1 grid gap-4 [&amp;_&gt;_*]:min-w-0 !gap-3.5"><h1 class="text-text-100 mt-3 -mb-1 text-[1.375rem] font-bold">Лекция по изучению Node.js. Урок 1 (продолжение)</h1>
<h2 class="text-text-100 mt-3 -mb-1 text-[1.125rem] font-bold">Отредактированный транскрипт</h2>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:37:24 --- Но <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Worker</code>'у просто запрещено манипулировать DOM, он не видит контекста страницы в чистом JavaScript, не видит контекста всего этого в Node. То есть он должен выполнять <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">тяжелую операцию</code>. Мы из основного потока с воркером общаемся с помощью отправки команды и подписки на сообщение. Чтобы подписаться на сообщение, мы можем использовать стандартный <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">событийный механизм</code>.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:37:50 --- Да, функция <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">on</code>, она, ну, стандартное название, как бы, много где это можно увидеть: в старом Vue <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">$on</code>, в jQuery <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">.on</code>, в веб-сокетах <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">socket.io.on</code> — ну, это просто стандартная подписка на события. Вот, допустим, на <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">message</code> подписываемся. В реальности надо подписаться еще и на <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">error</code>.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:38:17 --- Подписаться сразу <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">worker.on('error')</code> и <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">error</code> тоже как-то обработать. Например, записать <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">response.end()</code> и обработку ошибки в <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">calc process</code>, и результат мы тогда не меняем. А <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">onMessage</code> здесь на самом деле можно создавать систему с именованными сообщениями.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:38:49 --- То есть у <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">message</code> есть какое-то имя запросто. Но, как правило, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">message</code> — это просто, по-нативному, информация о том, что из воркера нам идет какая-то инфа. То есть если мы хотим сделать разные события с разными названиями от воркера, то мы должны просто принимать объект, допустим, с ключами <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">name</code> и <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">value</code>. И делать <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">switch</code> по <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">name</code> и понимать, какое событие мы обрабатываем.</p>
<img :src="screenshot_5974" alt="Image" >
<img :src="screenshot_5982" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:39:17 --- Но я сделаю просто функцию, которая <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">value</code> принимает, и допустим напишу здесь <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">console.log(value)</code>. <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">response.end()</code> пусть тоже будет. При такой реализации данный запрос наверно не завершится никогда. Потому что <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">worker</code> не отправляет нам никаких сообщений. Да, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">worker</code> просто работает. При этом админу мы, на самом деле не дожидаясь завершения работы <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">worker</code>, можем написать что-нибудь.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:39:48 --- То есть <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">worker.on('error')</code> тут нет смысла так писать, тут наверное надо делать что-то в духе <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">log someInfoAboutError</code>, файл куда-то, ошибку записать. Вот, а здесь мы админу пишем там, допустим, "your task is long and will be processed in background mode" — в <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">фоновом режиме</code>.</p>
<img :src="screenshot_6035" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:40:23 --- Вот. Как-то так. Ну вот. Ну как обычно, да, вы загружаете большой файл на парсинг, вам выводят то, что ваш файл там принят на обработку, ждите, для вас это в фоновом режиме будет обработано.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:40:43 --- А здесь мы типа хотим, ну, может быть, как-то изменить итоговый результат. Я пока просто напишу здесь <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">console.log('worker is done')</code>, да, что задача, которую мы <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">worker</code> поставили, она как бы завершилась. И даже напишу, с каким <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">value</code> она разрешилась, эта задача. Вот. Админ запускает анализ большого файла. Ему пишут, что ваша задача длинная, обрабатываем в фоне.</p>
<img :src="screenshot_6069" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:41:07 --- Сам <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">worker</code> может содержать абсолютно любой код. Ну, например, я сейчас напишу здесь расчет длинной задачи примитивным образом. Эх, удалил я код этого цикла, но ничего страшного. Вроде написать это несложно. Так, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">res</code> написан, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">j</code> написан, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">i</code> сейчас тоже будет написан, и <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">i</code> на <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">j</code> делим прямиком, скобочки не забываем.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:41:49 --- И где-то здесь мы пишем — сейчас я подсмотрю в доках как — мы пишем, значит, точно так же <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">import { parentPort } from 'worker_threads'</code>, и отправляем родителю сообщение.</p>
<img :src="screenshot_6149" alt="Image" >
<img :src="screenshot_6163" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:42:13 --- <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">parentPort.postMessage()</code>, например, результат, то есть полностью синхронный код выполнится и сработает <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">postMessage</code>. Вот смотрите, зашёл на <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">/admin/calc</code>, но будет рассчитан результат или нет, пока неизвестно. Просто ждем. Оказывается, что рассчитан. Да, как ни странно. И, значит, получается, что мы можем вот в этой точке просто сделать то, что нам нужно.</p>
<img :src="screenshot_6183" alt="Image" >
<img :src="screenshot_6191" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:42:50 --- То есть, например, написать, что <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">longOperationResult = value</code>. То, что этот товарищ завершил свою работу. И это вынесено на <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">отдельное ядро</code>. То есть вот человек заходит на главную страницу, спокойно открывает ее. Вот админ запускает расчет долгий, и клиенты видят результат "not ready".</p>
<img :src="screenshot_6207" alt="Image" >
<img :src="screenshot_6229" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:43:15 --- Никто им эти операции не блокирует. Но когда <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">worker</code> на отдельном ядре произведет свои тяжелые расчеты, у клиентов инфа появилась. Просьба плюсами подтвердить, если понятно, как технически можно <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">распараллелить задачи на другие ядра</code>. Это не так удобно, на самом деле, порой оказывается, потому что здесь нет системы <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">именованных сообщений</code>, нет <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">промиссификации</code> всего этого процесса. То есть, если ты хочешь подписать <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">worker</code> на сообщения, которые запускают в нем тяжелую работу, тебе будет сложно отловить, от какого сообщения тебе <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">value</code> пришло.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:43:52 --- И можно пытаться делать так, что, ну можно короче <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">промиссифицировать</code> эту штуку. Я для чистого JavaScript когда-то такую вещь делал, промиссификацию веб-воркера. Вот. Как бы получается достаточно забавно. То есть нужно какую-то систему с <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">ID</code> придумать для задач, отправленных воркеру.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:44:16 --- Но вот в таком простом виде вроде все спокойно выглядит. Но если кончатся ядра, то что делать? Ждем, когда ядро освободится. Тут уж ничего не поделаешь. Чтобы ядра не кончались, нужно как бы использовать <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">очередь задач</code>.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:44:43 --- Да, то есть, например, взять, если тот же самый PHP на Laravel, там в PHP вообще нет нормального механизма что-то отправить на другое ядро, на вычисление. И обычно, если админ загружает какой-то длинный Excel-овский файл на анализ, а особенно если это может делать не админ, а если есть клиенты со своим личным кабинетом, куда они могут длинный файл большой загрузить на анализ.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:45:12 --- Ну не знаю, сейчас придумаем какую-нибудь идею проекта. Что-то из древности, вспоминается какой-нибудь market stats для трейдеров, куда они отчеты от брокеров грузят, им в свечках показывают, как депозит уменьшается. У девяносто восьми процентов из них. Значит, то тогда, как бы получается, у нас есть риск, что много людей одновременно могут отчеты загрузить. Условно там в 7 вечера.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:45:39 --- Да, все сразу бегут грузить, грузить. И если сразу файл в момент загрузки отправлять на ядро парситься, то действительно ядра могут и закончиться. Вот, и это проблема. И поэтому в принципе на бэкенде принято как бы тяжелые задачи в <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">отсроченное выполнение</code> ставить. Да, вот возвращаемся к тому, что про Laravel начинал говорить. Там есть отдельный <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">модуль очередей</code>.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:46:06 --- Можно в Laravel, например, написать — в PHP вообще нет возможности на другое ядро что-то отправить спокойным образом, простым. И поэтому там просто есть возможность зарегистрировать на выполнение какую-то задачу. Инфу об этой задаче система кладет в базу. И где-то в памяти висит еще отдельный скрипт, который просто <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">отложенные задачи</code> запускает, допустим, каждые несколько секунд. Берет их из базы: новую задачку взял, запустил, взял, запустил.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:46:34 --- И получается, он просто все эти задачи, в список добавленные, на одно ядро посылает и выполняет так, чтобы они еще и друг друга не сломали. То есть если в прайм-тайм клиенты загрузят нам там 500 Excel-ок одновременно, ну просто будет клиент дольше ждать обработку своего файла тогда. А не то, что мы на каждое ядро это все отправим. Ну, а так нагрузку на сервер, конечно, нужно руками менеджерить.</p>
<img :src="screenshot_6444" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:46:59 --- По-моему, модуль <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">PM2</code> позволяет как-то в этом помочь в автоматизации этого процесса. Да, что он всегда смотрит на загруз оперативки, там есть запуск <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">pm2 monitor</code>, например, команды, можно подписаться на контроль количества оперативки, на перезагрузку CPU, так что, конечно, если сайт нагружен, это мониторится. Если нет отдельного ядра, всего одно ядро, это все равно же будет работать, только не так эффективно.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:47:31 --- Ну, по сути, да, но попробуйте сейчас найти одноядерный сервер. Это надо постараться. Мне кажется, сейчас даже на самых дешевых тарифах все равно сервера два ядра-то дают. Хоть на виртуалках, хоть на выделенных. Но это не точно. Значит, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Message Channel</code> решает проблему с ID в промиссификации официальных воркеров.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:47:52 --- Да, пожалуй. То есть тут можно очень разные системы придумывать. Опять же пока <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">worker</code> как бы атомарный, когда он выполняет одну задачу, у нас нет никакой нужды даже что-то пытаться промиссифицировать. Если <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">worker</code> имеет несколько команд, то что мы можем отправить <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">sendMessage</code> такую-то задачу выполнить, другую задачу выполнить, то тогда нужно что-то придумывать.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:48:20 --- Значит вопрос, в воркере запускают задачу на отдельном ядре или в отдельном потоке. Но смотрите, если у нас что-то запускается в <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">отдельном потоке</code> и есть <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">свободное ядро</code>, то оно по идее эту задачу берет. Потому что потоки по ядрам параллелятся. И соответственно расчет этот запускается на отдельном ядре. Как это доказать, что на отдельном ядре запускается?</p>
<img :src="screenshot_6532" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:48:49 --- Сейчас попробую древний комп расшевелить на тему производительности CPU. Процессы, сейчас где это можно посмотреть... Журнал, подробности. Раньше вот в Windows был интерфейс, где он зеленые такие прямоугольники рисовал, как каждое из ядер загружено. Монитор... Сейчас, да, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Монитор ресурсов</code>.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:49:19 --- Монитор ресурсов. Производительность, монитор ресурсов. Да, наверное, вот это. Но я не знаю, получится у нас это визуализировать или не получится, на самом деле. Да, это вопрос такой, потому что важно понимать, что ядра заняты гораздо более приоритетными вещами.</p>
<img :src="screenshot_6584" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:49:42 --- И ядер, во-первых, их четыре по два <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">логических</code> в каждом, комп древний, вот этот, из которого урок веду. То есть под ним стоит 32 ядра, 64 логических, Ryzen Threadripper 3, TR3-970. А этот товарищ с 2014 года на четырех ядрах пашет и прекрасно себя чувствует. И на него сейчас сильно влияет Camtasia и все остальное, поэтому я не думаю, что мы здесь увидим скачок в CPU.</p>
<img :src="screenshot_6635" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:50:15 --- И то это не то, что я хотел показать. Вот, вот он, 8 логических ядер. Получится как-то увидеть здесь реальную картину. Не факт. Мелкий. Средний поместится, не поместится. Ну, вроде с натяжкой помещается. Они так все загружены, да?</p>
<img :src="screenshot_6648" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:50:36 --- С нулевого по какой-то. Но я вот сейчас попробую с нескольких страниц зайти. Если я в Chrome открою несколько одинаковых вкладок, то, кстати, это не приведет ни к чему, потому что Chrome, видимо, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">защищает от перегрузки сервера</code> и я если вот так нажму и вот так нажму, они станут в <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">очередь запросов</code>. Поэтому сейчас из разных браузеров попробую запустить расчеты. Значит <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">/admin/calc</code> отсюда, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">/admin/calc</code> отсюда, вот.</p>
<img :src="screenshot_6664" alt="Image" >
<img :src="screenshot_6687" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:51:02 --- Но мы на этой схеме ничего не видим. Да, какие-то две линии вверх пошли, но это может быть просто погрешность. Непонятно. Да, непонятно на самом деле. Да, вот какая-то линия вниз, ну типа результат мог быть рассчитан. А мог быть и не рассчитан. Кто его знает. Поэтому тут более честным. Да, но два Node процесса можно поискать. Но смотрите, есть еще одна попытка как бы показать это по-простому.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:51:32 --- Я могу поставить <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">console.log(value)</code>. Если вычисления будут идти на одном ядре, они будут <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">мешать друг другу</code>, правильно? И скорее всего они завершатся либо за время в три раза дольше, чем обычно, если три вычисления запустим. Либо они будут завершаться как первое, потом второе, потом третье с некоторыми интервалами. Если он их <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">распараллелит по ядрам</code>, то они завершатся плюс-минус за привычное нам время и завершатся три плюс-минус одновременно.</p>
<img :src="screenshot_6733" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:52:02 --- Вот, давайте исходить из этого. Попробуем. Запускаю два расчета. Но я их, правда, к сожалению, не совсем одновременно запустил. Да, интервал где-то пара секунд между ними. Но если они друг другу мешают, то разница между ними будет больше. А видите, между ними разница пара секунд. То есть по всем признакам оно на <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">разных ядрах</code> работает. Потому что они считались по 8-9 секунд, и друг друга не затормозили.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:52:32 --- Можем попробовать, не знаю, еще какой-нибудь браузер открыть. Он, правда, может сломать компьютер, этот браузер, как всегда. Вот этот.</p>
<img :src="screenshot_6767" alt="Image" >
<img :src="screenshot_6774" alt="Image" >
<img :src="screenshot_6788" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:52:45 --- Ну ладно, где наш Chrome... Так, и консоль. То есть 3 вычисления параллельных, обычно у нас там сколько — 7-8 секунд рассчитывается, или 5? Вот видите, с разницей в секунду, как я запросы в браузере делал, они все рассчитали. Вот насчет процессов, ну да, это надо искать, да, в списке процессов в диспетчере задач, что удастся где найти, но это не так просто, эти процессы они могут являться <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">дочерними</code> для VS Code, во-первых, раз мы из VS-кодовской консоли запускаем, и детализацию получить не так просто.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:53:28 --- Вот Node JavaScript Runtime, как бы что-то запущено, погодите, приостановим. Так, Node JavaScript Runtime 1 остался, Node сервер 4, ну видите, он их сразу просто 4 открыл, будут ли новые появляться, не знаю.</p>
<img :src="screenshot_6834" alt="Image" >
<img :src="screenshot_6845" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:53:52 --- Node он просто вроде как напрягся, да, что-то. Вот еще что-то напряжем, еще что-то напряжем. Так вычислить сложно все-таки. Но это процессы, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">процессы состоят из потоков</code>. То есть нам бы <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">потоки</code> вот этого товарища посмотреть. А это уже другая история.</p>
<hr class="border-border-200 border-t-0.5 my-3 mx-1.5">
<h2 class="text-text-100 mt-3 -mb-1 text-[1.125rem] font-bold">Дополнительные пояснения</h2>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">Что такое Worker Threads?</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Worker Threads</code> — это модуль Node.js, который позволяет создавать отдельные потоки выполнения для задач, требующих больших вычислительных ресурсов. Представьте, что ваш сервер — это кухня ресторана. Обычно один повар (основной поток) готовит все блюда по очереди. Но если заказали очень сложное блюдо, которое готовится час, все остальные гости будут ждать! Worker Threads — это как нанять дополнительного повара специально для сложных блюд, чтобы основной повар мог продолжать обслуживать других гостей.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">В Node.js основной поток обрабатывает все запросы. Если запустить тяжелую операцию (например, обработку огромного файла) в основном потоке, сервер "зависнет" и не сможет отвечать другим пользователям. Worker Threads решают эту проблему, перенося тяжелые задачи на отдельные потоки.</p>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">Как работает общение между потоками?</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">Основной поток и Worker общаются через систему сообщений, похожую на отправку писем. Вы не можете напрямую трогать переменные Worker'а или передавать ему функции — только отправлять данные (числа, строки, объекты).</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>parentPort</strong> — это специальный объект внутри Worker'а, который служит "почтовым ящиком" для отправки сообщений обратно главному потоку. Когда Worker завершает работу, он вызывает <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">parentPort.postMessage(результат)</code>, и это сообщение приходит в основной поток.</p>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">Паттерн EventEmitter</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">Метод <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">.on()</code> — это часть паттерна EventEmitter в Node.js. Это как подписка на уведомления: вы говорите "когда произойдет событие X, вызови эту функцию". Примеры:</p>
<ul class="[li_&amp;]:mb-0 [li_&amp;]:mt-1.5 [li_&amp;]:gap-1.5 [&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-disc flex flex-col gap-2 pl-8 mb-3">
<li class="whitespace-normal break-words pl-2"><code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">worker.on('message', callback)</code> — "когда Worker отправит сообщение, вызови мою функцию"</li>
<li class="whitespace-normal break-words pl-2"><code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">worker.on('error', callback)</code> — "если что-то пойдет не так, дай мне знать"</li>
</ul>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">Этот паттерн используется везде: в jQuery (<code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">.on('click')</code>), в Socket.io (для веб-сокетов), в старом Vue.js (<code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">$on</code>) и многих других библиотеках.</p>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">Система именованных сообщений</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">Когда Worker отправляет много разных типов сообщений, нужно их различать. Простой способ — отправлять объекты с полями <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">name</code> (тип события) и <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">value</code> (данные):</p>
<div class="relative group/copy bg-bg-000/50 border-0.5 border-border-400 rounded-lg"><div class="sticky opacity-0 group-hover/copy:opacity-100 top-2 py-2 h-12 w-0 float-right"><div class="absolute right-0 h-8 px-2 items-center inline-flex z-10"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)] h-8 w-8 rounded-md active:scale-95 backdrop-blur-md Button_ghost__BUAoh" type="button" aria-label="Copy to clipboard" data-state="closed"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 transition-all opacity-100 scale-100" aria-hidden="true"><path d="M12.5 3C13.3284 3 14 3.67157 14 4.5V6H15.5C16.3284 6 17 6.67157 17 7.5V15.5C17 16.3284 16.3284 17 15.5 17H7.5C6.67157 17 6 16.3284 6 15.5V14H4.5C3.67157 14 3 13.3284 3 12.5V4.5C3 3.67157 3.67157 3 4.5 3H12.5ZM14 12.5C14 13.3284 13.3284 14 12.5 14H7V15.5C7 15.7761 7.22386 16 7.5 16H15.5C15.7761 16 16 15.7761 16 15.5V7.5C16 7.22386 15.7761 7 15.5 7H14V12.5ZM4.5 4C4.22386 4 4 4.22386 4 4.5V12.5C4 12.7761 4.22386 13 4.5 13H12.5C12.7761 13 13 12.7761 13 12.5V4.5C13 4.22386 12.7761 4 12.5 4H4.5Z"></path></svg></div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 absolute top-0 left-0 transition-all opacity-0 scale-50" aria-hidden="true"><path d="M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"></path></svg></div></div></button></div></div><div class="text-text-500 font-small p-3.5 pb-0">javascript</div><div><pre class="code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border-radius: 0.3em;"><code class="language-javascript" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none;"><span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// В Worker:</span><span>
</span></span><span><span>parentPort</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">postMessage</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">{</span><span> </span><span class="token literal-property" style="color: rgb(224, 108, 117);">name</span><span class="token" style="color: rgb(97, 175, 239);">:</span><span> </span><span class="token" style="color: rgb(152, 195, 121);">'progress'</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token literal-property" style="color: rgb(224, 108, 117);">value</span><span class="token" style="color: rgb(97, 175, 239);">:</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">50</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span><span>parentPort</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">postMessage</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">{</span><span> </span><span class="token literal-property" style="color: rgb(224, 108, 117);">name</span><span class="token" style="color: rgb(97, 175, 239);">:</span><span> </span><span class="token" style="color: rgb(152, 195, 121);">'complete'</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token literal-property" style="color: rgb(224, 108, 117);">value</span><span class="token" style="color: rgb(97, 175, 239);">:</span><span> результат </span><span class="token" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span>
</span><span><span></span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">// В основном потоке:</span><span>
</span></span><span><span>worker</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">on</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(152, 195, 121);">'message'</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token parameter">msg</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token arrow" style="color: rgb(97, 175, 239);">=&gt;</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>
</span></span><span><span>  </span><span class="token control-flow" style="color: rgb(198, 120, 221);">switch</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>msg</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token property-access">name</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(198, 120, 221);">case</span><span> </span><span class="token" style="color: rgb(152, 195, 121);">'progress'</span><span class="token" style="color: rgb(97, 175, 239);">:</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">updateProgressBar</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>msg</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token property-access">value</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span> </span><span class="token control-flow" style="color: rgb(198, 120, 221);">break</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(198, 120, 221);">case</span><span> </span><span class="token" style="color: rgb(152, 195, 121);">'complete'</span><span class="token" style="color: rgb(97, 175, 239);">:</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">showResult</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>msg</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token property-access">value</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span> </span><span class="token control-flow" style="color: rgb(198, 120, 221);">break</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(171, 178, 191);">}</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span></span></code></pre></div></div>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">Что такое промиссификация?</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Промиссификация</code> — это превращение callback-функций в промисы, чтобы можно было использовать современный синтаксис <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">async/await</code>. Worker Threads изначально работают с событиями (callbacks), что неудобно. Промиссификация позволяет писать так:</p>
<div class="relative group/copy bg-bg-000/50 border-0.5 border-border-400 rounded-lg"><div class="sticky opacity-0 group-hover/copy:opacity-100 top-2 py-2 h-12 w-0 float-right"><div class="absolute right-0 h-8 px-2 items-center inline-flex z-10"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)] h-8 w-8 rounded-md active:scale-95 backdrop-blur-md Button_ghost__BUAoh" type="button" aria-label="Copy to clipboard" data-state="closed"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 transition-all opacity-100 scale-100" aria-hidden="true"><path d="M12.5 3C13.3284 3 14 3.67157 14 4.5V6H15.5C16.3284 6 17 6.67157 17 7.5V15.5C17 16.3284 16.3284 17 15.5 17H7.5C6.67157 17 6 16.3284 6 15.5V14H4.5C3.67157 14 3 13.3284 3 12.5V4.5C3 3.67157 3.67157 3 4.5 3H12.5ZM14 12.5C14 13.3284 13.3284 14 12.5 14H7V15.5C7 15.7761 7.22386 16 7.5 16H15.5C15.7761 16 16 15.7761 16 15.5V7.5C16 7.22386 15.7761 7 15.5 7H14V12.5ZM4.5 4C4.22386 4 4 4.22386 4 4.5V12.5C4 12.7761 4.22386 13 4.5 13H12.5C12.7761 13 13 12.7761 13 12.5V4.5C13 4.22386 12.7761 4 12.5 4H4.5Z"></path></svg></div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 absolute top-0 left-0 transition-all opacity-0 scale-50" aria-hidden="true"><path d="M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"></path></svg></div></div></button></div></div><div class="text-text-500 font-small p-3.5 pb-0">javascript</div><div><pre class="code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border-radius: 0.3em;"><code class="language-javascript" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none;"><span><span class="token" style="color: rgb(198, 120, 221);">const</span><span> result </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token control-flow" style="color: rgb(198, 120, 221);">await</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">runWorkerTask</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>data</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span></span></code></pre></div></div>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">вместо:</p>
<div class="relative group/copy bg-bg-000/50 border-0.5 border-border-400 rounded-lg"><div class="sticky opacity-0 group-hover/copy:opacity-100 top-2 py-2 h-12 w-0 float-right"><div class="absolute right-0 h-8 px-2 items-center inline-flex z-10"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)] h-8 w-8 rounded-md active:scale-95 backdrop-blur-md Button_ghost__BUAoh" type="button" aria-label="Copy to clipboard" data-state="closed"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 transition-all opacity-100 scale-100" aria-hidden="true"><path d="M12.5 3C13.3284 3 14 3.67157 14 4.5V6H15.5C16.3284 6 17 6.67157 17 7.5V15.5C17 16.3284 16.3284 17 15.5 17H7.5C6.67157 17 6 16.3284 6 15.5V14H4.5C3.67157 14 3 13.3284 3 12.5V4.5C3 3.67157 3.67157 3 4.5 3H12.5ZM14 12.5C14 13.3284 13.3284 14 12.5 14H7V15.5C7 15.7761 7.22386 16 7.5 16H15.5C15.7761 16 16 15.7761 16 15.5V7.5C16 7.22386 15.7761 7 15.5 7H14V12.5ZM4.5 4C4.22386 4 4 4.22386 4 4.5V12.5C4 12.7761 4.22386 13 4.5 13H12.5C12.7761 13 13 12.7761 13 12.5V4.5C13 4.22386 12.7761 4 12.5 4H4.5Z"></path></svg></div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 absolute top-0 left-0 transition-all opacity-0 scale-50" aria-hidden="true"><path d="M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"></path></svg></div></div></button></div></div><div class="text-text-500 font-small p-3.5 pb-0">javascript</div><div><pre class="code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border-radius: 0.3em;"><code class="language-javascript" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none;"><span><span>worker</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">on</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(152, 195, 121);">'message'</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token parameter">result</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token arrow" style="color: rgb(97, 175, 239);">=&gt;</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span> </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">/* что-то делать */</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span><span>
</span></span><span><span>worker</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token method property-access" style="color: rgb(97, 175, 239);">postMessage</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>data</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">;</span></span></code></pre></div></div>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">Для этого нужна система с уникальными ID для каждой задачи, чтобы понимать, какой ответ к какому запросу относится.</p>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">PM2 — менеджер процессов</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">PM2</code> — это программа для управления Node.js приложениями на сервере. Она как умный надсмотрщик, который:</p>
<ul class="[li_&amp;]:mb-0 [li_&amp;]:mt-1.5 [li_&amp;]:gap-1.5 [&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-disc flex flex-col gap-2 pl-8 mb-3">
<li class="whitespace-normal break-words pl-2">Автоматически перезапускает приложение, если оно упало</li>
<li class="whitespace-normal break-words pl-2">Показывает, сколько памяти и CPU использует приложение</li>
<li class="whitespace-normal break-words pl-2">Может запустить несколько копий приложения для распределения нагрузки</li>
<li class="whitespace-normal break-words pl-2">Предупреждает, если что-то идет не так</li>
</ul>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">Команда <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">pm2 monitor</code> открывает панель мониторинга, где видно состояние всех процессов в реальном времени.</p>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">Очередь задач в Laravel</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">Laravel — это популярный PHP фреймворк. В PHP нет встроенного способа запускать задачи на других ядрах процессора (в отличие от Node.js Worker Threads). Поэтому Laravel использует другой подход:</p>
<ol class="[li_&amp;]:mb-0 [li_&amp;]:mt-1.5 [li_&amp;]:gap-1.5 [&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-decimal flex flex-col gap-2 pl-8 mb-3">
<li class="whitespace-normal break-words pl-2">Когда нужно выполнить тяжелую задачу, информация о ней сохраняется в базу данных</li>
<li class="whitespace-normal break-words pl-2">Отдельный процесс ("worker") постоянно работает в фоне</li>
<li class="whitespace-normal break-words pl-2">Этот worker каждые несколько секунд проверяет базу: "Есть новые задачи?"</li>
<li class="whitespace-normal break-words pl-2">Если есть — берет задачу, выполняет, берет следующую</li>
</ol>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">Это как конвейер на заводе: задачи встают в очередь и обрабатываются по одной, чтобы не перегрузить сервер.</p>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">Message Channel API</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Message Channel</code> — это веб-технология для создания пары связанных портов для обмена сообщениями. Каждый канал имеет уникальный идентификатор, что помогает отслеживать, какой ответ к какому запросу относится. Это решает проблему идентификации задач при работе с Worker'ами.</p>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">Физические и логические ядра</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Физическое ядро</strong> — это реальный вычислительный блок внутри процессора. Если у вас 4-ядерный процессор, значит там физически 4 независимых "мозга".</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Логическое ядро</strong> создается технологией Hyper-Threading (у Intel) или SMT (у AMD). Одно физическое ядро притворяется двумя, позволяя выполнять два потока одновременно. Так 4 физических ядра превращаются в 8 логических. Это не удваивает производительность, но позволяет эффективнее использовать ресурсы процессора.</p>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">Как операционная система управляет ядрами?</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">Когда вы запускаете программу, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">планировщик операционной системы</code> автоматически решает, на каком ядре её выполнять. Если запустить три Worker'а на компьютере с 8 ядрами:</p>
<ul class="[li_&amp;]:mb-0 [li_&amp;]:mt-1.5 [li_&amp;]:gap-1.5 [&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-disc flex flex-col gap-2 pl-8 mb-3">
<li class="whitespace-normal break-words pl-2">ОС видит: есть 3 задачи и 8 свободных ядер</li>
<li class="whitespace-normal break-words pl-2">Она распределяет каждую задачу на отдельное ядро</li>
<li class="whitespace-normal break-words pl-2">Задачи выполняются параллельно и не мешают друг другу</li>
</ul>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">Если ядер не хватает, новые задачи ждут в очереди, пока какое-то ядро освободится.</p>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">Процессы и потоки</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Процесс</strong> — это запущенная программа со своей отдельной областью памяти. Когда вы открываете Chrome, это процесс. Когда открываете VS Code — это другой процесс. Процессы изолированы друг от друга.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Поток</strong> — это единица выполнения внутри процесса. Один процесс может содержать много потоков, которые разделяют общую память. Worker Threads в Node.js создают новые потоки внутри одного процесса Node.js, поэтому они могут быстро обмениваться данными, но при этом не блокируют друг друга.</p>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">Ограничение одновременных запросов в Chrome</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">Chrome <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">ограничивает количество одновременных соединений</code> к одному домену (обычно 6 соединений). Это защита от случайной перегрузки сервера. Если вы попытаетесь отправить 10 запросов одновременно, первые 6 выполнятся сразу, а остальные 4 встанут в очередь и будут ждать своей очереди. Это не защита от DDoS, а просто разумное ограничение браузера.</p>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">Дочерние процессы</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Дочерний процесс</code> — это процесс, запущенный из другого процесса (родительского). Когда вы запускаете Node.js сервер из VS Code, процесс Node становится дочерним для процесса VS Code. В диспетчере задач Windows можно увидеть эту иерархию, развернув дерево процессов. Это важно для понимания, почему сложно отследить Worker Threads в диспетчере — они не отображаются как отдельные процессы, а существуют как потоки внутри процесса Node.js.</p></div></div><div><div class="standard-markdown grid-cols-1 grid gap-4 [&amp;_&gt;_*]:min-w-0 !gap-3.5"><h1 class="text-text-100 mt-3 -mb-1 text-[1.375rem] font-bold">Лекция по изучению Node.js. Урок 1 (Продолжение)</h1>
<h2 class="text-text-100 mt-3 -mb-1 text-[1.125rem] font-bold">Отредактированный транскрипт</h2>
<img :src="screenshot_6861" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:54:15 --- Мне кажется, тот пример, что в консоли вычисления выводятся быстро, не мешая друг другу в плане расчетов, в принципе доказывает, что они работают на разных ядрах процессора. Просьба плюсами подтвердитесь, если понятен смысл этого примера. Тяжелые вычисления можно вот так вытащить в <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">worker threads</code>. Но делать это приходится крайне редко.</p>
<img :src="screenshot_6892" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:54:43 --- Однако <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">worker threads</code> — это не самое лучшее решение в большинстве случаев. По-хорошему, подчеркиваю, что надо делать правильно. Нужно отсюда просто куда-то в базу запоминать отложенную задачу. Например, создать таблицу очередей: идентификатор, тип задачи, условно файл, решающий задачу, и для нее вся необходимая информация. Если это загрузка файла, то ссылка на загруженный файл.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:55:11 --- Наш основной скрипт занимается только тем, что файл загружает на сервер. А дальше крон или еще кто-то на сервере сидит и запускает нодовский скрипт с интервалом раз в 30 секунд. Он по всем активным задачам бежит и друг за другом в синхронном режиме их выполняет. Отдельный Node-процесс, который с нашим основным связан, по идее не должен быть. Он эти файлы все парсит в порядке очереди.</p>
<img :src="screenshot_6949" alt="Image" >
<img :src="screenshot_6960" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:55:37 --- Чтобы не было такого, что 500 человек загрузили 500 файлов и на наши 6 ядер накинулись 500 файлами одновременно — это до добра не доведет. Такую систему очередей мы с вами реализовали на данном уроке. Давайте вернемся к вашим вопросам и попробуем понять, все ли мы из них закрыли. Разница <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Event Loop</code> в Node.js и в браузере по сути сводится во многом к тому, что в браузере Event Loop не может опустеть настолько, чтобы привести к завершению программы.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:56:12 --- Разница еще в том, какие именно специфические функции могут пополнять список <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">макрозадач</code>. В браузере это в основном браузерное API, связанное с запросами на сервер, с таймаутами и всем остальным. Например, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">requestIdleCallback</code>, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">requestAnimationFrame</code> и прочие события — это все, считайте, новые макротаски от браузерного API.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:56:38 --- В Node.js у нас добавляется к этому чтение файловой системы, а также запросы и ответы на сервер. С этим идёт новый <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">callback</code>. И если Event Loop вдруг опустеет, если макрозадач не останется активных, то всё — мы слетаем с выполнения кода, программа завершается.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">По поводу API сервера: получается, нам нужно сделать некий маркер, что тяжелый расчет идет.</p>
<img :src="screenshot_7050" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:57:09 --- То есть запустились тяжелые вычисления, и второй человек сделал запрос — будет ли у второго запускаться расчет? Будет, запустится повторно. Как вы видели, я запускал эти вычисления, они шли в трех потоках одновременно. Чтобы этого не было, мы должны поставить какой-то маркер. Например, если у админа есть адрес, который перерасчитывает суточную статистику, и вот он его случайно два раза запустит — не надо, чтобы расчет выполнялся дважды.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:57:48 --- Мы можем маркер поставить. Маркер, который называется <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">hardCalcNow</code>, равный <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">false</code>. В начале обработчика: если <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">hardCalcNow</code> истинно, то делаем <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">return</code> и <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">response.end()</code> с сообщением "your task is long and already run".</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:58:08 --- Далее присваиваем <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">hardCalcNow = true</code>. И вот здесь, в конце выполнения, и здесь, при ошибке, ставим <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">hardCalcNow = false</code>. По идее, сейчас в консоли мы должны увидеть расчет единожды, даже если я стартану его из трех браузеров, из трех вкладок одновременно.</p>
<img :src="screenshot_7130" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:58:34 --- Давайте подождем. Когда результат будет готов, мы один раз увидим расчет в консоли. Просьба плюсами подтвердить, если понятно, что такой маркер тоже может быть полезен. У всех этих запросов общая оперативная память. Сейчас, конечно, это сделано несколько топорно, так уж получилось, но смысл, думаю, понятен.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:58:55 --- Мы можем любой такой маркер поставить. Например, можно даже отклонять для пользователя загрузку файла, если его предыдущий файл еще рассчитывается. У пользователя есть какой-то маркер в таблице его файлов или в его личной таблице — когда он последний раз статистику грузил, когда она была обработана. И если поле <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">uploadedAt</code> больше, чем <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">processedAt</code>, то у него файл в стадии активной обработки, и надо отклонять загрузку новых файлов.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:59:32 --- Правда, нужен, наверное, какой-то механизм, который обнуляет эту статистику. А то мы <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">uploadedAt</code> поставили там в 7 вечера, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">processedAt</code> у него вчерашний день остался, и если обработка файла завершилась с ошибкой и мы это в базу не внесли, то у него навсегда заблокирована возможность грузить новые файлы со статистикой.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">01:59:56 --- Он будет в поддержку звонить, писать: "Что за фигня?". Поэтому должен быть какой-то, наверное, механизм сброса.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">Спрашивают: на практике какие длительные операции используют, просто любопытно? Это очень сильно зависит от специфики проекта и от того, что хочет заказчик.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">02:00:14 --- Например, возьмем относительно простой сайт — CRM под техосмотры. Допустим, если мы решим, что раз в месяц нужно админу на почту присылать красивую статистику в Excel, с разными параметрами: нарисовать графики статистики по каждому пункту, нарисовать статистику по каждому эксперту, нарисовать финансовый отчет по агентам и еще что-то.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">02:00:34 --- То генерация такого Excel-файла, как и соответствующие запросы к базе, могут быть достаточно длинной операцией. По сути, формирование этого файла надо вешать на крон, и пусть он его запускает — пусть хоть несколько минут генерирует. И по сути, именно вот такие операции, анализирующие большие объемы данных, они и являются тяжелыми. Но в каждом проекте своя специфика.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">02:01:01 --- Да, в какой-нибудь биржевой платформе это был бы анализ отчетов, которые люди от брокеров грузят. В каких-то, не знаю, онлайн-аукционах по машинам мог бы быть статистический отчет для админа каждый день, если машин много.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">02:01:40 --- В одном проекте нужно парсить данные по YouTube-каналам, по каждому видео. На 700 видео может быть. Проекты-парсеры — это, конечно, 100%. Парсеры могут работать очень долго.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">02:01:58 --- Спрашивают: покажу ли, как крон-задачи запускать? Смотрите, чтобы крон-задачи запустить, во-первых, нужно, чтобы в системе был крон. Крон, вроде как, штука линуксовая. В Windows есть журнал какой-то, которым почти никто не пользуется. Но если мы говорим про крон на сервере, то в конце посмотрим на тот же <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">PM2</code>, например. Покажу, что он из себя представляет.</p>
<img :src="screenshot_7360" alt="Image" >
<img :src="screenshot_7370" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">02:02:25 --- В <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">PM2</code> есть простая штука, позволяющая на крон это повесить. Там просто прописывается, по-моему, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">PM2-cron</code>, указывается название файла и шесть параметров для расписания — как его запускать. Можно указать каждый час, каждую минуту. По сути, это делается чуть ли не одной командой в PM2. И сервер позволяет, в принципе, с кроном работать, как правило, и через визуальные утилиты.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">02:03:00 --- На виртуальных серверах <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">crontab</code> какой-то открывается вроде, на выделенном сервере, по-моему, тоже можно, если ISP-менеджер используется, зайти посмотреть.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>[Лирическое отступление: Рекомендации по книгам о JavaScript]</strong></p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">Вопрос не по теме: какие книги по JavaScript рекомендуют, от простых до сложных? Это очень сложный вопрос.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">02:03:21 --- Почему? Потому что мне всегда казалось, что книги хорошие — те, которые фундаментальные по темам, которые в принципе не меняются. Книги, например, не устаревающие, как "Банда Четырех" про ООП, и им подобные.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">02:03:49 --- А если мы смотрим, что в JavaScript может не меняться? В JavaScript не меняется, по сути, структура языка, по большому счету. Всё, что было в базе: объекты, прототипы, сама суть языка, асинхронность — это не меняется. А вот если брать что-то по конкретным темам, то они постоянно обновляются. Начиная с 2015 года, как революционный стандарт ES6 вышел, постоянно что-то новое, новое, новое.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">02:04:24 --- Честно говоря, по этому поводу книги по JavaScript особо не мониторил давным-давно уже. Поэтому каких-то современных вариантов сейчас порекомендовать не смогу, наверное. Да, серия "You Don't Know JS" — это, конечно, книга хорошая.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">02:04:43 --- Но это не та книга, по которой ты учишься скорее, а та книга, которая тебе позволяет вспомнить материал. То есть, что по "You Don't Know JS" можно JavaScript выучить, я не то чтобы не верю, но это получится далеко не у всех. А вот как шпаргалка или как материал, когда ты JavaScript уже знаешь, чтобы освежить что-то в памяти, чтобы подучить то, что ты еще не знаешь по более сложной теме — это да.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">02:05:09 --- Это замечательная вещь, и в таком виде использовать рекомендую. А вот для того, чтобы просто JavaScript учить с нуля, у нас, вроде, это так не работает.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">Тарас пишет: "Банда четырех" не устаревает, но так и не научился шаблонам. Да, шаблоны — это отдельная тема.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">02:05:40 --- По книгам надо подумать. Помню, там на рубеже 2010-х, когда-то в самом начале, какая-то книга была для своего времени хорошая — про HTML5, какой-то там Диего Гаше, что ли. Она до сих пор на полке стоит. Там прикольно было. Там как раз выходили новшества, связанные с <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">canvas</code>, с возможностью даже что-то простое в WebGL делать.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">02:06:15 --- В принципе, это было интересно даже тогда — из книги переписывать примеры, смотреть, как ты там можешь, не знаю, на машине гонять по отрендеренной сцене. После этого случился 2015 год, и стандарты стали так быстро развиваться, что я вот с этого момента книжки перестал мониторить.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">02:06:40 --- В основном по JavaScript сам все добывал там на Хабре и прочих подобных ему ресурсах. По Vue — на Vue Mastery и, соответственно, по каждой конкретной теме на профильных ресурсах, подобных Vue Mastery.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>[Конец лирического отступления]</strong></p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">02:06:52 --- Ну ладно, это все лирика. Просьба плюсами подтвердить, если в принципе понятно, что мы сегодня смотрели — что про Node.js обсуждали. Домашнее задание выложу либо сегодня к полуночи, либо завтра утром отдельным роликом. У меня не было 100% уверенности, что именно мы с вами успеем посмотреть на первом уроке, и поэтому заранее домашку не готовил.</p>
<img :src="screenshot_7659" alt="Image" >
<img :src="screenshot_7667" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">02:07:27 --- Сейчас еще раз окину взглядом материал, который мы успели пройти, и домашку вам предложу.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">Так, в чате пишут про "You Don't Know JS". Звучит название, как будто нас сейчас редиректнут на сайт wtfjs, который будет показывать, как числа неправильно складываются — что <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">typeof undefined</code>, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">typeof null</code> и прочее.</p>
<img :src="screenshot_7688" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">02:07:56 --- Но в принципе можно посмотреть, действительно. Что это такое — <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">var</code>, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">let</code>. Надо разбираться, конечно. <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">var</code> смущает немножко. Понятно, <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">var</code> — это основа, что он с <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">let</code> сочетается, это хорошо, но здесь как раз будет рассказываться про разницу, что будет большая разница между <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">let</code> и <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">var</code>.</p>
<img :src="screenshot_7709" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">02:08:28 --- Так, TypeScript быстро. Следующее предложение в чате будет "TypeScript за 21 день". Потом "JavaScript за 21 день". И так далее. Ну да, если знаете какие-то хорошие книги, которые вам понравились, лучше всего в топе на Discord напишите их название, потому что в чате здесь они потеряются.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">02:08:51 --- Или даже не в топе, я сделаю после урока отдельную тему для ссылок на книжки, и можете туда запостить. Ну ладно, на сегодня тогда все. Спасибо за внимание. Хорошего настроения. Добавляйтесь, главное, на Discord в нашу группу, потому что там будет наша тусовка. После полуночи выложу материалы. Там появится домашка, там написано в технической информации расписание — куда и как присылать домашки.</p>
<img :src="screenshot_7764" alt="Image" >
<img :src="screenshot_7772" alt="Image" >
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">02:09:21 --- А там я напишу: "Выкладывайте названия книг". И можете сразу начинать постить — либо ссылки, если они корректные, либо просто название, если книги не с GitHub, скажем так. Инвайт на Discord приходил в том письме, в котором была и ссылка на трансляцию, так что у вас у всех это письмо должно быть.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">02:09:48 --- Всё, всем пока! Бодрого настроения, бодрой рабочей недели, и до пятницы — также восемь вечера по Москве. Всё, всем пока!</p>
<hr class="border-border-200 border-t-0.5 my-3 mx-1.5">
<h2 class="text-text-100 mt-3 -mb-1 text-[1.125rem] font-bold">Дополнительные объяснения</h2>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">Worker Threads — многопоточность в Node.js</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">Представьте, что Node.js — это ресторан с одним официантом. Обычно этот официант отлично справляется: принимает заказы, носит блюда, общается с гостями. Но что, если вдруг нужно перетащить тяжелый холодильник? Пока официант занят этой задачей, все остальные гости ждут — никто не получает обслуживания.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Worker threads</code> (рабочие потоки) — это как если бы мы наняли дополнительных сотрудников специально для тяжелой работы. Основной официант продолжает обслуживать гостей, а грузчики занимаются холодильником. При этом каждый грузчик работает на своем "ядре процессора" — как будто у каждого своя отдельная комната для работы.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">В реальных проектах это нужно редко, потому что есть более удобные способы организовать работу. Но если вам нужно, например, обработать огромное изображение или выполнить сложные математические расчеты, не останавливая при этом сервер — worker threads придут на помощь.</p>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">Event Loop — сердце асинхронности</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Event Loop</code> (цикл событий) — это как диспетчер в аэропорту, который постоянно проверяет: "Есть ли самолеты на взлет? Есть ли пассажиры на посадку? Нужно ли что-то обработать?"</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Разница между браузером и Node.js:</strong></p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">В <strong>браузере</strong> Event Loop никогда не может полностью "закончить работу" — он постоянно работает, потому что пользователь может в любой момент кликнуть мышкой или ввести текст. Браузер всегда должен быть готов к новым событиям.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">В <strong>Node.js</strong> всё по-другому. Если все задачи выполнены, все файлы прочитаны, все запросы обработаны — программа просто завершается. Диспетчер проверяет: "Есть что-то в списке дел? Нет? Отлично, рабочий день окончен!" — и сервер может выключиться.</p>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">Макрозадачи и микрозадачи</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">Представьте список дел на день. Есть большие задачи (макрозадачи) — например, "сходить в магазин", "убраться в комнате". А есть маленькие срочные дела (микрозадачи) — "ответить на SMS", "выключить чайник".</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Макрозадачи</strong> — это:</p>
<ul class="[li_&amp;]:mb-0 [li_&amp;]:mt-1.5 [li_&amp;]:gap-1.5 [&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-disc flex flex-col gap-2 pl-8 mb-3">
<li class="whitespace-normal break-words pl-2"><code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">setTimeout</code> и <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">setInterval</code> (таймеры)</li>
<li class="whitespace-normal break-words pl-2">Чтение файлов</li>
<li class="whitespace-normal break-words pl-2">Сетевые запросы</li>
<li class="whitespace-normal break-words pl-2">Обработка событий от пользователя</li>
</ul>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Микрозадачи</strong> — это:</p>
<ul class="[li_&amp;]:mb-0 [li_&amp;]:mt-1.5 [li_&amp;]:gap-1.5 [&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-disc flex flex-col gap-2 pl-8 mb-3">
<li class="whitespace-normal break-words pl-2"><code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Promise</code> (промисы)</li>
<li class="whitespace-normal break-words pl-2"><code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">process.nextTick</code> в Node.js</li>
</ul>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">JavaScript работает так: выполнил одну большую задачу (макрозадачу) → проверил, есть ли срочные маленькие дела (микрозадачи) → выполнил их все → взялся за следующую большую задачу. Так что микрозадачи всегда "проскакивают вперед" перед следующей макрозадачей.</p>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">PM2 — менеджер процессов</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">PM2</code> — это как надежный управляющий для ваших Node.js приложений. Представьте, что вы запустили сервер, а он вдруг упал из-за ошибки в коде. Обычно он просто остановится, и сайт перестанет работать. С PM2 всё иначе — он автоматически перезапустит ваше приложение за доли секунды.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Что умеет PM2:</strong></p>
<ul class="[li_&amp;]:mb-0 [li_&amp;]:mt-1.5 [li_&amp;]:gap-1.5 [&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-disc flex flex-col gap-2 pl-8 mb-3">
<li class="whitespace-normal break-words pl-2"><strong>Автоматический перезапуск</strong> — если программа упала, PM2 её тут же поднимет</li>
<li class="whitespace-normal break-words pl-2"><strong>Логирование</strong> — сохраняет все сообщения и ошибки в файлы</li>
<li class="whitespace-normal break-words pl-2"><strong>Мониторинг</strong> — показывает, сколько памяти использует приложение, загрузку процессора</li>
<li class="whitespace-normal break-words pl-2"><strong>Крон-задачи</strong> — может запускать ваши скрипты по расписанию (каждый час, каждый день и т.д.)</li>
<li class="whitespace-normal break-words pl-2"><strong>Балансировка нагрузки</strong> — может запустить несколько копий вашего приложения для обработки большого количества запросов</li>
</ul>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">Это незаменимый инструмент для продакшена (реального рабочего сервера).</p>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">Cron и Crontab — автоматизация по расписанию</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Cron</code> — это как будильник на вашем телефоне, только для компьютера. Вы говорите: "Каждый день в 3 часа ночи запускай эту программу" — и крон это делает, не забывая никогда.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Примеры использования:</strong></p>
<ul class="[li_&amp;]:mb-0 [li_&amp;]:mt-1.5 [li_&amp;]:gap-1.5 [&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-disc flex flex-col gap-2 pl-8 mb-3">
<li class="whitespace-normal break-words pl-2">Каждую ночь создавать резервную копию базы данных</li>
<li class="whitespace-normal break-words pl-2">Каждый час проверять новые письма</li>
<li class="whitespace-normal break-words pl-2">Раз в неделю отправлять отчеты</li>
</ul>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Crontab</code> — это файл, где вы пишете расписание. Выглядит он немного загадочно:</p>
<div class="relative group/copy bg-bg-000/50 border-0.5 border-border-400 rounded-lg"><div class="sticky opacity-0 group-hover/copy:opacity-100 top-2 py-2 h-12 w-0 float-right"><div class="absolute right-0 h-8 px-2 items-center inline-flex z-10"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)] h-8 w-8 rounded-md active:scale-95 backdrop-blur-md Button_ghost__BUAoh" type="button" aria-label="Copy to clipboard" data-state="closed"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 transition-all opacity-100 scale-100" aria-hidden="true"><path d="M12.5 3C13.3284 3 14 3.67157 14 4.5V6H15.5C16.3284 6 17 6.67157 17 7.5V15.5C17 16.3284 16.3284 17 15.5 17H7.5C6.67157 17 6 16.3284 6 15.5V14H4.5C3.67157 14 3 13.3284 3 12.5V4.5C3 3.67157 3.67157 3 4.5 3H12.5ZM14 12.5C14 13.3284 13.3284 14 12.5 14H7V15.5C7 15.7761 7.22386 16 7.5 16H15.5C15.7761 16 16 15.7761 16 15.5V7.5C16 7.22386 15.7761 7 15.5 7H14V12.5ZM4.5 4C4.22386 4 4 4.22386 4 4.5V12.5C4 12.7761 4.22386 13 4.5 13H12.5C12.7761 13 13 12.7761 13 12.5V4.5C13 4.22386 12.7761 4 12.5 4H4.5Z"></path></svg></div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 absolute top-0 left-0 transition-all opacity-0 scale-50" aria-hidden="true"><path d="M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"></path></svg></div></div></button></div></div><div><pre class="code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border-radius: 0.3em;"><code style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre-wrap; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none;"><span><span>0 3 * * * /path/to/script.js</span></span></code></pre></div></div>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">Расшифровка: "В 0 минут 3-го часа, каждый день, каждый месяц, в любой день недели — запусти этот скрипт".</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">Не пугайтесь синтаксиса — после пары примеров всё становится понятно!</p>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">Browser APIs: requestAnimationFrame и requestIdleCallback</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">Это специальные инструменты, которые дает нам браузер для управления временем выполнения кода.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong><code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">requestAnimationFrame</code></strong> — используется для создания плавных анимаций. Представьте, что вы рисуете мультфильм. Браузер обновляет картинку на экране обычно 60 раз в секунду. <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">requestAnimationFrame</code> говорит: "Я хочу нарисовать следующий кадр!" — и браузер вызывает вашу функцию ровно перед тем, как обновить изображение на экране. Результат — идеально плавная анимация без рывков.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong><code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">requestIdleCallback</code></strong> — это как говорить браузеру: "Эй, когда у тебя будет свободная минутка, можешь выполнить эту задачу? Не срочно!" Браузер выполнит вашу функцию, когда он не занят обработкой кликов пользователя, отрисовкой страницы или другими важными делами. Отлично подходит для фоновой аналитики или предзагрузки данных.</p>
<h3 class="text-text-100 mt-2 -mb-1 text-base font-bold">Паттерн маркеров состояния: uploadedAt и processedAt</h3>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">Это умный способ отслеживать, находится ли файл в процессе обработки.</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Логика работы:</strong></p>
<ul class="[li_&amp;]:mb-0 [li_&amp;]:mt-1.5 [li_&amp;]:gap-1.5 [&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-disc flex flex-col gap-2 pl-8 mb-3">
<li class="whitespace-normal break-words pl-2">Когда пользователь загружает файл, мы сохраняем время загрузки в поле <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">uploadedAt</code></li>
<li class="whitespace-normal break-words pl-2">Когда обработка файла завершается, мы сохраняем время окончания в <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">processedAt</code></li>
</ul>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Проверка статуса:</strong></p>
<ul class="[li_&amp;]:mb-0 [li_&amp;]:mt-1.5 [li_&amp;]:gap-1.5 [&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-disc flex flex-col gap-2 pl-8 mb-3">
<li class="whitespace-normal break-words pl-2">Если <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">uploadedAt &gt; processedAt</code> (время загрузки новее времени обработки) — файл еще обрабатывается</li>
<li class="whitespace-normal break-words pl-2">Если <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">processedAt &gt;= uploadedAt</code> — обработка завершена, можно загружать новый файл</li>
</ul>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]"><strong>Пример:</strong></p>
<div class="relative group/copy bg-bg-000/50 border-0.5 border-border-400 rounded-lg"><div class="sticky opacity-0 group-hover/copy:opacity-100 top-2 py-2 h-12 w-0 float-right"><div class="absolute right-0 h-8 px-2 items-center inline-flex z-10"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)] h-8 w-8 rounded-md active:scale-95 backdrop-blur-md Button_ghost__BUAoh" type="button" aria-label="Copy to clipboard" data-state="closed"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 transition-all opacity-100 scale-100" aria-hidden="true"><path d="M12.5 3C13.3284 3 14 3.67157 14 4.5V6H15.5C16.3284 6 17 6.67157 17 7.5V15.5C17 16.3284 16.3284 17 15.5 17H7.5C6.67157 17 6 16.3284 6 15.5V14H4.5C3.67157 14 3 13.3284 3 12.5V4.5C3 3.67157 3.67157 3 4.5 3H12.5ZM14 12.5C14 13.3284 13.3284 14 12.5 14H7V15.5C7 15.7761 7.22386 16 7.5 16H15.5C15.7761 16 16 15.7761 16 15.5V7.5C16 7.22386 15.7761 7 15.5 7H14V12.5ZM4.5 4C4.22386 4 4 4.22386 4 4.5V12.5C4 12.7761 4.22386 13 4.5 13H12.5C12.7761 13 13 12.7761 13 12.5V4.5C13 4.22386 12.7761 4 12.5 4H4.5Z"></path></svg></div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 absolute top-0 left-0 transition-all opacity-0 scale-50" aria-hidden="true"><path d="M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"></path></svg></div></div></button></div></div><div><pre class="code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border-radius: 0.3em;"><code style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre-wrap; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none;"><span><span>uploadedAt: 2025-01-05 19:00:00
</span></span><span>processedAt: 2025-01-05 18:30:00</span></code></pre></div></div>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">Видим, что файл загрузили в 19:00, а последняя обработка была в 18:30 — значит, новый файл еще обрабатывается, нужно подождать!</p>
<p class="font-claude-response-body break-words whitespace-normal leading-[1.7]">Важный нюанс: нужен механизм сброса на случай, если обработка завершилась с ошибкой. Иначе пользователь навсегда не сможет загрузить новые файлы, потому что система думает, что предыдущий файл все еще обрабатывается.</p></div></div>
</template>

<script setup>
import screenshot_0002 from '@/assets/node/node1/screenshot_0002.jpg';
import screenshot_0326 from '@/assets/node/node1/screenshot_0326.jpg';
import screenshot_0521 from '@/assets/node/node1/screenshot_0521.jpg';
import screenshot_0646 from '@/assets/node/node1/screenshot_0646.jpg';
import screenshot_0760 from '@/assets/node/node1/screenshot_0760.jpg';
import screenshot_0856 from '@/assets/node/node1/screenshot_0856.jpg';
import screenshot_0878 from '@/assets/node/node1/screenshot_0878.jpg';
import screenshot_0890 from '@/assets/node/node1/screenshot_0890.jpg';
import screenshot_1011 from '@/assets/node/node1/screenshot_1011.jpg';
import screenshot_1171 from '@/assets/node/node1/screenshot_1171.jpg';
import screenshot_1290 from '@/assets/node/node1/screenshot_1290.jpg';
import screenshot_1400 from '@/assets/node/node1/screenshot_1400.jpg';
import screenshot_1436 from '@/assets/node/node1/screenshot_1436.jpg';
import screenshot_1518 from '@/assets/node/node1/screenshot_1518.jpg';
import screenshot_1582 from '@/assets/node/node1/screenshot_1582.jpg';
import screenshot_1645 from '@/assets/node/node1/screenshot_1645.jpg';
import screenshot_1659 from '@/assets/node/node1/screenshot_1659.jpg';
import screenshot_1722 from '@/assets/node/node1/screenshot_1722.jpg';
import screenshot_1739 from '@/assets/node/node1/screenshot_1739.jpg';
import screenshot_2502 from '@/assets/node/node1/screenshot_2502.jpg';
import screenshot_2793 from '@/assets/node/node1/screenshot_2793.jpg';
import screenshot_2808 from '@/assets/node/node1/screenshot_2808.jpg';
import screenshot_2895 from '@/assets/node/node1/screenshot_2895.jpg';
import screenshot_3062 from '@/assets/node/node1/screenshot_3062.jpg';
import screenshot_3100 from '@/assets/node/node1/screenshot_3100.jpg';
import screenshot_3208 from '@/assets/node/node1/screenshot_3208.jpg';
import screenshot_3252 from '@/assets/node/node1/screenshot_3252.jpg';
import screenshot_3269 from '@/assets/node/node1/screenshot_3269.jpg';
import screenshot_3363 from '@/assets/node/node1/screenshot_3363.jpg';
import screenshot_3402 from '@/assets/node/node1/screenshot_3402.jpg';
import screenshot_3471 from '@/assets/node/node1/screenshot_3471.jpg';
import screenshot_3575 from '@/assets/node/node1/screenshot_3575.jpg';
import screenshot_3601 from '@/assets/node/node1/screenshot_3601.jpg';
import screenshot_3611 from '@/assets/node/node1/screenshot_3611.jpg';
import screenshot_3705 from '@/assets/node/node1/screenshot_3705.jpg';
import screenshot_3715 from '@/assets/node/node1/screenshot_3715.jpg';
import screenshot_3880 from '@/assets/node/node1/screenshot_3880.jpg';
import screenshot_3898 from '@/assets/node/node1/screenshot_3898.jpg';
import screenshot_3927 from '@/assets/node/node1/screenshot_3927.jpg';
import screenshot_3939 from '@/assets/node/node1/screenshot_3939.jpg';
import screenshot_4079 from '@/assets/node/node1/screenshot_4079.jpg';
import screenshot_4390 from '@/assets/node/node1/screenshot_4390.jpg';
import screenshot_4423 from '@/assets/node/node1/screenshot_4423.jpg';
import screenshot_4437 from '@/assets/node/node1/screenshot_4437.jpg';
import screenshot_4448 from '@/assets/node/node1/screenshot_4448.jpg';
import screenshot_4455 from '@/assets/node/node1/screenshot_4455.jpg';
import screenshot_4497 from '@/assets/node/node1/screenshot_4497.jpg';
import screenshot_4524 from '@/assets/node/node1/screenshot_4524.jpg';
import screenshot_4533 from '@/assets/node/node1/screenshot_4533.jpg';
import screenshot_4544 from '@/assets/node/node1/screenshot_4544.jpg';
import screenshot_4557 from '@/assets/node/node1/screenshot_4557.jpg';
import screenshot_4640 from '@/assets/node/node1/screenshot_4640.jpg';
import screenshot_4707 from '@/assets/node/node1/screenshot_4707.jpg';
import screenshot_4717 from '@/assets/node/node1/screenshot_4717.jpg';
import screenshot_4741 from '@/assets/node/node1/screenshot_4741.jpg';
import screenshot_4753 from '@/assets/node/node1/screenshot_4753.jpg';
import screenshot_4768 from '@/assets/node/node1/screenshot_4768.jpg';
import screenshot_4814 from '@/assets/node/node1/screenshot_4814.jpg';
import screenshot_4824 from '@/assets/node/node1/screenshot_4824.jpg';
import screenshot_4869 from '@/assets/node/node1/screenshot_4869.jpg';
import screenshot_4903 from '@/assets/node/node1/screenshot_4903.jpg';
import screenshot_5102 from '@/assets/node/node1/screenshot_5102.jpg';
import screenshot_5121 from '@/assets/node/node1/screenshot_5121.jpg';
import screenshot_5205 from '@/assets/node/node1/screenshot_5205.jpg';
import screenshot_5269 from '@/assets/node/node1/screenshot_5269.jpg';
import screenshot_5314 from '@/assets/node/node1/screenshot_5314.jpg';
import screenshot_5326 from '@/assets/node/node1/screenshot_5326.jpg';
import screenshot_5338 from '@/assets/node/node1/screenshot_5338.jpg';
import screenshot_5359 from '@/assets/node/node1/screenshot_5359.jpg';
import screenshot_5453 from '@/assets/node/node1/screenshot_5453.jpg';
import screenshot_5465 from '@/assets/node/node1/screenshot_5465.jpg';
import screenshot_5498 from '@/assets/node/node1/screenshot_5498.jpg';
import screenshot_5546 from '@/assets/node/node1/screenshot_5546.jpg';
import screenshot_5603 from '@/assets/node/node1/screenshot_5603.jpg';
import screenshot_5658 from '@/assets/node/node1/screenshot_5658.jpg';
import screenshot_5674 from '@/assets/node/node1/screenshot_5674.jpg';
import screenshot_5737 from '@/assets/node/node1/screenshot_5737.jpg';
import screenshot_5751 from '@/assets/node/node1/screenshot_5751.jpg';
import screenshot_5776 from '@/assets/node/node1/screenshot_5776.jpg';
import screenshot_5827 from '@/assets/node/node1/screenshot_5827.jpg';
import screenshot_5974 from '@/assets/node/node1/screenshot_5974.jpg';
import screenshot_5982 from '@/assets/node/node1/screenshot_5982.jpg';
import screenshot_6035 from '@/assets/node/node1/screenshot_6035.jpg';
import screenshot_6069 from '@/assets/node/node1/screenshot_6069.jpg';
import screenshot_6149 from '@/assets/node/node1/screenshot_6149.jpg';
import screenshot_6163 from '@/assets/node/node1/screenshot_6163.jpg';
import screenshot_6183 from '@/assets/node/node1/screenshot_6183.jpg';
import screenshot_6191 from '@/assets/node/node1/screenshot_6191.jpg';
import screenshot_6207 from '@/assets/node/node1/screenshot_6207.jpg';
import screenshot_6229 from '@/assets/node/node1/screenshot_6229.jpg';
import screenshot_6444 from '@/assets/node/node1/screenshot_6444.jpg';
import screenshot_6532 from '@/assets/node/node1/screenshot_6532.jpg';
import screenshot_6584 from '@/assets/node/node1/screenshot_6584.jpg';
import screenshot_6635 from '@/assets/node/node1/screenshot_6635.jpg';
import screenshot_6648 from '@/assets/node/node1/screenshot_6648.jpg';
import screenshot_6664 from '@/assets/node/node1/screenshot_6664.jpg';
import screenshot_6687 from '@/assets/node/node1/screenshot_6687.jpg';
import screenshot_6733 from '@/assets/node/node1/screenshot_6733.jpg';
import screenshot_6767 from '@/assets/node/node1/screenshot_6767.jpg';
import screenshot_6774 from '@/assets/node/node1/screenshot_6774.jpg';
import screenshot_6788 from '@/assets/node/node1/screenshot_6788.jpg';
import screenshot_6834 from '@/assets/node/node1/screenshot_6834.jpg';
import screenshot_6845 from '@/assets/node/node1/screenshot_6845.jpg';
import screenshot_6861 from '@/assets/node/node1/screenshot_6861.jpg';
import screenshot_6892 from '@/assets/node/node1/screenshot_6892.jpg';
import screenshot_6949 from '@/assets/node/node1/screenshot_6949.jpg';
import screenshot_6960 from '@/assets/node/node1/screenshot_6960.jpg';
import screenshot_7050 from '@/assets/node/node1/screenshot_7050.jpg';
import screenshot_7130 from '@/assets/node/node1/screenshot_7130.jpg';
import screenshot_7360 from '@/assets/node/node1/screenshot_7360.jpg';
import screenshot_7370 from '@/assets/node/node1/screenshot_7370.jpg';
import screenshot_7659 from '@/assets/node/node1/screenshot_7659.jpg';
import screenshot_7667 from '@/assets/node/node1/screenshot_7667.jpg';
import screenshot_7688 from '@/assets/node/node1/screenshot_7688.jpg';
import screenshot_7709 from '@/assets/node/node1/screenshot_7709.jpg';
import screenshot_7764 from '@/assets/node/node1/screenshot_7764.jpg';
import screenshot_7772 from '@/assets/node/node1/screenshot_7772.jpg';
</script>
